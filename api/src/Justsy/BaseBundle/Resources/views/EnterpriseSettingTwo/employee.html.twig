{% extends 'JustsyBaseBundle:EnterpriseSetting:enterprise_master.html.twig' %}
{% block menuitemactive_employee %}class="active"{% endblock %}
{% block menuitemactive_microul1 %}style="position: relative;left: 23px;"{% endblock %}
{% block menuitemactive_microul2 %}style="position: relative;left: 23px;"{% endblock %}
{% block stylesheets %}
 <link href="/bundles/fafatimewebase/css/edit-table-default-style.css" type="text/css" rel="stylesheet">
 <link href="/bundles/fafatimewebase/css/pagination.css" type="text/css" rel="stylesheet">
 <style type="text/css">
 	  .input-prepend{width:580px;}
		#org_left { z-index:10000;display: none; width:180px; height:250px;position: absolute;top: 0;left:0px;}
		#org_right {  width:740px; height:580px; margin-top:2px; background-color:#FFF;}
		#org_left a:hover {background-color:#fefdea; text-decoration:none;}
		ul{margin: 0;padding: 0;border: 0}
		ul.ztree {padding:0px; border: 1px solid #ccc;background: #eefaf6;width:180px;height:250px;overflow-y:auto;overflow-x:auto;}
.div_btn {
	margin-top:2px;
  line-height:21px;
  width:69px;
  height:21px;
  cursor:pointer;
  text-align:center;
  overflow:hidden;
  background:url('{{asset('bundles/fafatimewebase/images/btn_normal.png')}}');
 }
 .invalidpage{
 	background-color:#CCC;
 	border-color:#CCC;
 	cursor:default;
 	z-index:0;
 	color:#BBB;
 }
/*菜单模块 */
.tab{
 list-style:none;
 padding:4px 5px 0px 5px;
 margin-left:0px;
 }
.tab li{ 
display:inline; /* 【重点】让li横向排列。*/
 font-size:12px;
 }
.tab li a{ 
padding:5px 10px; /* 因为没有固定高度，所以用填充来调整显示效果。 */
border:1px solid #ccc;  /* 菜单项的边框 */
color:#888; 
border-bottom:none; /* 底部无边框 */
text-decoration:none;
background:#f7f7f7
}
/*鼠标经过时的样式 */
.tab li a:hover{ 
background:#fff;
}
/*选中时的样式 */
.tab li.no a{ 
background-color:#eefaf6;
border-bottom:none; /*  隐藏菜单项的底部边框 */
position:relative;  /* 【重点】菜单项里面的连接使用了相对定位 */
top:1px;            /* 【重点】相对于外层顶部为1像素，正好是底部边框的像素。所以就遮住了ul的底部边框 */
color:#000000; 
font-weight:bold
}		 	  
.state_list{
   z-index:10000;display: none; width:92px; height:100px;position: absolute;top: 0;left:0px;border:1px solid #7F9DB9;background-color:#FFF;
}
.state_item{
   background-color:#FFF;
   list-style: none outside none;
   cursor:pointer;
   padding-left: 10px;   
}
.state_item:hover{
   background-color:#CCC;
}
.state_item_active{
   background-color:#3399FF;
   list-style: none outside none;
   color:#FFF;
   cursor:pointer;
   padding-left: 10px;
}
.dropdown_btn{
    background-color: #F0F0F0;
    border: 1px solid #F0F0F0;
    display: block;
    float: right;
    height: 18px;
    width: 20px;
    cursor:pointer;
}
.dropdown_btn:hover{
   border: 1px solid #707070;
}
.importemps{
     position: absolute;
     top: 0;
     left:0px;
     z-index:10000;
     display: none; 
     width:250px; 
     height:100px;
     border: 1px solid #CCCCCC;
     background: none repeat scroll 0 0 #FFF;
}
#privlist li:hover{
	background-color:#afd7f0;
	cursor:pointer;
}
.privselected{
	background-color:#afd7f0;
	cursor:pointer;
}
ul li{
	list-style: none outside none;
}
#stafflist li{
	width:100px;
	height:22px;
	overflow:hidden;
	text-overflow:ellipsis;
  white-space: nowrap;
}
 </style>
<script type="text/javascript" language="javascript"  src="{{asset('bundles/fafatimewebase/js/Util.js')}}"></script> 
<script type="text/javascript" language="javascript"  src="{{asset('bundles/fafatimewebase/js/DetailTable.js')}}"></script>
<script type="text/javascript" language="javascript"  src="{{asset('bundles/fafatimewebase/js/hint.js')}}"></script>
{% endblock %}

{% block main_content_center%}
<div class="grade-title">员工管理</div>
<div style="height: 25px;padding-left: 10px;padding-right: 10px;padding-top: 5px;position: relative;width: 718px;">
<span style="*position:inherit;*height:15px;*width:150px;*float:left;float: left;*right:140px;left: 5px;top: -5px;" class="searcharea"><input id="txtempserach" type="text" maxlength="10" placeholder="姓名/邮箱/手机号"/><div id="empsearch" class="searchicon" style="cursor:pointer;*top:-30px;*left:10px;"></div></span>
   <span style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;float:right;cursor: pointer;" id="import_btn">批量导入</span>
   <span style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;float:right;cursor: pointer;" id="menu_invite_btn">单个邀请</span>
   <span style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;float:right;cursor: pointer;" onclick="$('#addemployee').show()" id="menu_add_btn">添加员工</span>
      <span id="priv_btn" style="color:#3366CC;float:right;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">权限控制</span>
</div>
<div style="margin-top: 3px;background-color: #F3F3F3; border-top: 1px solid #C4D5E0;border-bottom: 1px solid #C4D5E0; height: 25px;padding-left: 10px;padding-right: 10px;padding-top: 5px;position: relative;width: 720px;">
   <span style="color:#404040;float:left;margin-right: 5px;"><input id="sel_all" type="checkbox"></span>
   <span style="color:#404040;float:left;margin-right: 10px;margin-top: 1px;">全选</span>
   <!--<span id="disable_btn" style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">禁用</span>-->
   <span id="delete_btn" style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">删除</span>
   <span id="invite_btn" style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">再次邀请</span>
   <span id="leave_btn" style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">办理离职</span>
   <span id="deptchange_btn" style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">部门变更</span>
   <span id="save_edit" style="color:#3366CC;float:left;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;">保存编辑</span>
</div>
<div id="state_list" class="state_list">
		<ul>
		   <li class="state_item_active" value="1">正常</li>
		   <li class="state_item" value="9">未激活</li>
		   <!--<li class="state_item" value="-1">已禁用</li>-->
		   <li class="state_item" value="3">已离职</li>
		</ul> 		    
</div>
<div id="ent_main">
				<!--机构树-->
				<div id="org_left">
				  		    <ul id="tree_dept" class="ztree"></ul> 		    
				</div>
				<div id="org_right">
				<div id="org_view" style="position: relative;overflow:hidden;top:0px;left:0px;width:740px;height:100%;">
				    <div id="emplist" style="height:525px;width:738px;overflow-x: hidden; overflow-y: auto;"></div>	
				    <div id="page"></div>
						<div id="error" class="error_hint" style="display:none;position: absolute;left:330px;top:100px">
						   <img src="{{asset('bundles/fafatimewebase/images/loading.gif')}}">
						</div>			    		  		
				</div>
				</div>
		</div>
<div>
<!--部门变更-->
<div class="dept_change modal" id="dept_change" data-backdrop=false style="display: none;
    margin-left: -100px;
    margin-top: -160px;
    width: 220px;" show=false>
      <div class="doc_window_title">
      	<span>&nbsp;&nbsp;部门变更</span>
      </div>
	    <div>
	      <div class="doc_rd_confirm_right">
	          <div class="doc_rd_confirm_text" style="height: 230px;">
	          <ul id="tree_dept2" class="ztree" style="height:220px;width:220px;background: #FFFFFF;border-color: -moz-use-text-color -moz-use-text-color #CCCCCC;border-style: none none solid;border-width: 0 0 1px;"></ul> 
	          </div>
	          <div style="margin-left: 55px;float:left;width: 140px;"><span id="saveDeptChange" class="doc_md_content_right_btn">确定</span><span id="cancelDeptChangeSave" class="doc_md_content_right_btn">关闭</span></div>
	          <div id="deptChangeHint" style="margin-left: 70px;height:30px;text-align: center;float:left;line-height: 30px;"></div>
	      </div>	      
	    </div>
</div>	
<!--批量导入-->
<div id="import_panel" class="importemps">
    <span class="topmenu_app_triangle" style="border-color: transparent transparent rgb(204, 204, 204); left: -20px; border-width: 9px; top: -18px;"></span>
    <span class="topmenu_app_triangle" style="border-color: transparent transparent rgb(255, 255, 255); border-width: 9px; left: -2px; top: -18px;"></span>    
    <div style="color:#000">
    	<form target="frm_import_submit" id="frm_import" action="{{path('JustsyBaseBundle_enterprise_setting_import_employee',{'network_domain':curr_network_domain})}}" method="post" enctype="multipart/form-data">
        <div style="margin-left: 10px; height: 30px;"><span style="float:left;height: 25px;line-height: 25px;">请先下载</span><a style="float:left;color: blue;line-height: 25px;" href="/WeFaFa_Employee_Template.xls">导入模板</a><span style="float:left;height: 25px;line-height: 25px;">，并填写人员信息</span></div>	
        <div style="margin-left: 10px; height: 30px;"><input  name="filedata" id="filedata" type="file" style="width:230px;height: 25px;line-height: 25px;"></div>
        <div style="padding-top: 15px;">
        	  <span style="float:left;margin-left: 10px;width:120px;line-height: 25px;" id="import_hint"></span>
   					<span onclick="if(!is_import_ing){$('#import_panel').hide();$import_hint.html('')}" style="color:#3366CC;float:right;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;" id="import_close">关闭</span>
   					<span style="color:#3366CC;float:right;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;" id="import_start">开始导入</span>
        </div>
      </form>
      <iframe style="display:none" id="frm_import_submit" name="frm_import_submit" width=0 height=0></iframe>
    </div>
</div>
<!--单个邀请-->
<div id="invite_panel" class="importemps">
    <span class="topmenu_app_triangle" style="border-color: transparent transparent rgb(204, 204, 204); left: -20px; border-width: 9px; top: -18px;"></span>
    <span class="topmenu_app_triangle" style="border-color: transparent transparent rgb(255, 255, 255); border-width: 9px; left: -2px; top: -18px;"></span>    
    <div style="color:#000">
    	<div style="margin-left: 10px; height: 30px;"><span style="float:left;height: 25px;line-height: 25px;">同事邮箱：(多个邮箱请用,或;分隔)</span></div>	
        <div style="margin-left: 10px; height: 30px;"><input name="invite_mails" id="invite_mails" type="text"  maxlength=255 style="height: 25px;line-height: 25px;"></div>
        <div style="padding-top: 15px;">
        	  <span style="float:left;margin-left: 10px;width:120px;line-height: 25px;" id="invite_hint"></span>
   					<span onclick="if(!is_invite_ing){$('#invite_panel').hide();$invite_hint.html('')}" style="color:#3366CC;float:right;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;" id="invite_close">关闭</span>
   					<span style="color:#3366CC;float:right;cursor: pointer;background-color:#F6F7F7;margin-right: 10px;border: 1px solid #999999;padding-left: 5px;padding-right: 5px;" id="invite_start">发送邀请</span>
        </div>   
    </div>
</div>
<div id="functionlist" class="modal" style="z-index: 100000;height: 300px;margin-left: -150px;margin-top: -150px;width: 300px;display:none; position: fixed;">
	<div style="margin-bottom: 5px; border-bottom: 1px solid rgb(204, 204, 204); padding-left: 10px; margin-top: 5px;">功能列表</div>
	<div style="overflow: auto; padding-left: 15px; margin-bottom: 2px; height: 238px;">
		<ul id="privlist" roleid="">
		          			{%for item in functions%}
		          			<li functioncode="{{item['code']}}" functionid="{{item['id']}}"><input type="checkbox"  style="margin-right: 5px; margin-top: -3px;">{{item['name']}}</li>
		          			{%endfor%}
		</ul>
	</div>
	<div style="border-top: 1px solid #ccc;background-color: rgb(243, 243, 243); padding-left: 80px; height: 25px; padding-top: 5px;">
		<span onclick="saveprivcontroll(this)" style="min-width: 50px;width: auto;" class="doc_md_content_right_btn">保存</span><span onclick="$('#functionlist').hide()" class="doc_md_content_right_btn">取消</span>
	</div>
</div>
<div id="newrole" class="modal" style="z-index: 100000;height: 150px;margin-left: -150px;margin-top: -75px;width: 300px;display:none; position: fixed;">
	<div style="margin-bottom: 5px; border-bottom: 1px solid rgb(204, 204, 204); padding-left: 10px; margin-top: 5px;">添加新角色</div>
	<div style="overflow: auto; height: 80px; padding-left: 10px; line-height: 80px; margin-top: 15px;">
  <div>角色名称：<input type="text" id="rolenametxt"><input type="hidden" id="roleidtxt" value=""></div>
  <div>角色编码: <input type="text" id="rolecodetxt"></div>
	</div>
	<div style="border-top: 1px solid #ccc;background-color: rgb(243, 243, 243); padding-left: 100px; height: 25px; padding-top: 5px;">
		<span onclick="saveRole(this)" style="min-width: 50px;width: auto;" class="doc_md_content_right_btn">保存</span><span onclick="$('#newrole').hide()" class="doc_md_content_right_btn">取消</span>
	</div>
</div>
<div id="staffrole" class="modal" style="z-index: 100000;height: 300px;margin-left: -250px;margin-top: -150px;width: 500px;display:none; position: fixed;">
	<div style="margin-bottom: 5px; border-bottom: 1px solid rgb(204, 204, 204); padding-left: 10px; margin-top: 5px;">当前角色：<span>XXXXX</span></div>
	<div style="margin-top: 10px; margin-left: 10px;">
			<input type="text" id="rolestaffsearch" onclick="loadAllStaffs()" size=25 placeholder="输入员工帐号、姓名" style="height: 25px;margin-left: 5px;padding: 0;width: 150px;">
			<button style="margin-top: -10px; height: 28px;" onclick="loadAllStaffs()">搜索</button>
	</div>	
	<div style="overflow: auto; padding-left: 15px; margin-bottom: 2px; height: 193px; padding-right: 15px;">
		<ul id="stafflist" roleid="">
		</ul>
	</div>
	<div style="border-top: 1px solid #ccc;background-color: rgb(243, 243, 243); padding-left: 180px; height: 25px; padding-top: 5px;">
		<span onclick="setStaffRole(this)" style="min-width: 50px;width: auto;" class="doc_md_content_right_btn">保存</span><span onclick="$('#staffrole').hide()" class="doc_md_content_right_btn">取消</span>
	</div>
</div>
<!--更改人员角色对话框-->
<div id="changerole" class="modal" style="z-index: 100000;height: 300px;margin-left: -150px;margin-top: -150px;width: 300px;display:none; position: fixed;">
	<div style="margin-bottom: 5px; border-bottom: 1px solid rgb(204, 204, 204); padding-left: 10px; margin-top: 5px;">角色列表</div>
	<div style="overflow: auto; padding-left: 15px; margin-bottom: 2px; height: 238px;">
		<ul id="rolelist" login_account="">
		    <li rolecode=""><input type="radio" style="margin-right: 5px; margin-top: -3px;">试用员工</li>
		    <li rolecode=""><input type="radio" style="margin-right: 5px; margin-top: -3px;">正式员工</li>
		    <li rolecode=""><input type="radio" style="margin-right: 5px; margin-top: -3px;">管理人员</li>
		</ul>
	</div>
	<div style="border-top: 1px solid #ccc;background-color: rgb(243, 243, 243); padding-left: 80px; height: 25px; padding-top: 5px;">
		<span onclick="setRoleStaff(this)" style="min-width: 50px;width: auto;" class="doc_md_content_right_btn">保存</span><span onclick="$('#changerole').hide()" class="doc_md_content_right_btn">取消</span>
	</div>
</div>


<div class="doc_confirm modal" id="doc_confirm" data-backdrop=false style="display:none;margin-left: -110px;margin-top: -60px;width: 260px;" show=false>
      <div class="doc_window_title">
      	<span>&nbsp;&nbsp;帐号删除</span>
      </div>
	    <div>
	      <div class="doc_rd_confirm_left"></div>
	      <div class="doc_rd_confirm_right">
	          <div class="doc_rd_confirm_text" style="height: 60px; line-height: 60px; text-align: center;">确定要删除该人员吗？</div>
	          <div style="margin-left: 80px;float:left"><span id="deleteDoc" class="doc_md_content_right_btn">确定</span><span id="cancelDelete" class="doc_md_content_right_btn">关闭</span></div>
	          <div class="deletehint" style="margin-left: 70px;height:20px;width:130px;float:left"></div>
	      </div>	      
	    </div>
</div>
<div class="doc_confirm modal" id="emp_confirm" style="display:none;margin-left: -110px;margin-top: -60px;width: 260px;">
      <div class="doc_window_title">
        <span>&nbsp;&nbsp;消息提示</span>
      </div>
      <div>
        <div class="doc_rd_confirm_left"></div>
        <div class="doc_rd_confirm_right">
            <div class="doc_rd_confirm_text" style="height: 60px; line-height: 60px; margin-left: 69px;">员工已经成功办理离职!</div>
            <div style="margin-left: 100px;float:left"><span class="doc_md_content_right_btn" onclick="$('#emp_confirm').hide()">确认</span></div>
            <div class="deletehint" style="margin-left: 70px;height:20px;width:130px;float:left"></div>
        </div>        
      </div>
</div>
<div class="errorlist modal" id="errorlist" data-backdrop=false style="display:none;height: 300px;margin-left: -160px;margin-top: -150px;width: 320px;" show=false>
      <div class="doc_window_title">
      	<span>&nbsp;&nbsp;导入错误日志</span>
      </div>
	    <div>
	      <div class="doc_rd_confirm_right">
	          <div class="errorlist_text" style="overflow:auto;height: 220px; line-height: 20px; margin: 10px;">
	          </div>
	          <div style="margin-left: 130px;float:left"><span onclick="$('#errorlist').hide()" class="doc_md_content_right_btn">关闭</span></div>
	      </div>	      
	    </div>
</div>
<div class="modal" id="privcontroll" data-backdrop=false style="display:none;margin-left: -300px;margin-top: -250px;width: 800px;" show=false>
      <div class="doc_window_title">
      	<span>&nbsp;&nbsp;权限管理</span>
      	<div class="invite_title_close" onclick="$('#privcontroll').hide()" title="关闭" style="color: rgb(102, 102, 102); font-size: 16px;">×</div>
      </div>
	    <div>
	      <div class="doc_rd_confirm_right">
	          <div class="errorlist_text" style="overflow:auto;height: 490px; line-height: 20px; margin: 10px;">
	          	<!--
	          	<div style="float: left;height: 220px;overflow: auto;width: 200px;">
	          		<ul id="privlist">
	          			{%for item in functions%}
	          			<li functioncode="{{item['code']}}">{{item['name']}}</li>
	          			{%endfor%}
	          		</ul>
	          	</div>
	          	<div style="float: left; width: 180px; padding-left: 10px; margin-left: 5px;height:220px;overflow:auto;">
	          		<div style="border-bottom: 1px solid rgb(204, 204, 204); padding-bottom: 5px;"><input id="employeequxuan" type="checkbox"/>&nbsp;&nbsp;全选</div>
	          		<div id="employeelist">
	          			
	          		</div>
	          	</div>-->
	          		<div class="tab-pane" style="min-height: 350px;">
						<ul class="nav nav-tabs" style="border-bottom: 1px solid #ddd;height: 37px;padding-left: 25px;">
						    <li class="active"><a href="#rolemgr" data-toggle="tab">角色管理</a></li>
						    <li><a href="#staffrolemgr" onclick="loadStaffRoleMgr()" data-toggle="tab">员工授权管理</a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="rolemgr">
								<div style="height:260px;overflow:auto" id="rolelistpage">
									<div style="margin-top:5px"><span onclick="add_newrole()" style="cursor:pointer" title="添加新角色"><i class="icon-plus"></i>新角色</span></div>
									<table border="1" width="95%" >
										<tr style="text-align: center; background-color: rgb(243, 243, 243);">
											<td>操作</td><td width="20%">角色名称</td><td width="30%">功能点</td><td width="40%">授权员工</td>
										</tr>	
										<tr style="text-align: center; ">
											<td><i class="icon-edit" title="编辑角色信息" style="cursor:pointer"></i>&nbsp;<i class="icon-trash" title="删除该角色" style="cursor:pointer"></i></td><td width="20%">试用员工</td><td width="30%"><a href="javascript:setrolefunction(0)">配置</a></td><td width="40%">李领、张三、孙悟空...【<a href='javascript:allocstaff(0)'>授权</a>】</td>
										</tr>
									</table>
								</div>
							</div>
							<div class="tab-pane" id="staffrolemgr" load='0'>
								<div style="height:400px;overflow:auto">
									<div style="margin-top:10px;margin-bottom:5px;overflow:hidden;"><input type="text" id="searchStaffText" style="width:150px;margin:0;height:16px;" placeholder="输入员工帐号、姓名">
									<button onclick="searchStaff()" style="height: 28px;">搜索</button>
									<div id="fenye" style="float:right;"></div>
									</div>
									<div id="stafflistpage">
										
									</div>
								</div>
								<br>
							</div>
						</div>
					</div>
	          </div>	          
	      </div>	      
	    </div>
</div>
<div class="modal" id="addemployee" data-backdrop=false style="display:none;height:350px;margin-left: -160px;margin-top: -150px;width: 400px;" show=false>
      <div class="doc_window_title">
      	<span>&nbsp;&nbsp;添加新员工</span>
      </div>
	    <div>
	      <div class="doc_rd_confirm_right">
	          <div class="errorlist_text" style="overflow:hidden;height:250px; line-height: 20px; margin: 10px;">
	          <form style="padding-left:35px;">
	          		<input type="hidden" id="pass" name="pass" value="123456"/>
	          		<input type="hidden" id="ename" name="ename" value="{{app.user.ename}}"/>
	          		<input type="hidden" id="eno" name="eno" value="{{app.user.eno}}"/>
	          		<input type="hidden" id="isNew" name="isNew" value="0"/>
	          		<input type="hidden" id="eshortname" name="eshortname" value="{{app.user.eshortname}}"/>
	          		<table>
	          			<tr><td style="float:left;margin-top:5px;">部门：</td><td><input type="text" maxlength="20" name="txtdept" id="txtdept" onclick="Account.showDept()" style="cursor:default;width:210px;" value="" readonly="" class="input-xlarge">
	          				<input type="hidden"id="txtdeptid" name="txtdeptid" value="">
	          				<span style="position:absolute;top:30px;left:1px;width:auto;display:none">
					            <div class="zTreeDemoBackground"><img  src="{{ asset('bundles/fafatimewebase/images/loading.gif') }}" width="16" height="16">正在加载数据...</div>
					            <div id="deptdiv" style="display:none" isload="0" class="zTreeDemoBackground" saveurl="{{ path('JustsyBaseBundle_account_deptsave', {'network_domain' : curr_network_domain})}}" delurl="{{ path('JustsyBaseBundle_account_deptdel', {'network_domain' : curr_network_domain})}}" url="{{ path('JustsyBaseBundle_account_deptquery', {'network_domain' : curr_network_domain})}}">
					               <ul id="depttree" class="ztree"></ul>	
					            </div>
					        </span> 
	          				</td>
	          			</tr>
	          			<tr><td style="float:left;margin-top:5px;">姓名：</td><td><input type='text' id="realName" name="realName"/></td></tr>
	          			<tr><td style="float:left;">性别：</td><td><input type="hidden" id="sex" value='1' name="sex"/><input type='radio' onclick="$('#sex').val('1')" style="margin-top:-4px;" checked='checked' id="sex_f" name="sext"/><span>男</span>&nbsp;&nbsp;&nbsp;<input type='radio' onclick="$('#sex').val('1')" style="margin-top:-4px;" id="sex_m" name="sext"/><span>女</span></td></tr>
	          			<tr><td style="float:left;margin-top:5px;">邮箱：</td><td><input type='text' id="account" name="account"/></td></tr>
	          			<tr><td style="float:left;margin-top:5px;">职务：</td><td><input type='text' id="duty" name="duty"/></td></tr>
	          			<tr><td style="float:left;margin-top:5px;">手机：</td><td><input type='text' id="mobile" name="mobile"/></td></tr>
	          		</table>
	          	</form>		
	          </div>
	          <div style="margin-bottom: 10px;margin-top: -20px;"><center><img style="width:25px;display:none;" src="{{asset('bundles/fafatimewebase/images/loading.gif')}}"><span id="saveaddemployee_status"></span></center></div>
	          <div style="margin-left: 130px;float:left"><span onclick="saveaddemployee()" class="doc_md_content_right_btn">保存</span><span onclick="canceladdemployee()" class="doc_md_content_right_btn">取消</span></div>
	      </div>	      
	    </div>
</div>
<script type="text/javascript" language="javascript"  src="{{asset('bundles/fafatimewebase/js/OrgView.js')}}"></script>
<script>
  var empActionUrl = "{{path('JustsyBaseBundle_account_mployeemgr',{'network_domain':curr_network_domain})}}";
  var error = document.getElementById("error"),orgTree_dept=null,orgTree_dept2 = null,obj=null,RootID="v{{app.user.eno}}";
  var conText="/",curNode = null, errHandle = null,$error=$("#error"),ajaxObj=null;
  var allroles=null;
  var allstaffs={{staffs|raw}};
  //分页控件
/*
使用  Pagination pageObj=new Pagination();
pageObj.init({
container:Dom对象,
totalcount:100,
pagesize:20,
defaultpage:2,默认为1
default:默认加载的页码 默认为第一页
onBntClick:function(pageindex){
//加载页面方法
}
});
*/
var Pagination = function () {
    this.totalcount = 0;
    this.pagecount = 0; //页数
    this.pagesize = 0;
    this.maxsize = 9;
    this.container = []; //父容器
    this.pageclickevent = []; //页码点击事件
    this.preclickevent = []; //上一页点击事件
    this.nexclickevent = []; //下一页点击事件
    this.pointclickevent = []; //
    this.firstclickevent = [];
    this.lastclickevent = [];
    this.currpage = 0;
    this.point = [];
}
Pagination.prototype = {
    setCount: function () {
        this.pagecount = Math.ceil(this.totalcount / this.pagesize);
    },
    setContainer: function (container) {
        this.container = container;
    },
    addPageClick: function (func) {
        this.pageclickevent.push(func);
    },
    addPreClick: function (func) {
        this.preclickevent.push(func);
    },
    addNexClick: function (func) {
        this.nexclickevent.push(func);
    },
    addPointClick: function (func) {
        this.pointclickevent.push(func);
    },
    addFirstClick: function (func) {
        this.firstclickevent.push(func);
    },
    addLastClick: function (func) {
        this.lastclickevent.push(func);
    },
    pageClick: function (pageindex) {
        for (var i = 0; i < this.pageclickevent.length; i++) {
            this.pageclickevent[i].apply(this, [pageindex]);
        }
    },
    preClick: function (pageindex) {
        for (var i = 0; i < this.preclickevent.length; i++) {
            this.preclickevent[i].apply(this, [pageindex]);
        }
    },
    nexClick: function (pageindex) {
        for (var i = 0; i < this.nexclickevent.length; i++) {
            this.nexclickevent[i].apply(this, [pageindex]);
        }
    },
    pointClick: function () {

    },
    firstClick: function () {
        var pageindex = 1;
        for (var i = 0; i < this.firstclickevent.length; i++) {
            this.firstclickevent[i].apply(this, [pageindex]);
        }
    },
    lastClick: function () {
        var pageindex = this.pagecount;
        for (var i = 0; i < this.lastclickevent.length; i++) {
            this.lastclickevent[i].apply(this, [pageindex]);
        }
    },
    setDefault: function (pageindex, callback) {
        var thisindex = pageindex;
        if (thisindex == this.currpage) return;
        this.currpage = thisindex;
        this.setCurrCss();
        if (thisindex == this.pagecount || thisindex == 1) {
            this.setNoPageCss();
        }
        if (callback != null)
            callback(thisindex);
    },
    setNoPageCss: function () {
        var nopageCss = {
            'background-color': '#c8c8c8',
            'color': '#000'
        };
        var pageCss = {
            'background-color': '#00AAD5',
            'color': '#FFF'
        };
        $("span[pagination='pre'],span[pagination='nex']").css(pageCss);
        $("span[pagination='" + (this.currpage == 1 ? 'pre' : 'nex') + "']").css(nopageCss);
    },
    setCurrCss: function () {
        var currCss = {
            'background-color': '#00AAD5',
            'color': '#FFF'
        };
        var notcurrCss = {
            'background-color': '#e6e6e6',
            'color': '#000'
        };
        $("span[pagination='page']").css(notcurrCss);
        $("span[pagination='page'][pageindex='" + this.currpage + "']").css(currCss);
    },
    setCurrPage: function (no) {
        if (no != null) this.currpage = no;
        for (var i = 0; i < this.container.length; i++) {
            $(this.container[i]).find("span.currpage").text(this.currpage + "/" + this.pagecount + "页");
        }
    },
    settotal: function () {
        for (var i = 0; i < this.container.length; i++) {
            $(this.container[i]).find("span.totalcount").text(this.totalcount);
        }
    },
    resetPageList: function () {
        var $p = $(this.container).find(".pagev[pageindex='" + this.currpage + "']").parent();
        var $nex = $p.next();
        var $pre = $p.prev();
        var d = '';
        var notarr = [1, this.pagecount, this.currpage];
        if ($nex.attr('class') == 'pointc') {
            d = 'nex';
            var html = [];
            for (var i = 1; i <= 3; i++) {
                notarr.push(parseInt(this.currpage) + i);
                html.push("<span class='pagec'><span  class='pagev' style='width:20px;' pagination='page' pageindex='" + (parseInt(this.currpage) + i).toString() + "'>" + (parseInt(this.currpage) + i).toString() + "</span></span>");
                if ($(".pagev[pageindex='" + (parseInt(this.currpage) + i + 1).toString() + "']").length) {
                    $nex.remove();
                    break;
                }
            }
            $p.after(html.join(''));
        }
        if ($pre.attr('class') == 'pointc') {
            d = 'pre';
            var html = [];
            for (var i = 1; i <= 3; i++) {
                notarr.push(parseInt(this.currpage) - i);
                html.unshift("<span class='pagec'><span  class='pagev' style='width:20px;' pagination='page' pageindex='" + (parseInt(this.currpage) - i).toString() + "'>" + (parseInt(this.currpage) - i).toString() + "</span></span>");
                if ($(".pagev[pageindex='" + (parseInt(this.currpage) - i - 1).toString() + "']").length) {
                    $pre.remove();
                    break;
                }
            }
            $p.before(html.join(''));
        }
        if (d != '') {
            var n = $(this.container).find(".pagev[pageindex]").length - 1;
            var $lastpage = $(this.container).find(".pagev[pageindex]:last");
            while (n > -1 && $(this.container).find(".pagev").length > this.maxsize) {
                $v = $(this.container).find(".pagev[pageindex]:eq(" + n + ")");
                if (!notarr.contains(parseInt($v.attr('pageindex')))) {
                    $v.parent().remove();
                }
                n--;
            }
            var $pages = $(this.container).find(".pagev[pageindex]");
            for (var i = 0; i < $pages.length; i++) {
                var thisindex = parseInt($($pages[i]).attr('pageindex'));
                var nexindex = parseInt($($pages[i + 1]).attr('pageindex'));
                if (thisindex + 1 != nexindex) {
                    if ($($pages[i]).parent().next().attr('class') == 'pagec')
                        $($pages[i]).parent().after("<span class='pointc'><span class='pointv' pagination='point'>●●●</span></span>");
                }
            }
        }
    },
    createHTML: function () {
        var html = [];
        html.push("<span class='operc'><span class='pagev btn' title='首页' pagination='first'><<</span></span>");
        html.push("<span style='margin-left:5px;' class='operc'><span class='pagev btn' title='上一页' pagination='pre'><</span></span>");
        /*
        for (var i = 1; i <= this.pagecount; i++) {
        if (i == this.pagesize && this.pagecount > this.pagesize) {
        html.push("<span class='pointc'><span class='pointv' pagination='point'>●●●</span></span>");
        i = this.pagecount - 1;
        this.point.push(i);
        }
        else
        html.push("<span class='pagec'><span  class='pagev' style='width:20px;' pagination='page' pageindex='" + i + "'>" + i + "</span></span>");
        }
        */
        html.push('<span style="margin-left:5px;"  class="operc"><span pagination="redirect" class="pagev btn">跳转到<input type="text" style="width: 30px; height: 20px;padding:0; margin: -4px 0px 0px 5px; border: 0px none;padding:0px\9;*padding:0px;" class="redirect_bnt">&nbsp;<a href="javascript:void(0);" class="gotopage btn" style="color: rgb(0, 0, 0);margin-top: -2px;background-color:#CCC; cursor: pointer; text-decoration: none;">Go</a>&nbsp;&nbsp;<span class="currpage" style="padding-bottom:2px;"></span>&nbsp;&nbsp;共&nbsp;<span class="totalcount" style="padding-bottom:2px;"></span>&nbsp;条</span></span>');
        html.push("<span style='margin-left:5px;'  class='operc'><span  class='pagev btn' title='下一页' pagination='nex'>></span></span>");
        html.push("<span style='margin-left:5px;' class='operc'><span class='pagev btn' title='末页' pagination='last'>>></span></span>");
        for (var i = 0; i < this.container.length; i++) {
        		
            $(this.container[i]).html(html.join(''));
            if (this.pagecount == 1) {
                $(this.container[i]).hide();
            }
        }
    },
    cancelCallBack: function () {
        this.pageclickevent = []; //页码点击事件
        this.preclickevent = []; //上一页点击事件
        this.nexclickevent = []; //下一页点击事件
        this.pointclickevent = []; //
        this.firstclickevent = [];
        this.lastclickevent = [];
    },
    init: function (paras) {
        if (paras.pagecount)
            this.pagecount = paras.pagecount; //页数
        if (paras.container)
            this.setContainer(paras.container); //父容器
        if (paras.totalcount)
            this.totalcount = paras.totalcount;
        if (paras.pagesize)
            this.pagesize = paras.pagesize;
        this.setCount();
        //取消所有回调
        this.cancelCallBack();
        if (paras.onBntClick) {
            this.addPageClick(paras.onBntClick);
            this.addPreClick(paras.onBntClick);
            this.addNexClick(paras.onBntClick);
            this.addLastClick(paras.onBntClick);
            this.addFirstClick(paras.onBntClick);
            this.addPageClick(this.setCurrPage);
            this.addPreClick(this.setCurrPage);
            this.addNexClick(this.setCurrPage);
            this.addLastClick(this.setCurrPage);
            this.addFirstClick(this.setCurrPage);
        }
        this.createHTML();
        this.bindEvent();
        this.currpage = paras.defaultpage ? paras.defaultpage : 1;
        this.setCurrPage();
        this.settotal();
    },
    setTotalCount: function (count) {
        this.totalcount = count;
        this.currpage = Math.max(this.currpage, 1);
        this.setCount();
        this.setCurrPage();
        this.settotal();
        for (var i = 0; i < this.container.length; i++) {
            if (this.totalcount <= this.pagesize) {
                //只有1页时，隐藏分页控件
                $(this.container[i]).hide();
            }
            else {
                $(this.container[i]).show();
            }
        }
    },
    setPageSize: function () {

    },
    bindEvent: function () {
        var _obj = this;
        for (var i = 0; i < this.container.length; i++) {
            $(this.container[i]).find("span[pagination='point']").unbind('click').bind('click', function () {

            });
            $(this.container[i]).find("span[pagination='page']").unbind('click').bind('click', function () {
                var $this = $(this);
                var thisindex = $this.attr('pageindex');
                if (thisindex == _obj.currpage) return;
                _obj.currpage = thisindex;
                //_obj.setCurrCss();
                if (thisindex == _obj.pagecount || thisindex == 1) {
                    // _obj.setNoPageCss();
                }
                _obj.pageClick(thisindex);
                //_obj.resetPageList();
            });
            $(this.container[i]).find("span[pagination='pre']").unbind('click').bind('click', function () {
                var $this = $(this);
                if (_obj.currpage == 1) return;
                _obj.currpage--;
                //_obj.setCurrCss();
                if (_obj.currpage == 1) {
                    //_obj.setNoPageCss();
                }
                _obj.preClick(_obj.currpage);
                //_obj.resetPageList();
            });
            $(this.container[i]).find("span[pagination='nex']").unbind('click').bind('click', function () {
                var $this = $(this);
                if (_obj.currpage == _obj.pagecount) return;
                _obj.currpage++;
                //_obj.setCurrCss();
                if (_obj.currpage == _obj.pagecount) {
                    //_obj.setNoPageCss();
                }
                _obj.nexClick(_obj.currpage);
                //_obj.resetPageList();
            });
            $(this.container[i]).find("span[pagination='first']").unbind('click').bind('click', function () {
                _obj.currpage = 1;
                //_obj.setCurrCss();
                //_obj.setNoPageCss();
                _obj.firstClick();
            });
            $(this.container[i]).find("span[pagination='last']").unbind('click').bind('click', function () {
                _obj.currpage = _obj.pagecount;
                //_obj.setCurrCss();
                //_obj.setNoPageCss();
                _obj.lastClick();
            });
            $(this.container[i]).find("span[pagination='redirect']").find("input.redirect_bnt").unbind('keydown').bind('keydown', function (event) {
                var ev = event || window.event;
                if (ev.keyCode == 13) {
                    var currpage = $(this).val();
                    if (!(/^[0-9]{1,}$/).test(currpage)) {
                        $(this).val("");
                        return;
                    }
                    currpage = Math.min(parseInt(currpage), _obj.pagecount);
                    currpage = Math.max(1, currpage);
                    $(this).val(currpage);
                    _obj.currpage = currpage;
                    _obj.pageClick(currpage);
                    stopProp(ev);
                }
            });
            $(this.container[i]).find("a.gotopage").unbind('click').bind("click", function () {
                var e = this;
                var currpage = $(e).siblings("input.redirect_bnt").val();
                if (!(/^[0-9]{1,}$/).test(currpage)) {
                    $(this).val("");
                    return;
                }
                currpage = Math.min(parseInt(currpage), _obj.pagecount);
                currpage = Math.max(1, currpage);
                $(this).val(currpage);
                _obj.currpage = currpage;
                _obj.pageClick(currpage);
                stopProp(ev);
            });
        }
    }
}
function stopProp(evt) {
    evt.stopPropagation ? evt.stopPropagation() : (evt.cancelBubble = true);
    if (evt.preventDefault) evt.preventDefault();
}
  
  function setrolefunction(roleid)
  {
  	$("#functionlist").show();
  	$("#privlist").attr("roleid",roleid);
  	$.post("{{path('JustsyBaseBundle_enterprise_setting_set_get_privbyrole',{'network_domain':curr_network_domain})}}",{"roleid":roleid},function(d){
  		if(d.length){
  			for(var i=0;i<d.length;i++){
  				$("#privlist li[functionid='"+d[i].functionid+"']").find("input").attr("checked",true);
  			}
  		}
  	});
  }
  //添加新角色
  function add_newrole()
  {
  	$("#rolenametxt").val('');
  	$("#rolecodetxt").val('');
  	$("#roleidtxt").val('');
  	$("#newrole").show();
  }
  function loadAllStaffs()
  {
  	var html=[];
  	var searchStr=$("#rolestaffsearch").val();
  	for(var i=0;i<allstaffs.length;i++){
  		var hide=true;
  		if(searchStr=="" || searchStr.indexOf(allstaffs[i].login_account)>-1 || searchStr.indexOf(allstaffs[i].nick_name)>-1){
  			hide=false;
  		}
  		html.push('<li '+(hide?'style="display:none;"':'')+' login_account="'+allstaffs[i].login_account+'" style="float:left;margin-right: 10px"><input type="checkbox" style="margin-right: 5px; margin-top: -3px;">'+allstaffs[i].nick_name+'</li>');
  	}
  	$("#stafflist").html(html.join(''));
  }
  function allocstaff(roleid)
  {
 		$("#stafflist input").attr("checked",false);
  	$.post("{{path('JustsyBaseBundle_enterprise_setting_set_get_staffbyrole',{'network_domain':curr_network_domain})}}",{"roleid":roleid},function(d){
  		if(d.length){
  			for(var i=0;i<d.length;i++){
  				$("#stafflist li[login_account='"+d[i].staff+"']").find("input").attr("checked",true);
  			}	
  		}
  		else{
  		}
  	});
  	$("#stafflist").attr("roleid",roleid);
  	$("#staffrole").show();
  }
  function changesaffrole(staff)
  {
  	$("#changerole").show();
  	$("#rolelist").attr("login_account",staff);
  	
  	var html=[];
  	for(var i=0;i<allroles.length;i++){
  		html.push('<li roleid="'+allroles[i].id+'"><input type="checkbox" style="margin-right: 5px; margin-top: -3px;">'+allroles[i].name+'</li>');
  	}
  	$("#rolelist").html(html.join(''));
  	$.post("{{path('JustsyBaseBundle_enterprise_setting_set_get_rolebystaff',{'network_domain':curr_network_domain})}}",{"login_account":staff},function(d){
  		if(d.length){
  			for(var i=0;i<d.length;i++){
  				$("#rolelist").find("li[roleid='"+d[i].roleid+"'] input").attr("checked",true);
  			}
  		}
  	});
  }
  function loadonlist(e)
  {
  	if(typeof(privclickajax)!="undefined" && privclickajax!=null)return;
  	$(e).siblings().removeClass("privselected");
  	$(e).addClass("privselected");
  	var functionid=$(e).attr("functioncode");
  	privclickajax=$.getJSON("{{path('JustsyBaseBundle_enterprise_setting_getusers_turnon',{'network_domain':curr_network_domain})}}?functionid="+functionid,function(d){
  		privclickajax=null;
  		for(var i=0;i<d.length;i++)
  		{
  			$("#employeelist input[login_account='"+d[i].login_account+"']").attr('checked','checked');
  		}
  	});
  	$("#employeelist input[login_account]").attr('checked',false);
  	$("#employeequxuan").attr('checked',false);
  }
  $(document).ready(function(){
  $("#priv_btn").bind('click',function(){
  	$("#privcontroll").show();
  	var accounts=[];
  	var b=obj.getSelectedValue('login_account').split(',');
  	var c=obj.getSelectedValue('nick_name').split(',');
  	for(var i=0;i<b.length;i++)
  	{
  		accounts.push({
  			login_account:b[i],
  			nick_name:c[i]
  		});
  	}
  	$("#employeelist").html(returnformathtml(accounts));
  	loadonlist($("#privlist li:first")[0]);
  });
  $("#privlist li").bind('click',function(){
  	loadonlist(this);
  });
  $("#employeequxuan").bind('click',function(){
  	if(!!$(this).attr('checked'))
  		$("#employeelist input[login_account]").attr('checked','checked');
  	else
  		$("#employeelist input[login_account]").attr('checked',false);
  });
  Account.login_account = "{{account}}";
  Account.loadDept();
  orgTree_dept = new OrgTree("tree_dept");
  cur_dept="";  
  orgTree_dept2 = new OrgTree("tree_dept2"),
	obj = new detailTable("emplist",[{id:"nick_name",title:"姓名",width:"80px",maxLength:10,isOpenWindow:true,openWindowURL:"callback:saveEmployeeEdit"},
	                                      {id:"sex_id",title:"性别",width:"50px",listData:"'男,男','女,女'",isDownList:true,isOpenWindow:true,OpenWindowURL:"callback:saveEmployeeEdit"},
	                                      {id:"dept_name",title:"部门名称",width:"120px",edit:0},
	                                      {id:"duty",title:"职务",width:"100px",isOpenWindow:true,OpenWindowURL:"callback:saveEmployeeEdit"},
	                                      {id:"login_account",title:"电子邮箱",width:"151px",maxLength:32,edit:0},
	                                      {id:"mobile",title:"手机",width:"120px",maxLength:11,inputType:"inputPlusInteger",isOpenWindow:true,OpenWindowURL:"callback:saveEmployeeEdit"},
	                                      {id:"state_id",title:"用户状态",width:"100px",edit:0},
	                                      
	                                      //{id:"look",title:"详细信息",width:"80px",text:"查看",alignStyle:"left"},
	                                  {crossColor:{doubleColorCSS:"doubleRowBg",singularColorCSS:"singularRowBg",moveinColorCSS:"moveRowBg"}}]);
	obj.edit=true;
	obj.count=500;
	obj.createDeleteColumn = false;
	obj.selectMode = "multiple";
	obj.selectByControl = true;
	obj.setCloneRowIndex(0);
	obj.key = "openid";
	obj.notnull = "login_account,nick_name";
	$("#emplist tr:eq(0) td").css({"border":"0px","height":"31px","background-image": "url('/bundles/fafatimewebase/images/mgr_employee_list_header_bg.jpg')"});
	obj.pageObject.reSetPageEvent=function(){
		var args={};
		args.parent = this;        	
        args.updatePage=function(p)
        {
        	this.parent.pageinfo.setAttribute("currentpage",p);
        	this.parent.refreshPageList();
        }
		var firstPage="#"+this.fixedid+"_first";
		var lastestPage="#"+this.fixedid+"_lastest";
		var prevPage="#"+this.fixedid+"_last";
		var nextPage="#"+this.fixedid+"_next";
		$(firstPage).addClass("invalidpage");
    $(prevPage).addClass("invalidpage");
    $(lastestPage).attr("title","末页");
    $(nextPage).attr("title","下一页");
    $(firstPage).attr("title","首页");
    $(prevPage).attr("title","上一页");
		$(firstPage)[0].onclick=$(lastestPage)[0].onclick=$(prevPage)[0].onclick=$(nextPage)[0].onclick=function(e){
			var event = e || window.event;
            var eventsrcElement = event.target || event.srcElement;
        	var src = (eventsrcElement.id); 
        	var page = eventsrcElement.parentNode;
            var currentPageNo = parseInt(page.getAttribute("currentpage"));
            var pageCount = parseInt(page.getAttribute("pagecount"));
            if (src.indexOf("_next")>0){
               if (currentPageNo + 1 > pageCount*1){}
               else{
                    args.updatePage(currentPageNo + 1);}}
            else if(src.indexOf("_lastest")>=0){if (currentPageNo == pageCount){}else{
                args.updatePage(pageCount);}}                    
            else if(src.indexOf("_last")>0){
                if (currentPageNo > 1){
                    args.updatePage(currentPageNo - 1);}
                else{
                	}}
            else if(src.indexOf("_first")>0){
                 if (currentPageNo == 1){}else{
                 args.updatePage(1);}}
            else if (src.indexOf("_jump")>0){
                 if (currentPageNo >= 1 && currentPageNo <= pageCount){
                 	 args.updatePage(currentPageNo);}
                 else{}
                 }       
           if(args.callfunc!=null) args.callfunc(); 
           else
           {
               var o = getObjectRef(page.id.replace("__grid_pageinfo",""));
               o.memoryPage(currentPageNo);
           }
           currentPageNo = parseInt(page.getAttribute("currentpage"));
            if(currentPageNo==pageCount)
            {
            	$(lastestPage).addClass("invalidpage");
            	$(nextPage).addClass("invalidpage");
            	$(firstPage).removeClass("invalidpage");
            	$(prevPage).removeClass("invalidpage");
            }
            else if(currentPageNo==1)
            {
            	$(firstPage).addClass("invalidpage");
            	$(prevPage).addClass("invalidpage");
            	$(lastestPage).removeClass("invalidpage");
            	$(nextPage).removeClass("invalidpage");
            }
            else{
            	$(lastestPage).removeClass("invalidpage");
            	$(nextPage).removeClass("invalidpage");
            	$(firstPage).removeClass("invalidpage");
            	$(prevPage).removeClass("invalidpage");
            }
          $("#sel_all")[0].checked=false;
		};
	}
	obj.pageObject.init({parentNode:"page"});
	obj.pageObject.reSetPageEvent(obj.pageObject.fixedid,obj.pageObject);
	//obj.pageObject.setPageSize(Pagesize);
	obj.ColsName["state_id"].callback=function(cell,data)
	{

		  if(data.state_id=="9") cell.innerHTML = "<div class='textNoBR' style='color:red'>未激活</div>";
		  else if(data.state_id=="1") cell.innerHTML = "<div class='textNoBR'>正常</div>";
		  else if(data.state_id=="-1"){
		      cell.parentNode.style.color="#999"; 
		      cell.innerHTML = "<div class='textNoBR'>禁用</div>"
		  }
		  else if(data.state_id=="3") {cell.parentNode.style.color="#999"; cell.innerHTML = "<div class='textNoBR'>已离职</div>"}
		  cell.title="";
		  
	}
	obj.ColsName["login_account"].datacheck=function(data)
	{
		  var row = data.rowIndex;
		  if(row==1) return true;//第一行不检查
		  var text = data.value.replace(/ /g,"");
		  if(text=="")
		  {
		     showHint(row,"login_account","电子邮箱不能为空！");
		     return false;
		  }
		  else  if(!isEmail(text))
		  {
         showHint(row,"login_account","电子邮箱格式不正确！");
         return false;
      }
      return true;
	}	
	obj.ColsName["mobile"].datacheck=function(data)
	{
		  var row = data.rowIndex;
		  if(row==1) return true;//第一行不检查
		  var text = data.value.replace(/ /g,"");
      if(text!="" && !isMobile(text))
      {
         showHint(row,"mobile","手机格式不正确！");
         return false;
      }
      return true;
	}	
	

  obj.onRowSelected=function(row)
  {
  	  var keyv = row.getAttribute("keyvalue");
  	  var checked = Type.toBoolean(row.getAttribute("checked"));
 	
      if(checked)	
      {
          var state=obj.getCellValue(row.rowIndex,"state_id");
          if(state=="正常")
          {
				      ToolButton.setEnable("deptchange_btn","#3366CC");
				      ToolButton.setEnable("leave_btn","#3366CC");
				  }
				  else if(state=="未激活")
				  {
				      ToolButton.setEnable("delete_btn","#3366CC");
				      ToolButton.setEnable("invite_btn","#3366CC");
				  }
      }
      else
      {
      	   if(obj.currentRowIndex()=="")
      	   {
						  ToolButton.setDisable("deptchange_btn",null);
						  ToolButton.setDisable("delete_btn",null);
						  ToolButton.setDisable("leave_btn",null);
						  ToolButton.setDisable("invite_btn",null);
           }
      }
  }
  obj.DataBindAfter=function()
  {
     // ToolButton.setEnable('saveBtn');
     // ToolButton.setEnable('btn_addrow');
		 //newRow.cells[0].innerHTML = "&nbsp;";  	
  }  
orgTree_dept.onSelected=function()
{
    curNode = orgTree_dept.getManager().getSelectedNodes();
    if(curNode==null || curNode.length<1) return;
    curNode = curNode[0];
    $("#dept_name div span:eq(0)").html(curNode.deptname);
    $(".state_item_active").attr("class","state_item");
    $(".state_item:eq(0)").attr("class","state_item_active");
     $("#org_left").hide();
     loadData();
}

obj.ErrorHint = showHint;

//显示错误提示
function showHint(row,col,text)
{
	        if(errHandle!=null)window.clearTimeout(errHandle);
	        var cell=obj.tabelobj.rows[row].cells[ getIndex(obj.tabelobj,col)];
	        error.style.display='';
	        error.style.top =obj.tabelobj.parentElement.offsetTop+ (cell.offsetHeight*(row+1));
	        error.style.left = cell.offsetLeft+5;
	        error.innerHTML = text; 
	        createInput(obj,obj.tabelobj.rows[row].cells[ getIndex(obj.tabelobj,col)]);
	        errHandle=window.setTimeout("error.style.display='none'",2000);
}

  //$.ligerDialog.waitting('正在加载数据中,请稍候...');
	function initOrgList()
	{
	   $error.show();
	   var departImg = "{{asset('bundles/fafatimewebase/css/zTreeStyle/img/diy/department.png')}}";
	   var departImg0 = "{{asset('bundles/fafatimewebase/css/zTreeStyle/img/diy/department0.png')}}";
	   try{
					   $.getJSON("{{path('JustsyBaseBundle_account_deptquery',{'network_domain':curr_network_domain})}}",function(dataNode){
							   var newData=[];
							   var reg = /v.*-\d{4,5}/;
							   for(var i=0;i<dataNode.length; i++)
							   {
							        if(dataNode[i].pId=="-10000" || dataNode[i].pId=="0")
							        {
							        	  curNode={deptid:dataNode[i].id,deptname:dataNode[i].name.replace(/<\/AB>/g,"&")};
							            newData.push({deptid:dataNode[i].id,
										                       deptname:dataNode[i].name.replace(/<\/AB>/g,"&"),
										                       pid:"-10000",
										                       open:true, iconOpen:departImg, iconClose:departImg0});
										  }
										  else if(reg.test(dataNode[i].id))
										  {
										  				continue;
										  }
							        else
							   			   newData.push({deptid:dataNode[i].id,deptname:dataNode[i].name,pid:dataNode[i].pId,open:false,icon:departImg0, iconOpen:departImg, iconClose:departImg0});
							   }
             		orgTree_dept.DataSource(newData);
             		orgTree_dept2.DataSource(newData);
	     					$("#dept_name").html("").append(makeSelect("部门名称","org_left","84px"));
	     					$("#state_id").html("").append(makeSelect("用户状态","state_list","60px"));
             		loadData();					   
					   });
	     }
	     catch(e)
	     {
	         alert(e)
	     }

	     //$.ligerDialog.closeWaitting();
	}
	
	   initOrgList();
		 loadRoleList();
		 loadAllStaffs();
	});
	
  function loadData(url)
  {
    //$("#txtempserach").val('');
		if(curNode==null) cur_dept="";
		else
		{  
				cur_dept = curNode.deptid;
				setControlValue("dept",curNode.deptname);			    
	  }
	  $error.show();
	  if(ajaxObj!=null) ajaxObj.abort();
    if(url==1) { //搜索
      url="{{path('JustsyBaseBundle_account_searchemp',{'network_domain':curr_network_domain})}}?deptid="+cur_dept+"&state="+$(".state_item_active").attr("value")+"&search="+$("#txtempserach").val();
    }else {
      $("#txtempserach").val('');
      url="{{path('JustsyBaseBundle_account_getdeptemp',{'network_domain':curr_network_domain})}}?deptid="+cur_dept+"&state="+$(".state_item_active").attr("value");
    }
		ajaxObj=$.getJSON(url,function(data){
		    obj.Init(null);
		    obj.dataSource=data;
		    obj.DataBind();
		    if(document.all)
		      $("#emplist table input[type='checkbox']").css({"margin-left":"0px","margin-top":"-2px"});
		    else
		      $("#emplist table input[type='checkbox']").css({"margin-left":"5px","margin-top":"-2px"});
		    $error.hide();
				//ToolButton.setDisable("disable_btn",null);
				ToolButton.setDisable("delete_btn",null);
				ToolButton.setDisable("leave_btn",null);
				ToolButton.setDisable("invite_btn",null);	
				ToolButton.setDisable("deptchange_btn",null);
				ToolButton.setDisable("save_edit",null);		    
	  });  
  }
	
	function makeSelect(text,listdiv,w)
	{
	    $("#"+listdiv).unbind("mouseleave").bind("mouseleave",function(event){
	        $(this).hide();
	    });
	    var html = [];
	    html.push("<div style='height:20px;border:1px solid #ABADB3;padding:1px;background-color: #FFFFFF;width: 90%;'>");
	    html.push(" <span style='float: left; display: block; width: "+w+"; overflow: hidden; white-space: nowrap;'>");
	    html.push(text);
	    html.push(" </span>");
	    html.push(" <span class='dropdown_btn' href='"+listdiv+"' >");
	    html.push("    <span class='topmenu_app_triangle' style='border-color: rgb(0, 0, 0) transparent transparent; border-width: 5px; float: none; left: 0px;'></span>");
	    html.push(" </span>");
	    html.push(" </div>");
	    return $(html.join(""));
	}
	var confirmWinTinmer=null, $import_hint = $("#import_hint"),$invite_hint=$("#invite_hint"),is_import_ing=false,is_invite_ing=false,isSubmit=false,isMoveDept=false;
	$(".dropdown_btn").live("click",function(event){
	   var $this = $(this);
	   var showDiv =$("#"+ $this.attr("href"));
	   var offset = $this.offset();
	   showDiv.css({"display":"block","top":offset.top+$this.height()+7,"left":offset.left-showDiv.width()+$this.width()+2});
	   event.stopPropagation();
	});	
	var action="", $doc_confirm = $("#doc_confirm"),btn_ok = $("#deleteDoc"),btn_cancel = $("#cancelDelete"),opthint = $(".deletehint");
	
	$("#delete_btn").bind("click",function(event){
	   if("disabled"==$(this).attr("disabled")) return;	
	   action = "delete";
	   if(confirmWinTinmer!=null) clearTimeout(confirmWinTinmer);
	   $doc_confirm.find(".doc_window_title span").html("&nbsp;&nbsp;帐号删除");
	   $doc_confirm.find(".doc_rd_confirm_text").html("确定要<b>删除</b>选择的人员吗？");
	   btn_ok.show();
	   btn_cancel.text("关闭");
	   $doc_confirm.show();
	});
	$("#disable_btn").bind("click",function(event){
	   if("disabled"==$(this).attr("disabled")) return;	
	   action = "disable";
	   $doc_confirm.find(".doc_window_title span").html("&nbsp;&nbsp;帐号禁用");
	   $doc_confirm.find(".doc_rd_confirm_text").html("确定要<b>禁用</b>选择的人员吗？");
	   $doc_confirm.show();
	});
	$("#leave_btn").bind("click",function(event){
	   if("disabled"==$(this).attr("disabled")) return;	
	   action = "leave";
	   if(confirmWinTinmer!=null) clearTimeout(confirmWinTinmer);
	   $doc_confirm.find(".doc_window_title span").html("&nbsp;&nbsp;人员离职[<a style='color:red'>谨慎操作!</a>]");
	   $doc_confirm.find(".doc_rd_confirm_text").html('<div style="text-align: center; line-height: 30px;">离职后会清除相关数据且不能恢复！</div><div style="line-height: 30px;">确定选择的人员<b>离职</b>吗？</div>');
     btn_ok.show();
     btn_cancel.text("关闭");
	   $doc_confirm.show();
	});
	$("#save_edit").bind("click",function(event){
		var employees=obj.getSaveValuesToString();
		$.post("{{path('JustsyBaseBundle_enterprise_setting_mar_employee_edit',{'network_domain':curr_network_domain})}}",{'saveValue':employees},function(d){
			if(d.s=='1'){
			
			}
			else{
				
			}
		});
		ToolButton.setDisable("save_edit",null);
	});	
	$("#deptchange_btn").bind("click",function(event){
		  $("#deptChangeHint").html("");
	    $("#dept_change").show();
	});
	$("#saveDeptChange").bind("click",function(event){
		  if(isMoveDept) return;
      var tmpcurNode = orgTree_dept2.getManager().getSelectedNodes();
      if(tmpcurNode==null || tmpcurNode.length<1) return;
      tmpcurNode = tmpcurNode[0];
      var account = obj.getSelectedValue("login_account");
      if(account=="") return;
      isMoveDept=true;
      $("#deptChangeHint").html("正在变更职务...");
      $.getJSON("{{path('JustsyBaseBundle_account_movetodept',{'network_domain':curr_network_domain})}}?staff="+account+"&deptid="+tmpcurNode.deptid,{},function(d){
      	  isMoveDept=false;
	        if(d.s==0)
	        {
	        	  $("#deptChangeHint").html(d.msg);
	            return;	
	        }
	        $("#deptChangeHint").html("职务变更成功!");
	        loadData();
	        setTimeout(function(){$("#dept_change").hide();},2000);
      });
	});	
	$("#cancelDeptChangeSave").bind("click",function(event){
	    $("#dept_change").hide();
	});
	//重新发送邀请
	$("#invite_btn").bind("click",function(event){
	   if("disabled"==$(this).attr("disabled")) return;	
	   var account = obj.getSelectedValue("login_account");
	   if(account=="" || isSubmit) return;
	   action = "invite";	
		 $doc_confirm.find(".doc_window_title span").html("&nbsp;&nbsp;邀请帐号");
		 $doc_confirm.find(".doc_rd_confirm_text").html("正在发送邀请...");
		 $doc_confirm.show();	      
		 btn_ok.hide();
		 ajaxObj=$.getJSON("{{path('JustsyBaseBundle_account_mployeemgr',{'network_domain':curr_network_domain})}}?action="+action+"&account="+account,function(d){
			       ajaxObj=null;
			       if(d.s=="0")
			            $doc_confirm.find(".doc_rd_confirm_text").html("错误:"+d.msg);
			       else
			       {
			       	    $doc_confirm.find(".doc_rd_confirm_text").html("邀请已成功发送！");
			       }
			       btn_cancel.text("关闭");
			       confirmWinTinmer=setTimeout(function(){$doc_confirm.hide();btn_ok.show();btn_cancel.text("关闭")},3000);
			});	   
	});		
	btn_ok.bind("click",function(){
		     var account = obj.getSelectedValue("login_account");
		     if(account=="" || isSubmit) return;
		     isSubmit=true;
		     btn_ok.css("color","#B7BABB");
		     btn_cancel.css("color","#B7BABB");
			   $.getJSON("{{path('JustsyBaseBundle_account_mployeemgr',{'network_domain':curr_network_domain})}}?action="+action+"&account="+account,function(d){
			       if(d.s=="0") opthint.html("错误:"+d.msg);
			       else
			       {
			       	    //opthint.html("员工离职成功！");
                  $("#emp_confirm").show();
                  $("#doc_confirm").hide();
			       	    loadData();
			       }
			       btn_ok.css("color","#000000");
			       btn_cancel.css("color","#000000");
			       isSubmit=false;
			       confirmWinTinmer=setTimeout(function(){$doc_confirm.hide();opthint.html("")},3000);
			   });
  });	
	btn_cancel.bind("click",function(){
			  $doc_confirm.hide();
			  if(ajaxObj!=null) ajaxObj.abort();
  });

	$(".state_item").live("click",function(event){
	    //根据状态进行人员查询
	    $(".state_item_active").attr("class","state_item");
	    $(this).attr("class","state_item_active");
	    $("#state_list").hide();
	    loadData();
	});
	$("#sel_all").bind("click",function(event){
	   if($(this).attr("checked")=="checked")
	   {
	      checkedRow(obj,"ALL");
	      if($(".state_item_active").attr("value")=="9") //未激活
	      {
	          	ToolButton.setEnable("delete_btn","#3366CC");
				      ToolButton.setEnable("invite_btn","#3366CC");
	      }
	   }
	   else
	   {
	      cancelCheckedRow(obj,"ALL"); 
	      if($(".state_item_active").attr("value")=="9") //未激活
	      {
	          	ToolButton.setDisable("delete_btn",null);
				      ToolButton.setDisable("invite_btn",null);
	      }
	   }
	});
	
	//单个邀请
	$("#menu_invite_btn").live("click",function(event){
	    var $this = $(this);
	    var showDiv =$("#invite_panel");
	    var offset = $this.offset();
	    showDiv.css({"display":"block","top":offset.top+$this.height()+5,"left":offset.left-showDiv.width()+$this.width()+2});
	    showDiv.show();
	});
	
		$("#invite_start").bind("click",function(){
	    if(is_invite_ing) return;
	    var acts = $.trim($("#invite_mails").val());
	    if(acts=="") return;
	    var sendMails = acts.split(/[,;]/g);

	    $invite_hint.html("正在发送邀请...");
	    $(this).css("color","#CCC");
	    $("#invite_close").css("color","#CCC");	    
	    is_invite_ing = true;	    
	    $.post("{{path('JustsyBaseBundle_invite_sendinvitation')}}",
	          {"acts":sendMails,"eno":"{{app.user.eno}}","invMsg":"","invRela":"0"},
	          function(d){
	          	$("#invite_start").css("color","#3366CC");
	            $("#invite_close").css("color","#3366CC");	
	            is_invite_ing=false;
	    	      if(d=="1")
	    	      {
	    	          	$invite_hint.html("邀请已发送成功");
	    	      }
	    	      else  $invite_hint.html("邀请发送失败");
	    	      setTimeout(function(){$invite_hint.html("")},2000);
	    });
	});
	
	$("#import_btn").live("click",function(event){
	    var $this = $(this);
	    var showDiv =$("#import_panel");
	    var offset = $this.offset();
	    showDiv.css({"display":"block","top":offset.top+$this.height()+5,"left":offset.left-showDiv.width()+$this.width()+2});
	    showDiv.show();
	});
	$("#import_start").bind("click",function(){
	    if(is_import_ing) return;
	    if($("#filedata").val()=="")
	    {
	    	 $import_hint.html("请选择数据文件");
	    	 return;
	    }
	    $import_hint.html("");
	    $(this).css("color","#CCC");
	    $("#import_close").css("color","#CCC");
	    $import_hint.html("正在导入...");
	    is_import_ing = true;
	    $("#frm_import").submit();
	});
	
	function import_callback(d)
	{
	   is_import_ing=false;
	   $("#import_start").css("color","#3366CC");
	   $("#import_close").css("color","#3366CC");	   
	   if(d.s=="1")
	   {
	   	   if(d.error_list.length==0)
	          $import_hint.html("导入成功");
	       else
	       {
	       	import_error_list = d.error_list;
	       	$import_hint.html("导入完成,但有 <a title='查看错误日志' style='color:blue' href='javascript:lookimport_error()'>错误</a>");
          $(".state_item[value='9']").trigger("click");
	       	return;
	       }
	       $("#state_list ul li").attr("class","state_item");
	       $("#state_list ul li[value='9']").attr("class","state_item_active");
	       //loadData();
         //加载导入结果
         $(".state_item[value='9']").trigger("click");
	   }
	   else
	   {
	      $import_hint.html("错误:"+d.message);
	   }
	   setTimeout(function(){$import_hint.html("")},2000);
  }
  var import_error_list=[];
  function lookimport_error()
  {
  	  $("#import_panel").hide();
  	  $("#errorlist").show();
  	  var t = [];
  	  for(var i=0;i<import_error_list.length; i++)
  	  {
  	  	 if(import_error_list[i].row!=null)
  	         t.push( "第"+import_error_list[i].row +"行："+import_error_list[i].msg);
  	     else
  	     	   t.push(import_error_list[i].name+"："+import_error_list[i].msg);
  	     t.push("<br>");
  	  }
  	  $("#errorlist .errorlist_text").html(t.join(""));
  }
  var oldsearch='';
  $("#txtempserach").bind('keyup', function(e) {
    var zval=$(this).val();
     if(e.which==13 && oldsearch!=zval){
      oldsearch=zval;
        loadData(1);
     }
  });
  $("#empsearch").bind('click',function(){
      loadData(1);
  });
 
 function saveaddemployee()
 {
 		if(!validate())return;
 		if($("#saveaddemployee").attr('saving')=='1')return;
 		$("#addemployee form").ajaxSubmit({
 			url:"{{path('JustsyBaseBundle_enterprise_setting_add_employee_noactive')}}",
 			dataType:'json',
 			success:function(d){
 				$("#saveaddemployee").attr('saving','0');
 				if(d.s=='1')
 				{
 					canceladdemployee();
 				}
 				else{
 					$("#saveaddemployee_status").text(d.m).css('color',"red").show().siblings('img').hide();
 				}
 			}	
 		});
 		$("#saveaddemployee_status").text("请稍候...").css('color',"#000").show().siblings('img').show();
 		$("#saveaddemployee").attr('saving','1');
 }
 function canceladdemployee()
 {
 		$("#addemployee").find("input[type='text']").val('');
 		$("#addemployee").find("input#sex_f").attr("checked","checked");
 		$("#addemployee").find("input#sex_m").attr("checked",false);
 		$("#addemployee").hide();
 		$("#saveaddemployee_status").text('').hide().siblings('img').hide();
 }
 function returnformathtml(accounts)
 {
 		var html=[];
 		for(var i=0;i<accounts.length;i++)
 		{
 			html.push("<div style='float:left;width:60px;margin-right:5px;margin-top:3px;height:22px;overflow:hidden;'><input login_account='"+accounts[i].login_account+"' type='checkbox'/>&nbsp;"+accounts[i].nick_name+"</div>");
 		}
 		return html.join('');
 }
 function saveprivcontroll(e)
 {
 		if(typeof(saveprivcontrollajax)!="undefined" && saveprivcontrollajax!=null)return;
 		var checkboxs=$("#privlist input:checkbox");
 		var onlist=[];
 		var offlist=[];
 		for(var i=0;i<checkboxs.length;i++)
 		{
 			if(!!$(checkboxs[i]).attr("checked"))
 				onlist.push($(checkboxs[i]).parent().attr("functionid"));
 			else
 				offlist.push($(checkboxs[i]).parent().attr("functionid"));
 		}
 		var functions=[$("#privlist li.privselected").attr('functioncode')];
 		saveprivcontrollajax=$.getJSON("{{path('JustsyBaseBundle_enterprise_setting_priv_controll')}}?roleid="+$("#privlist").attr("roleid")+"&functions="+functions+"&onlist="+onlist.join(',')+"&offlist="+offlist.join(','),function(d){
 			$(e).text('保存');
 			saveprivcontrollajax=null;
 			if(d.s=='1')
 			{
 				showSuccessBox();
 				$("#functionlist").hide();
 			}
 			else{
 				showErrBox(d.m);
 			}
 		});
 		$(e).text('保存中...');
 }
 function cancelprivcontroll()
 {
 		$("#privcontroll").hide();
 		$("#employeelist").html(null);
 }
 function validate()
 {
 		if($("#addemployee input[name='realName']").val()=="")
 		{
 			$("#saveaddemployee_status").text("姓名：不能为空！").css('color',"red").show().siblings('img').hide();
 			$("#addemployee input[name='realName']").focus();
 			return false;
 		}
 		if(!validEmail($("#addemployee input[name='account']").val()))
 		{
 			$("#saveaddemployee_status").text("邮箱：未填写或格式错误！").css('color',"red").show().siblings('img').hide();
 			$("#addemployee input[name='account']").focus();
 			return false;
 		}
 		return true;
 }
 function saveEmployeeEdit(d)
 {
 		ToolButton.setEnable("save_edit","#3366CC");
 }
 function loadRoleList(){
 	  $("#rolelistpage").html(null);
 	  $("#rolelistpage").append("");
 	  $.post("{{path('JustsyBaseBundle_enterprise_setting_get_customrole',{'network_domain':curr_network_domain})}}",{},function(d){
 	  	var html=[];
 	  	html.push('<div style="margin-top:5px"><span onclick="add_newrole()" style="cursor:pointer" title="添加新角色"><i class="icon-plus"></i>新角色</span></div>');
 	  	html.push('<table border="1" width="95%" >');
			html.push('<tr style="text-align: center; background-color: rgb(243, 243, 243);"><td>操作</td><td width="20%">角色名称</td><td width="30%">功能点</td><td width="40%">授权员工</td></tr>');
 	  	if(d.length){
 	  		allroles=d;
 	  		for(var i=0;i<d.length;i++){
 	  			html.push('<tr roleid="'+d[i].id+'" rolecode="'+d[i].code+'" style="text-align: center; "><td><i onclick=\'editRole("'+d[i].id+'")\' class="icon-edit" title="编辑角色信息" style="cursor:pointer"></i>&nbsp;<i onclick=\'delRole("'+d[i].id+'")\' class="icon-trash" title="删除该角色" style="cursor:pointer"></i></td><td width="20%">'+d[i].name+'</td><td width="30%"><a href="javascript:setrolefunction(0)">配置</a></td><td width="40%"><span class="someP"></span>【<a href=\'javascript:allocstaff("'+d[i].id+'")\'>授权</a>】</td></tr>');
 	  		}
 	  		html.push("</table>");
 	  	}
 	  	else{
 	  		html.push('</table>');
 	  		html.push('<div style="text-align:center;">暂时没有自定义角色</div>');
 	  	}
 	  	$("#rolelistpage").append(html.join(''));
 	  });
 }
 function saveRole(e){
 	 if($(e).attr("loading")=="1")return;
 	 var rolename=$("#rolenametxt").val();
 	 var rolecode=$("#rolecodetxt").val();
 	 if(rolename==""){
 	 		ajaxError("角色名称不能为空");
 	 		return;
 	 }
 	 var roleid=$("#roleidtxt").val();
 	 $(e).attr("loading","1");
 	 if(roleid==""){
 	 		$.post("{{path('JustsyBaseBundle_enterprise_setting_add_role',{'network_domain':curr_network_domain})}}",{"rolename":rolename,"rolecode":rolecode},function(d){
 	 			$(e).text("保存");
 	 			$(e).attr("loading","0");
 	 			if(d.s=="1"){
 	 				loadRoleList();
 	 				$("#newrole").hide();
 	 			}
 	 			else{
 	 				showErrBox(d.m);
 	 			}
 	 		});
 	 }
 	 else{
 	 	$.post("{{path('JustsyBaseBundle_enterprise_setting_edit_role',{'network_domain':curr_network_domain})}}",{"rolename":rolename,"rolecode":rolecode,"roleid":roleid},function(d){
 	 			$(e).text("保存");
 	 			$(e).attr("loading","0");
 	 			if(d.s=="1"){
 	 				loadRoleList();
 	 				$("#newrole").hide();
 	 			}
 	 			else{
 	 				showErrBox(d.m);
 	 			}
 	 		});
 	 }
 	 $(e).text("保存中...");
 }
 function editRole(roleid){
	var rolename=$("tr[roleid='"+roleid+"']").find("td:eq(1)").text();
	var rolecode=$("tr[roleid='"+roleid+"']").attr("rolecode");
	$("#rolenametxt").val(rolename);
	$("#roleidtxt").val(roleid);
	$("#rolecodetxt").val(rolecode);
	$("#newrole").show();
}
function delRole(roleid){
	if(confirm("确定要删除该角色吗？"))
	{
		$.post("{{path('JustsyBaseBundle_enterprise_setting_del_role',{'network_domain':curr_network_domain})}}",{"roleid":roleid},function(d){
			if(d.s=="1"){
				loadRoleList();
			}
			else{
				showErrBox(d.m);
			}
		});
	}
}
function setStaffRole(e){
	if($(e).attr("loading")=="1")return;
	var roleid=$("#stafflist").attr("roleid");
	var inputboxs=$("#stafflist input:checked");
	var staffs=[];
	for(var i=0;i<inputboxs.length;i++){
		staffs.push($(inputboxs[i]).parent().attr('login_account'));
	}
	$(e).attr("loading","1");
	$.post("{{path('JustsyBaseBundle_enterprise_setting_set_role_staff',{'network_domain':curr_network_domain})}}",{"roleid":roleid,"staffs":staffs.join(',')},function(d){
		$(e).text("保存");
		$(e).attr("loading","0");
		if(d.s=='1'){
			showSuccessBox();
		}
		else{
			showErrBox(d.m);
		}
	});
	$(e).text("保存中...");
}
function setRoleStaff(e){
	if($(e).attr("loading")=="1")return;
	var login_account=$("#rolelist").attr("login_account");
	var roles=[];
	var inputboxs=$("#rolelist input:checked");
	for(var i=0;i<inputboxs.length;i++){
		roles.push($(inputboxs[i]).parent().attr('roleid'));
	}
	$(e).attr("loading","1");
	$.post("{{path('JustsyBaseBundle_enterprise_setting_set_staff_role',{'network_domain':curr_network_domain})}}",{"login_account":login_account,"roles":roles.join(',')},function(d){
		$(e).text("保存");
		$(e).attr("loading","0");
		if(d.s=='1'){
			showSuccessBox();
		}
		else{
			showErrBox(d.m);
		}
	});
	$(e).text("保存中...");
}
function loadStaffRoleMgr()
{
	if($("#staffrolemgr").attr('load')=='1')return;
	if(typeof(pageObj)=="undefined" || pageObj==null){
		pageObj=new Pagination();
		pageObj.init({
			container:[$("#fenye")[0]],
			totalcount:0,
			pagesize:15,
			onBntClick:function(pageindex){
				//加载页面方法
				loadStaffList(pageindex);
			}
		});
	}
	$("#staffrolemgr").hide();
	loadStaffList(1);
	$("#staffrolemgr").attr('load','1');
}
function loadStaffList(pageindex)
{
	$.post("{{path('JustsyBaseBundle_enterprise_setting_set_get_staffs',{'network_domain':curr_network_domain})}}",{"pageindex":pageindex,"searchtext":$("#searchStaffText").attr("searchtext")},function(d){
		if(d){
			$("#staffrolemgr").show();
			var html=[];
			html.push('<table border="1" width="100%" >');
			html.push('<tr style="text-align: center; background-color: rgb(243, 243, 243);"><td width="30%">帐号</td><td width="30%">姓名</td><td width="40%">当前角色</td></tr>');
			for(var i=0;i<d.rows.length;i++){
				html.push('<tr style="text-align: center; "><td width="20%">'+d.rows[i].login_account+'</td><td width="40%">'+d.rows[i].nick_name+'</td><td width="40%">【<A href=\'javascript:changesaffrole("'+d.rows[i].login_account+'")\'>查看/更改</A>】</td></tr>');
			}
			html.push("</table>");
			$("#stafflistpage").html(html.join(''));
			pageObj.setTotalCount(parseInt(d.count));
		}
	});
}
function searchStaff(){
	var searchText=$("#searchStaffText").val();
	$("#searchStaffText").attr("searchtext",searchText);
	pageObj.init({
			container:[$("#fenye")[0]],
			totalcount:0,
			pagesize:15,
			onBntClick:function(pageindex){
				//加载页面方法
				loadStaffList(pageindex);
			}
		});
		loadStaffList(1);
}
</script>
{% endblock %}