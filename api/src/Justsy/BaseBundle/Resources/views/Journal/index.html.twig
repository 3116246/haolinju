{% extends 'JustsyBaseBundle::master2c.html.twig' %}
{% block stylesheets %}
 <style type="text/css">
 .L_T{float:left;width:100%}
 .L_T_image{overflow:hidden;float:left; width:64px;height:64px;background-image:url({{asset('bundles/fafatimewebase/images/appIcon/notes.png')}});}
 .L_T_name{color:#0088CC; margin-top:33px;margin-left:10px;font-family: 微软雅黑;font-size: 20px;font-weight: bold;}
 .R_T{float:left;width:100%;height: 30px;padding-left: 20px;padding-top: 15px;}
 #searchinput2{
    float:left;
    font-size:12px;
    margin:0px;
    width:190px;
    margin-left:-10px;
    background: url({{asset('bundles/fafatimewebase/images/icon.png')}}) no-repeat scroll -2px -29px transparent;
    height: 14px;
  }
 .twomainright{padding-top:0px;}
 .app_title{width:100%;height:48px;line-height:48px;text-align:left;color:#5A5A5A;padding-left:12px;padding-bottom:10px;vertical-align:middle;}
 .journal_wrapper{width:100%;height:600px;position:relative;background-color:white;}
 .journal_left{width:40%;height:auto;float:left;overflow:hidden;margin-right:5px;}
 .journal_right{width:56%;height:auto;float:left;border:1px solid #ccc;overflow:hidden;position:relative;}
 .clearboth{width:0px;height:0px;clear:both;display:hidden;}
 .search_box{width:90%;height:30px;line-height:30px;margin:0 auto;border:#ccc 1px solid;}
  #journal_left_title{width:90%;height:350px;overflow:hidden;margin:0 auto;margin-top:10px;border:#ccc 0px solid;}
 .title_box{width:100%;height:auto;margin:0 auto;border:none;list-style:none outside none;}
 .title_box_li{width:100%;height:30px;line-height:30px;list-style:none outside none;border-bottom:#ccc dashed 1px;margin:0px;padding:0px;overflow:hidden;}
 .login_account_div{width:auto;height:30px;line-height:30px;margin:0 auto;border-bottom:#ccc 1px solid;text-align:center;}
 .journal_content{width:auto;height:180px;margin:0 auto;position:relative;}
 .journal_left_title{width:auto;height:312px;}
 .button_ul{width:100%;height:30px;line-height:30px;list-style:none outside none;cursor:pointer;text-align:center;position:absolute;left:0px;bottom:0px;border-top:#ccc solid 1px;margin-left:0px;}
 .button_ul li{width:50px;height:30px;line-height:30px;list-style:none outside none;float:right;}
 .pop_div{width:600px;height:300px;z-index:999;position:absolute;left:0px;top:50px;text-align:center;vertical-align:middle;background:white;}
 .input_img_div{width:16px;height:30px;line-height:30px;overflow:hidden;float:left;}
 .input_div{width:240px;height:30px;line-height:30px;overflow:hidden;float:left;border:none;}
 .input_div input{width:240px;border:none;height:24px;line-height:24px;border-left:none;vertical-align:middle;margin-left:-1px;}
 .form-horizontal{width:414px;overflow:hidden;}
 .control-group{width:100%;text-align:left;margin-bottom:0px;height:131px;overflow:hidden;}
 .control-label{width:80px;}
 .controls{width:100%;text-align:center;}
 .controls input,.controls textarea{width:300px;}
 .help-line{width:100px;overflow:hidden;}
 .form-actions{width:100%;text-align:left;height:38px;line-height:38px;margin-top:0px;padding-top:0px;}
 .new_date_set{float:left;margin-left:5px;margin-top:2px;overflow:hidden;left:0px;top:0px;height:24px}
 .new_date_set img{position:relative;left:0px;top:0px;cursor:pointer;width:24px;height:24px;float:left;}
 .new_date_set_input1{z-index:1000;height:12px;width:12px;margin-left:-25px;left:0px;top:0px;z-index:999;cursor:pointer;opacity:0;filter:alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";  }
 .new_date_set_input2{z-index:1000;height:12px;width:36px;margin-top:1px;margin-left:-5px;position:absolute;left:0px;top:0px;z-index:999;cursor:pointer;opacity:0;filter:alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)"; }
 .datetime{margin-top:-3px;float:left;}
 .settime_list{z-index:2000;position:absolute;width:430px;border:1px solid #CCC;box-shadow:0 3px 7px rgba(0, 0, 0, 0.3);background-color:white;border-radius:4px 4px 4px 4px}
 .settime_list select{padding:0;width:50px;height:18px;line-height:0}
 .settime_list tr{width:100%}
 .settime_list span{margin-left:5px;margin-left:3px\9;}
 </style>
{% endblock %}
{% block main_content_left %}
    {% render  "JustsyBaseBundle:CPerBaseInfo:index" with {"name" : "foo"} %}
		{% include 'JustsyBaseBundle:EnterpriseHome:leftmenu.html.twig' with {'network_domain' : curr_network_domain} %}
		{% include 'JustsyBaseBundle:EnterpriseHome:leftmenu_download.html.twig' %}
{% endblock %}
{% block main_content_center%}
<div style="width:100%;height: 70px;">
   <div class="L_T">
   	  <div class="L_T_image"></div>
   		<div class="L_T_name">我的备忘录</div>
   </div>
   <div style="border-bottom: 1px solid #0088CC;height:5px;width:100%;float: left;"></div>
</div>

<div>
    <div class="journal_left modal" id="journal_left" data-backdrop=false style=" height: 400px;margin-left: -245px;margin-top: -160px;width: 320px;" show=false>
      <div class="R_T">
      	<input id="searchinput2" class="addr_searchinput"  type="text" placeholder="输入查找的内容" value=""/>
      	<div class="addr_search topsearch_button" style="height: 18px;left: 170px;position: relative;top: 2px;width: 20px;" onclick="query_journal(0)"></div>
      </div>
	    <div id="journal_left_title"  ></div>
    </div>
	 <div class="journal_right modal" id="journal_new" data-backdrop=false style=" height: 200px;margin-left: 25px;margin-top: 40px;width: 250px;" show=false>
	 	  <div class="login_account_div">
	 	    <div class="new_date_set timer">
	 	  	<img src="{{ asset('bundles/fafatimewebase/images/history.png')}}" >
	 	  	<div style="display:none;" class="datetime">
	 	  	<div style="height: 15px; margin-top: -6px; margin-left: -43px;color:green"></div>
   	    <div style="font-size: 16px; margin-top: -3px; overflow: hidden; height: 22px; font-weight: bold;font-family: 微软雅黑;color:green"></div>
   	    </div>
	 	  	<input type="text" style="height:12px;"  class="Wdate new_date_set_input1" onclick="set_time('journal_new')" value="" name="end_time" title="设置备忘日期" >
	 	  	</div>
	 	  	<div class="new_date_set bell">
	 	  	<img src="{{ asset('bundles/fafatimewebase/images/bell.png')}}" >
	 	  	<img style="display:none;width:12px;height:12px;border:none;z-index:999;left:12px;top:-12px;" class="gou" src="{{ asset('bundles/fafatimewebase/images/zq.png')}}">
	 	  	<div style="display:none;" class="datetime">
	 	  	<div style="height: 15px; margin-top: -6px; margin-left: -43px;color:green"></div>
   	    <div style="font-size: 16px; margin-top: -3px; overflow: hidden; height: 22px; font-weight: bold;font-family: 微软雅黑;color:green"></div>
   	    </div>
	 	  	<input type="text" style="height:12px;"  class="Wdate new_date_set_input1" onclick="set_bell(this,'journal_new')" value="" name="bell_time" title="设置提醒时间" >
	 	  	</div>
	 	  	<div style="float:right;width:150px;">
	 	  	<a style="float:left;margin-left:0">新的备忘</a>
	 	  	<a style="float:left;margin-left:2px;color:blue;cursor:pointer;">
	 	  	  <img src="{{ asset('bundles/fafatimewebase/images/edit_add.png')}}"  style="width:16px;height:16px;border:none;" />
	 	  	</a>
	 	  	<a style="color:blue;cursor:pointer;float:right;margin-right:8px;">
	 	  	  <img src="{{ asset('bundles/fafatimewebase/images/save_dept.png')}}" onclick="update_journal('new')"  style="width:16px;height:16px;border:none;" />
	 	  	</a>
	 	   </div>
	 	  </div>
	 	  <div class="journal_content" id="journal_content" style="padding:1px">
	 	  	 <textarea class="input-xlarge" id="content" name="content" rows="4" style="width:234px;height:116px"></textarea>
	 	  </div>
		  <ul class="button_ul">
		 	   <li style="width:100%;float:left;margin-left:5px;"><span style="float:left;font-size:12px;color:#0088CC;font-weight:700;">当前状态:</span><span style="float:left;margin-left:5px;" class="log">新增。</span></li>
		  </ul>	 	  
	 </div>
</div>
<div id="journal_detail" status="readonly" class="journal_right modal" data-backdrop=false style="display:none;clear:both;position:absolute;position:absolute;z-index:2000; height: 200px;margin-left: 25px;margin-top: 40px;width: 250px;">
	 	  <div class="login_account_div">
	 	  	<input class="detail_id" type="hidden" value=""/>
	 	    <div class="new_date_set timer">
	 	  	<img style="display:none;" src="{{ asset('bundles/fafatimewebase/images/history.png')}}" >
	 	  	<div class="datetime">
	 	  	<div style="height: 15px; margin-top: -6px; margin-left: -43px;color:green"></div>
   	    <div style="font-size: 16px; margin-top: -3px; overflow: hidden; height: 22px; font-weight: bold;font-family: 微软雅黑;color:green"></div>
   	    </div>
	 	  	<input type="text" style="height:12px;"  class="Wdate new_date_set_input2" onclick="set_time('journal_detail')" value="" name="end_time" title="">
	 	  	</div>
	 	  	<div class="new_date_set bell">
	 	  	 <input type='hidden' value='' class='hid_bell_time'/>
	 	  	<img src="{{ asset('bundles/fafatimewebase/images/bell.png')}}" >
	 	  	<img style="display:none;width:12px;height:12px;border:none;z-index:999;left:12px;top:-12px;" class="gou" src="{{ asset('bundles/fafatimewebase/images/zq.png')}}">
	 	  	<div style="display:none;" class="datetime">
	 	  	<div style="height: 15px; margin-top: -6px; margin-left: -43px;color:green"></div>
   	    <div style="font-size: 16px; margin-top: -3px; overflow: hidden; height: 22px; font-weight: bold;margin-left:-2px;font-family: 微软雅黑;color:green"></div>
   	    </div>
	 	  	<input type="text" style="height:12px;"  class="Wdate new_date_set_input1" onclick="set_bell(this,'journal_detail')" value="" name="bell_time" title="设置提醒时间" >
	 	  	</div>
	 	  	<div style="width:150px;float:right;">
	 	  	<a style="margin-left:0;float:left;">备忘详情</a>
	 	  	<div class="journal_bar" style="float:right;width:80px">
	 	  	<a style="color:blue;cursor:pointer;">
	 	  	  <img style="display:none;" src="{{ asset('bundles/fafatimewebase/images/save_dept.png')}}" onclick="update_journal('edit')" title="保存"  style="width:16px;height:16px;border:none;" />
	 	  	  <img src="{{ asset('bundles/fafatimewebase/images/save_dept_grey.gif')}}" title="保存"  style="width:16px;height:16px;border:none;" />
	 	  	</a>
	 	  	<a style="color:blue;cursor:pointer;">
	 	  	  <img src="{{ asset('bundles/fafatimewebase/images/pencil.png')}}" title="编辑" onclick="showEditCard(this)"  style="width:16px;height:16px;border:none;" />
	 	  	  <img style="display:none;" src="{{ asset('bundles/fafatimewebase/images/pencil_grey.png')}}" title="编辑"  style="width:16px;height:16px;border:none;" />
	 	  	</a>
	 	  	<a style="color:blue;cursor:pointer;margin-right:10px;">
	 	  	  <img src="{{ asset('bundles/fafatimewebase/images/edit_remove.png')}}" onclick="delete_journal()" title="删除"  style="width:16px;height:16px;border:none;" />
	 	  	</a>
	 	  </div>
	 	  </div>
	 	  </div>
	 	  <div class="journal_content" id="journal_content" style="padding:1px">
	 	  	 <textarea class="input-xlarge" readonly='readonly' id="content" name="content" rows="4" style="width:234px;height:116px"></textarea>
	 	  </div>
	 	  <ul class="button_ul">
		 	   <li style="width:100%;float:left;margin-left:5px;"><span style="float:left;font-size:12px;color:#0088CC;font-weight:700;">当前状态:</span><span style="float:left;margin-left:5px;" class="log">只读。</span><img title="关闭" style="float:right;margin-top:5px;margin-right:10px;height:24px;width:24px;" onclick="$('#journal_detail').hide()" src="{{ asset('bundles/fafatimewebase/images/close.jpg')}}"/></li>
		  </ul>
</div>
<div class='settime_list1' style="display:none">
	<div style='width:100%;text-align:center;color:#0088CC;border-bottom:1px solid #CCC;color:#0088CC'>提醒设置</div>
	<div style="height:150px;width:100%">
	<table class='list'>
		<tr><td style='width:40px'>闹钟:</td><td style='width:60px;text-align:center;'><input type='text' value='16:50' key='everyday' onkeyup='setselect(this)' style='font-size:12px;width:34px;height:16px;margin-top:8px;padding:0;background-color:#0088BB'/></td></tr>
		<tr style='border-top:1px dashed #CCC;'><td style='width:40px'>方式:</td><td style='width:60px;text-align:center;'><input type='text' value='每天' key='everyday' onkeyup='setselect(this)' style='font-size:12px;width:34px;height:16px;margin-top:8px;padding:0;background-color:#0088BB'/><select onchange="setinput(this)" style='z-index:999;margin-left:-36px;margin-top:8px;width:34px;size:0;height:15px;font-size:12px;opacity:0;filter:alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";'>
			<option value='everyday'>每天</option>
			<option value='everyweek'>每周</option>
			<option value='everymonth'>每月</option>
			<option value='onetime'>一次</option>
			<option value='user-defined'>自定义</option>
			</select></td></tr>
	</table>
 </div>
	<table style='width:100%;border-top:1px solid #CCC;'><tr style='width:100%'><td style='width:100%;color:#0088CC;padding-left:3px;padding-right:3px;'><span onclick="$('#bell_sheet').remove()" style="float:left;font-size:12px;color:#0088CC;cursor:pointer;">取消</span><span onclick="saveBellSheet()" style="float:right;font-size:12px;color:#0088CC;cursor:pointer;">保存</span></td></tr></table>
</div>
<div class='settime_list' style="display:none">
	<div style='width:100%;text-align:center;color:#0088CC;border-bottom:1px solid #CCC;color:#0088CC'>提醒设置</div>
	<div style="width:100%">
		<table class='time_list' style="width:100%">
			<tr><td style="text-align:right;padding-top:10px;width:80px;"><select class='weekdate' onchange="weekdate(this)"><option value='week'>按周</option><option value='date'>按日 期<option></select>:</td><td>
				<div class='setweek'><span><input value='1' style='line-height:8px;margin-top:-2px;' type='checkbox' /><span>周一</span></span><span><input value='2' style='line-height:8px;margin-top:-2px;' type='checkbox' /><span>周二</span></span><span><input value='3' style='line-height:8px;margin-top:-2px;' type='checkbox' /><span>周三</span></span><span><input style='line-height:8px;margin-top:-2px;' value='4' type='checkbox' /><span>周四</span></span><span><input value='5' style='line-height:8px;margin-top:-2px;' type='checkbox' /><span>周五<span></span><span><input value='6' style='line-height:8px;margin-top:-2px;' type='checkbox' /><span>周六</span></span><span><input value='7' style='line-height:8px;margin-top:-2px;' type='checkbox' /><span>周七</span></span></div>
			<div style='display:none;' class='setdate'><span><select onchange='selectmonth(this)' class='setmonth'><option value=''></option>
																					<option value='1'>1</option>
																					<option value='2'>2</option>
																					<option value='3'>3</option>
																					<option value='4'>4</option>
																					<option value='5'>5</option>
																					<option value='6'>6</option>
																					<option value='7'>7</option>
																					<option value='8'>8</option>
																					<option value='9'>9</option>
																					<option value='10'>10</option>
																					<option value='11'>11</option>
																					<option value='12'>12</option></select><span>月</span></span><span><select class='setdays'><option value=''></option><option value='1'>1</option>
																																																				<option value='2'>2</option>
																																																				<option value='3'>3</option>
																																																				<option value='4'>4</option>
																																																				<option value='5'>5</option>
																																																				<option value='6'>6</option>
																																																				<option value='7'>7</option>
																																																				<option value='8'>8</option>
																																																				<option value='9'>9</option>
																																																				<option value='10'>10</option>
																																																				<option value='11'>11</option>
																																																				<option value='12'>12</option>
																																																				<option value='13'>13</option>
																																																				<option value='14'>14</option>
																																																				<option value='15'>15</option>
																																																				<option value='16'>16</option>
																																																				<option value='17'>17</option>
																																																				<option value='18'>18</option>
																																																				<option value='19'>19</option>
																																																				<option value='20'>20</option>
																																																				<option value='21'>21</option>
																																																				<option value='22'>22</option>
																																																				<option value='23'>23</option>
																																																				<option value='24'>24</option>
																																																				<option value='25'>25</option>
																																																				<option value='26'>26</option>
																																																				<option value='27'>27</option>
																																																				<option value='28'>28</option>
																																																				<option value='29'>29</option>
																																																				<option value='30'>30</option>
																																																				<option value='31'>31</option></select><span>日</span></span></div>
				</td></tr>
			<tr><td style="text-align:right;width:80px;vertical-align:top;">时间:</td><td><span><select class='list_h'><option value=''></option>
																					<option value='1'>1</option>
																					<option value='2'>2</option>
																					<option value='3'>3</option>
																					<option value='4'>4</option>
																					<option value='5'>5</option>
																					<option value='6'>6</option>
																					<option value='7'>7</option>
																					<option value='8'>8</option>
																					<option value='9'>9</option>
																					<option value='10'>10</option>
																					<option value='11'>11</option>
																					<option value='12'>12</option>
																					<option value='13'>13</option>
																					<option value='14'>14</option>
																					<option value='15'>15</option>
																					<option value='16'>16</option>
																					<option value='17'>17</option>
																					<option value='18'>18</option>
																					<option value='19'>19</option>
																					<option value='20'>20</option>
																					<option value='21'>21</option>
																					<option value='22'>22</option>
																					<option value='23'>23</option>
																					<option value='24'>24</option></select><span>时</span></span><span><select class='list_m'><option value=''></option><option value='10'>10</option>
																																																				<option value='20'>20</option>
																																																				<option value='30'>30</option>
																																																				<option value='40'>40</option>
																																																				<option value='50'>50</option></select><span>分</span></span></td></tr>
			<tr><td style="text-align:right;width:80px;">提醒方式:</td><td class='list_type'><span><input value='1' checked=true name="ffff" style="margin-top: -2px;" type='radio'/><span>一次</span></span><span><input value='0' name="ffff" style="margin-top: -2px;" type='radio'/><span>重复</span></span><span><input value='' name="ffff" style="margin-top: -2px;" type='radio'/><span>自定义</span></span><span style='display:none' class='manytimes'><input style='width:20px;height:10px;margin:0;margin-top:-2px;' type='text'/>次</span></td></tr>
		</table>
	</div>
	<table style='width:100%;border-top:1px solid #CCC;'><tr style='width:100%'><td style='width:100%;color:#0088CC;padding-left:3px;padding-right:3px;'><span onclick="$('#bell_sheet').remove()" style="float:right;font-size:12px;color:#0088CC;cursor:pointer;">取消</span><span onclick="saveBellSheet()" style="float:right;font-size:12px;color:#0088CC;cursor:pointer;">确定</span></td></tr></table>
</div>
<input type="hidden" value="{{path('JustsyBaseBundle_journal_title',{'network_domain':curr_network_domain})}}?pageindex=1" id="referer"/> 
{% endblock %}
{% block javascripts %}
<script type="text/javascript">
	function saveBellSheet()
	{
		var id="bell_sheet";
		var month='';
		var day='';
		var h='';
		var m='';
		var w='';
		var time='';
		if($("#"+id+" .weekdate").val()=='week')
		{
			var item=$("#"+id+" .setweek input[type='checkbox']");
			var len=$("#"+id+" .setweek input[type='checkbox']").length;
			for(var i=0;i<len;i++)
			{
				if(item[i].checked){
					w+='|'+$(item[i]).val();
				}
			}
			w=w.substr(1,w.length);
		}
		else{
			month=$("#"+id+' .setmonth').val();
			day=$("#"+id+' .setdays').val();
		}
	  h=$("#"+id+" .list_h").val();
	  m=$("#"+id+" .list_m").val();
	  var e_type_item=$("#"+id+" .list_type input[type='radio']");
	  for(var j=0;j<3;j++)
	  {
	  	if(e_type_item[j].checked){
	  		time=$(e_type_item[j]).val();
	  		if(time=='')
	  		{
	  			time=$('#'+id+' .manytimes input[type="text"]').val();
	  		}
	  	}
	  }
	  if(time==''){
	  	alert('请设置次数');
	  	return;
	  }
	  var bell_time=month+','+day+','+h+','+m+','+w+','+time;
	  if((month+','+day+','+h+','+m+','+w).replace(/,/g,'')!=''){
	  	$("#"+$("#bell_sheet").attr('for')+" .hid_bell_time").val(bell_time);
	  	$("#"+$("#bell_sheet").attr('for')+" .bell .Wdate").val(bell_time);
 	 		$("#"+$("#bell_sheet").attr('for')+" .bell .Wdate").css('margin-left','-32px');
 	 		$("#"+$("#bell_sheet").attr('for')+" .gou").show();
	  }
	  else{
	  	$("#"+$("#bell_sheet").attr('for')+" .gou").hide();
	  	$("#"+$("#bell_sheet").attr('for')+" .bell .Wdate").val('');
 	 			$("#"+$("#bell_sheet").attr('for')+" .bell .Wdate").css('margin-left','-25px');
 	 			$("#"+$("#bell_sheet").attr('for')+" .bell .Wdate").attr('title','设置提醒时间');
	  }
	  $("#bell_sheet").remove();
	  
	}
	$(document).ready(function(){
	});
	function weekdate(e)
	{
		if($(e).val()=='week'){
			$(e).parent().siblings('td').children('.setweek').show();
			$(e).parent().siblings('td').children('.setdate').hide();
			$("#bell_sheet .setdate select").val("");
		}
		else{
			$(e).parent().siblings('td').children('.setdate').show();
			$(e).parent().siblings('td').children('.setweek').hide();
			$("#bell_sheet .setweek input:checkbox").attr('checked',false);
		}
	}
	function selectmonth(e)
	{
	  var month=$(e).val();
	  var runmonth="01,03,05,07,08,10,12";
	  var unrunmonth="04,06,09,11";
	  var twomonth="02";
	  if(runmonth.indexOf(month)!=-1)
	  {
	  	$('.setdays').children("option[value='30']").show();
	  	$('.setdays').children("option[value='31']").show();
	  }
	  else if(twomonth==month)
	  {
	  	$('.setdays').children("option[value='30']").hide();
	  	$('.setdays').children("option[value='31']").hide();
	  }
	  else
	  {
	  	$('.setdays').children("option[value='30']").show();
	  	$('.setdays').children("option[value='31']").hide();
	  }
	}
	function setinput(e)
	{
		if($(e).val()=='user-defined'){
			$(e).siblings('input').focus();
			$(e).siblings('input').val('');
			$(e).siblings('input').blur(function(){
				
			});
			$(e).hide();
			return;
		}
		$(e).siblings('input').val($(e).find('option:selected').text());
		$(e).siblings('input').attr('key',$(e).val());
	}
	function setselect(e)
	{
	}
	function showLOG(e)
	{
		if(typeof(log_timer)!='undefined')clearTimeout(log_timer);
		var text=typeof(arguments[1])!='undefined'?arguments[1]:'';
		if(text==''){
			$(e).show();
			$(e).siblings('.log_add').remove();
			return;
		}
		var timeout=typeof(arguments[2])!='undefined'?arguments[2]:true;
		$(e).hide();
		$(e).siblings('.log_add').remove();
		$(e).after("<span style='float:left;margin-left:5px;' class='log_add'>"+text+"</span>");
		if(timeout==true){
			log_timer=setTimeout(function(){
				$(e).siblings('.log_add').remove();
				$(e).show();
				},3000);
		}
	}
	function getDateTime(date)
	{
		return date.getFullYear()+
 	 	                 "-"+((date.getMonth()+1)>9?(date.getMonth()+1):("0"+(date.getMonth()+1)))+
 	 	                 "-"+(date.getDate()>9?date.getDate():("0"+date.getDate()))+
 	 	                 " "+(date.getHours()>9?date.getHours():("0"+date.getHours()))+
 	 	                 ":"+(date.getMinutes()>9?date.getMinutes():("0"+date.getMinutes()));
	}
	function parseDateTime(date)
	{
		var year=date.match(/\d{4}/)[0];
		var month=date.match(/\d{2}/g)[0];
		var day=date.match(/\d{2}/g)[1];
		var hours=date.match(/\d{2}/g)[2];
		var minutes=date.match(/\d{2}/g)[3];
		return new Date(year,month,day,hours,minutes);
	}
	function set_bell(e,id)
	{
		if(id=='journal_detail')
		{
			if($("#"+id).attr('status')!='edit')return;
		}
		if($("#bell_sheet").length>0)$("#bell_sheet").remove();
		var e_top=$(e).offset().top;
		var e_left=$(e).offset().left;
		var e_height=e.offsetHeight;
		var bellsheet_x=e_left+$(document).scrollLeft();
		var bellsheet_y=e_top+e_height+$(document).scrollTop();
		$(".settime_list").after("<div id='bell_sheet' for='"+id+"' class='settime_list'>"+$(".settime_list").html()+"</div>");
		$("#bell_sheet").css({'left':bellsheet_x,'top':bellsheet_y});
		$("input[name='ffff']").click(function(){
			if($(this).siblings('span').text()=='自定义'){
				$('.manytimes').show();
				$('.manytimes input').val("");
			}
			else{
				$('.manytimes').hide();
			}
		});
		var bell_time=$(e).val();
		if(bell_time=='')return;
		var item=bell_time.split(',');
		var month=item[0];
		var day=item[1];
		var h=item[2];
		var m=item[3];
		var w=item[4].split('|');
		var time=item[5];
		$('#bell_sheet .setmonth').val(month);
		$('#bell_sheet .setdays').val(day);
		$("#bell_sheet .list_h").val(h);
		$("#bell_sheet .list_m").val(m);
		if(time!=0 && time!=1){
			$("#bell_sheet .list_type [value='']:radio").attr('checked',true);
			$('#bell_sheet .manytimes input[type="text"]').val(time);
			$('#bell_sheet .manytimes').show();
		}
		else{
			$("#bell_sheet .list_type [value='"+time+"']:radio").attr('checked',true);
		}
		for(item in w)
		{
			$("#bell_sheet .setweek [value='"+w[item]+"']:checkbox").attr('checked',true);
		}
		if(w=='')
		{
			$("#bell_sheet .weekdate").val('date');
			$("#bell_sheet .setweek").hide();
			$("#bell_sheet .setdate").show();
		}
	}
	function set_time(id)
	{
		if(id=='journal_detail')
		{
			if($("#"+id).attr('status')!='edit')return;
		}
		var date=new Date();
 	 	var min_datetime=getDateTime(date);
 	 	var max_datetime=getDateTime(new Date(Date.parse(date)+30*24*60*60*1000));
		WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',maxDate:max_datetime,minDate:min_datetime,onpicked:function(){
			var datetime=$("#"+id+" .timer").children(".Wdate").val();
			var date=datetime.split(" ")[0];
			var time=datetime.split(" ")[1];
				$("#"+id+" .timer .datetime").children("div:first").text(date);
				$("#"+id+" .timer .datetime").children("div:last").text(time);
				$("#"+id+" .timer .datetime").show();
				$("#"+id+" .timer").children("img").hide();
				$("#"+id+" .timer .Wdate").removeClass('new_date_set_input1');
				$("#"+id+" .timer .Wdate").addClass('new_date_set_input2');
				$("#"+id+" .timer .Wdate").attr('title',datetime);
		},oncleared:function(){
			  $("#"+id+" .timer .datetime").hide();
			  $("#"+id+" .timer").children("img").show();
			  $("#"+id+" .timer .Wdate").removeClass('new_date_set_input2');
				$("#"+id+" .timer .Wdate").addClass('new_date_set_input1');
				$("#"+id+" .timer .Wdate").css('height','12px');
				$("#"+id+" .timer .Wdate").attr('title','设置备忘时间');
	  }});
	}
	function showEditCard(e)
	{
		var id= $("#journal_detail .detail_id").val();
		if(id!=''){
			$("#journal_detail textarea").attr('readonly',false);
			$("#journal_detail").attr('status','edit');
			$(e).hide();
			$(e).siblings().show();
			$(e).parent().siblings("a:first").children("img:last").hide();
			$(e).parent().siblings("a:first").children("img:first").show().css({'width':'16px','height':'16px'});
			$("#journal_detail .log").text("编辑。");
		}
	}
	 $(document).ready(function(){
	   view_title(1,"");
	   //view_content("{{frist_journal_id}}");
	   $("#searchinput2").keydown(function(event)
	         {
	         	 var event=event||window.event;
	         	 if(13 == event.keyCode)
	         	 {
	         	 	 query_journal(0);
	         	 }
	         	 return;
	   			 }
	   );
	 });
	  $("textarea").blur(function(){
	   var content=$(this).val();
	   var pattern=/\s*\S{1,}\s*/;
	   if(!pattern.test(content))
	   {
	   	$(this).siblings("span").text("日志内容不能为空!");
		 	$(this).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");
		 	$(this).siblings("img").show();
		 	$(this).focus();
	   }
	   else
	   {
	   	$(this).siblings("span").text("");
	   	$(this).siblings("img").hide();
	   }
	  });
	 function view_title(pageindex,q)
	 {
	 	 $("#journal_left_title").empty();
	 	 var url="{{ path('JustsyBaseBundle_journal_title',{'network_domain':curr_network_domain})}}?pageindex="+pageindex+"&q="+q;
	 	 LoadComponent("journal_left_title",url);
	 	 $("#referer").val(url);
	 }
	 function view_content(_id,content)
	 {
//	 	 var date= $("#"+id).children("span:first").children("div:first").text();
//	 	 var time= $("#"+id).children("span:first").children("div:last").text();
	 	 $("#edit_id").attr("value",_id);
	 	 $("textarea#edit_content").val(content);
	 	 $("#edit_modal").show();
	 	 //$("#journal_content").empty();
	 	 //LoadComponent("journal_content", "{{ path('JustsyBaseBundle_journal_content',{'network_domain':curr_network_domain})}}?id="+id);
	 }
	 function update_journal(_type)
	 {
	 	if("new"==_type)
	 	{
	 		var _id="";
	 		var content=$("#journal_new textarea").val();
	 		if(content==""){showLOG($("#journal_new .log")[0],'请为备忘添加主题。');return;}
	 		var datetime=$("#journal_new .timer .Wdate").val();
	 		if(datetime=="")
	 		{
	 			datetime=getDateTime(new Date());
	 		}
	 		var bell_time=$("#journal_new .bell .Wdate").val();
	 	}
	 	else if(_type=='edit')
	 	{
	 		if($("#journal_detail").attr('status')=='readonly')return;
	 		var _id=$("#journal_detail .detail_id").val();
	 		var content=$("#journal_detail textarea").val();
	 		if(content==""){showLOG($("#journal_detail .log")[0],'请为备忘添加主题。');return;}
	 		var datetime=$("#journal_detail .timer .Wdate").val();
	 		if(datetime=="")
	 		{
	 			datetime=getDateTime(new Date());
	 		}
	 		var bell_time=$("#journal_detail .bell .Wdate").val();
	 	}
	 	$.post("{{path('JustsyBaseBundle_journal_update',{'network_domain':curr_network_domain})}}",{"id":_id,"content":content,"datetime":datetime,"bell_time":bell_time,"_type":_type},function(json){
	 	    if(json._type=='edit')
		 		{
		 			if(json.success){
		 				showLOG($("#journal_detail .log")[0],'更改成功。');
		 				$("#journal_left_title").empty();
	 				  LoadComponent("journal_left_title",$("#referer").val());
	 				  if(json.setbell=='true'){
	 				  	startbell(json._type,json.id,json.content,json.bell_time,json.openid);
	 				  }
		 			}
		 			else{showLOG($("#journal_detail .log")[0],'更改失败。');}
		 		}
		 		if(json._type=='new')
		 		{
		 			if(json.success){
		 				showLOG($("#journal_new .log")[0],'保存成功。');
		 				$("#journal_left_title").empty();
		 				var url="{{ path('JustsyBaseBundle_journal_title',{'network_domain':curr_network_domain})}}?pageindex=1";
		 				LoadComponent("journal_left_title",url);
		 				$("#referer").val(url);
		 				startbell(json._type,json.id,json.content,json.bell_time,json.openid);
		 			}
		 			else{showLOG($("#journal_new .log")[0],'保存失败。');}
		 		}				
	 	});
	 	if(_type=='new')showLOG($("#journal_new .log")[0],'正在保存。',false);
	 	if(_type=='edit')showLOG($("#journal_detail .log")[0],'正在保存。',false);
	 }
	 function startbell(_type,id,content,bell_time,openid)
	 {
	 		$.post("{{path('JustsyBaseBundle_journal_startbell')}}",{'From':'admin@100156.fafacn.com','type':_type,'Appid':'01002','To':openid,'Time':bell_time,'Message':content,'Busid':id},function(d){
	 			if(d.s=='1'){
	 				if(d._type=='edit'){
	 					showLOG($("#journal_detail .log")[0],'设置成功。');
	 				}
	 				else{showLOG($("#journal_new .log")[0],'设置成功。');}
	 			}
	 			else{
	 				if(d._type=='edit'){
	 					showLOG($("#journal_detail .log")[0],d.message);
	 				}
	 				else{showLOG($("#journal_new .log")[0],d.message);}
	 			}
	 		});
	 		if(_type=='new')showLOG($("#journal_new .log")[0],'正在设置提醒。',false);
	 	  if(_type=='edit')showLOG($("#journal_detail .log")[0],'正在设置提醒。',false);
	 }
	 function delete_journal()
	 {
	 	var id=$("#journal_detail .detail_id").val();
	 	if(true)
	 	{
	 		$.post("{{path('JustsyBaseBundle_journal_delete',{'network_domain':curr_network_domain})}}",{id:id},function(json){
	 			if(json.success)
	 			{
	 				showLOG($("#journal_detail .log")[0],'删除成功。'); 
	 				$("#journal_detail").hide();
	 				$("#journal_left_title").empty();
	 				LoadComponent("journal_left_title",$("#referer").val());
	 			}
	 			else{showLOG($("#journal_detail .log")[0],'删除失败。');}
	 	  });
	 	}
	 	else
	 	{
	 		return;
	 	}
	 	showLOG($("#journal_detail .log")[0],'正在删除。',false);
	 }
	 function query_journal(pageindex,q)
	 {
	 	var q=$("#searchinput2").val();
	 	if(""==q||$("#query_input").attr("placeholder")==q)
	 	{
	 		view_title(pageindex,"");
	 	}
	 	view_title(pageindex,q);
	 }
	 function getPage()
	 {
	 	var pageindex,q;
	 	$("#journal_left_title").empty();
	 	if(arguments.length==2)
	 	{
	 		pageindex=arguments[0];
	 		q				 =arguments[1];
	 		var url="{{ path('JustsyBaseBundle_journal_title',{'network_domain':curr_network_domain})}}?pageindex="+pageindex+"&q="+q;
	 		LoadComponent("journal_left_title",url);
	 		$("#referer").val(url);
	 	}
	 	if(arguments.length==1)
	 	{
	 		pageindex=arguments[0];
	 		var url="{{ path('JustsyBaseBundle_journal_title',{'network_domain':curr_network_domain})}}?pageindex="+pageindex;
	 		LoadComponent("journal_left_title",url);
	 		$("#referer").val(url);
	 	}
	 }
	 function close_edit_modal()
	 {
	 	$("#edit_modal").hide();
	 }
</script>
{% endblock %}
