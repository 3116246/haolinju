<!DOCTYPE HTML>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<title>
	{% block title %}Wefafa，企业移动社会化协作，微应用平台{% endblock %} 
	</title>	
  <meta name="description" content="Wefafa是一个由人们在工作之中形成的圈子交织而成的企业协作网络。" />
  <meta name="keywords" content="FaFa,企业社交,企业协作,企业即时通讯,微应用,企业即时通讯,企业通讯软件,企业即时通讯软件,免费企业通讯软件,免费企业即时通讯,免费企业即时通讯软件,分享与参与,	内外部协作,知识积累,快速检索,应用中心" />
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/fafatimewebase/css/login.css') }}" />
	<link rel="shortcut icon" href="{{ asset('bundles/fafatimewebase/images/favicon.ico') }}">
	<link href="{{ asset('bundles/fafatimewebase/css/bootstrap.min.css')}}" type="text/css" rel="stylesheet">
	
	<script src="{{ asset('bundles/fafatimewebase/js/jquery.js') }}" type="text/javascript"></script>
	<script src="{{ asset('bundles/fafatimewebase/js/base64.js') }}"></script>
	<script src="{{ asset('bundles/fafatimewebase/js/base.js') }}"></script>
	<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=981792452" type="text/javascript" charset="utf-8"></script>
	
	<script src="{{ asset('bundles/fafatimewebase/js/bootstrap.js') }}"></script>
</head>
<body>
	{% if error %} 
        <div style="display:none" id="errorMsg">{{ error.message }}</div>
 {% endif %}
	<div id="page">
	   <div id="header" class="clearfix">
	    <h1 id="logo">
	    	 <a href="{{ path('JustsyBaseBundle_login') }}">
	    	<img id="J_TBLogo" src="{{ asset('bundles/fafatimewebase/images/wefafa_logo.png') }}"> </a>
	     </h1>
	   </div>
	   <div id="content">
	      <div class="login">
	      	 <div class="login-bg"><!--为广告所在容器指定-->
				       <div id="flash-ad" class="back_image" ></div>
				   </div>				
	        <div id="J_LoginBox" class="login-box no-longlogin module-static">
	           <div class="bd">
	             <div class="wefafa-box"><!--登录的错误信息开始-->
	               <div style="height:25px;margin-top:-18px;" id="_message" class="msg">
	                 <p class="error" style="display:none;"></p>
	               </div><!--登录的错误信息结束--><!--标准登录框开始-->
			           <div id="J_Static" class="static">
			              <form id="form1" action="{{ path('JustsyBaseBundle_login_check')}}" method="post">
		                   <div class="field pwd-field">
		        	           <span for="username">Wefafa帐号：</span>
		        	           <a id="registration" class="forget-pw" tabindex="4" href="{{ path('JustsyBaseBundle_newlogin')}}" target="_blank"> 免费注册</a>
		        	           <input id="username" class="login-text" tabindex="1" value="{{_user}}" name="_username" maxlength="32" type="text"> 
		                   </div>
						           <div class="field pwd-field">
						           	  <span for="password">登录密码：</span>
						           	   <a id="forget-pw-safe" class="forget-pw" tabindex="5" href="{{ path('JustsyBaseBundle_reg_retrievepwd')}}" target="_blank">忘记登录密码?</a> 
							           <span id="J_StandardPwd">
								         <input id="password" onpaste="return false;" class="login-text" tabindex="2" name="_password" maxlength="20" type="password"> 
							           </span>
						           </div>
						           <div class="label_field_pair"><label><input id="remember_me" name="_remember_me" checked type="checkbox">&nbsp;保持登录<img style="WIDTH: 15px; HEIGHT: 15px" title="保持一周内自动登录" src="{{ asset('bundles/fafatimewebase/images/que.jpg') }}"></label> </div>
						           <div class="submit" onclick="formCheck()">
							           <span class="buttonClass" id="btnSubmit" tabindex="3" >登　录</span>
						           </div><span id="J_PasswordEditTmp" class="password-edit-tmp"></span>
						     	  </form>
						     	  <br>
						     	  <!--
						     	  <wb:login-button type="3,2" onlogin="login" title="使用新浪微博帐号登录Wefafa" onlogout="logout">登录按钮</wb:login-button>
						     	  <span class="weibo_sina_buttonClass" id="btnSubmit_weibo" title="使用新浪微博帐号登录Wefafa" onclick="window.location.href='{{code_url}}'" tabindex="3" ></span>
						     	  -->
						     </div><!--标准登录框结束-->
				       </div>
				     </div>
				  </div>
		 </div>
	     <div id="footer">
		     <div class="g_foot">
		       <div class="g_foot-nav"><span>© Copyright © 2013 Justsy 京ICP备12029244号</span> <a href="http://localhost:52150/Login.aspx#">产品介绍</a> <a href="http://localhost:52150/Login.aspx#">使用帮助</a> <a href="http://localhost:52150/Login.aspx#">软件下载</a> <a href="http://localhost:52150/Login.aspx#">商务合作</a> <a href="http://localhost:52150/Login.aspx#">服务与声明</a> <a href="http://localhost:52150/Login.aspx#">关于我们</a> </div>
		       <div class="clearfix"></div>
		     </div>
	    	</div>
	</div>
	
</body>
</html>
<script type="text/javascript">
	  var select_status = false;
	  function login()
	  {
	     window.location.href="{{code_url}}";
	  }
		$(document).ready(function(){		  
			select_status = readCookie();
			$("#remember_me").eq(0).attr("checked",select_status);			
			var errorMsg = $("#errorMsg");
	    if(errorMsg!=null && errorMsg[0]!=null)
	    {
	    	  if(errorMsg[0].innerHTML.indexOf("password")>1){
	    	  	$("#_message .error").text("登录密码不正确！");
	    	  	$("#_message .error").show();
	    	  }
	    	  else if(errorMsg[0].innerHTML=="Bad credentials")
	    	  {
	    	  	$("#_message .error").text("登录帐号不正确！");
				    $("#_message .error").show();
				    $("#username").focus();
	    	  }
	    }
	    else
	    {
	    	 if (!select_status)
	    	 {	    	
	    	 	 setTimeout(function(){
		    	 	 $("#username").val("");
		    	   $("#password").val("");
		    	   $("#username").focus();
	    	   },1);
	    	 }
	    }
		});
		
		document.cookie= "webim_chat=false";
    
	  function writeCookie(state)
    {
    	 state = state=="checked"?true:false;	 	   
		   var exdate=new Date();
		   exdate.setDate(exdate.getYear() + 1);
		   document.cookie="state=" + state + ";expires="+exdate.toGMTString();
    }
       
   //读取cooke
    function readCookie()
    {
	     var result = false;
	     if (document.cookie.length>0)
	     {
	       var c_start = document.cookie.indexOf("state=")
	       if (c_start >-1)
	       { 
	         c_start = 6;
	         var c_end=document.cookie.indexOf(";",c_start)
	         if (c_end==-1) 
	            c_end = document.cookie.length
	         result = unescape(document.cookie.substring(c_start,c_end));
	         result = result=="true"?true:false; 
	       }
	     }
	     return result;
    }
   
		$("#username").bind("keypress", function(event) {
			 if ($("#username").val()!="" && event.keyCode==13)
			    $("#password").focus();
			 else
			 	  $("#_message .error").hide();
    }); 

		$("#password").bind("keypress", function(event) {
			 if ($("#username").val()!="" && $("#password").val()!="" && event.keyCode==13)
			   formCheck();
			 else
			 	  $("#_message .error").hide();
    });
    
    function formCheck() {
      var username = $("#username");
      var userpwd = $("#password");
      var divmsg = $("#_message");
      var msgerror = divmsg.find(".error");
      //去除空格
      var emain = $("#username").val();
      emain = emain.replace(/ |　/g,"");
      $("#username").val(emain);
      if (IsNullOrEmpty(emain)) {
        msgerror.text("Wefafa帐号不能为空");
        $("#_message .error").show();
        username.focus();
        return false;
      }
      else if (IsNullOrEmpty(userpwd.val())) {
        msgerror.text("登录密码不能为空");
        $("#_message .error").show();
        userpwd.focus();
        return false;
      }
      else if (!validateMobilOrEmail(emain))
      {
      	  msgerror.text("Wefafa帐号格式错误");
          $("#_message .error").show();
          username.focus();
          return false;
      }     
      if ($("#btnSubmit").text() == "登 录")
      {
      	writeCookie($("#remember_me").eq(0).attr("checked"));      	
      	$("#_message .error").hide();
    	  $("#btnSubmit").text("登 录 中...");
        document.getElementById("form1").action="{{ path('JustsyBaseBundle_login_check')}}";
        document.getElementById("form1").submit();      
      }
      return false;
    };
    
    $(function () {
      $("#btnSubmit").text("登 录");
      var divmsg = $("#_message");
      var msgerror = divmsg.find(".error");
      if (!IsNullOrEmpty(msgerror.text())) {
        divmsg.show();
      }
      if (IsNullOrEmpty($("#username").val()))
        $("#username").focus();
      else
        $("#password").focus();
    });
    
    function validateMobilOrEmail(mail)
    {
    	var result=false;
      var reg = /^[a-zA-Z0-9]+[a-zA-Z0-9_-]*(\.[a-zA-Z0-9_-]+)*@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)*\.([a-zA-Z]+){2,}$/;
      result = reg.test(mail);
      if(!result)
      {
      	reg = /^1[3|4|5|8][0-9]\d{8}$/;
      	result = reg.test(mail);
      }
      return result;
    }
</script>