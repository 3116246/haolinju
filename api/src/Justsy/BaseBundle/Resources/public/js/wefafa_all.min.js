function LoadComponent(b,e,f,d){var c=null;if(typeof(b)=="string"){c=$("#"+b)}else{c=b}c.append("<div class='urlloading'><div /></div>");c.load(e,$.extend({t:new Date().getTime()},f),function(){$("#"+b+" urlloading").remove();if(d!=null){d()}})}function SetNewNumDisplay_conv_pc(b){if($(".Smescommend").length>0&&b.length>0){$(".Smescommend").show()}SetNewNumDisplay(b,"")}function SetNewNumDisplay_conv(b){SetNewNumDisplay(b,"red")}function SetNewNumDisplay_atme(b){SetNewNumDisplay(b,"#7BBD3B")}function SetNewNumDisplay_reply(b){SetNewNumDisplay(b,"#7BBD3B")}function SetNewNumDisplay(g,c){var b=$.trim($("#allcircle_new_num").text());b=b==""?0:b*1;for(var e=0;e<g.length;e++){var f=$(".tip_new_num[circle_id='"+g[e].circle_id+"']");f.text(g[e].num).show();var d=f.parent(),h=d.index();if(h>1){f.parent().insertAfter($("#mycircle div:eq(0)")).show()}if(h>4){$("#mycircle div:eq(5)").hide()}b+=new Number(g[e].num)}if(b>0){$("#allcircle_new_num").text(b).show()}}var SearchEdit_items=null;function SearchEdit_source(b,c){if(SearchEdit_items){return SearchEdit_items}$.getJSON(SearchEdit_source_url,{t:new Date().getTime()},function(e){SearchEdit_items=e;for(var d=0;d<SearchEdit_items.length;d++){SearchEdit_items[d].index=d;SearchEdit_items[d].toString=function(){return this.index}}c(SearchEdit_items)});return null}function SearchEdit_highlighter(d){var c=d;var b=g_resource_context+"bundles/fafatimewebase/images/no_photo.png";if(d.datatype==1){c="<span><img src='"+d.photo_url+"' style='width:48px; height:48px; margin-right:10px' onerror='this.src=\""+b+"\"'/>"+d.nick_name+"</span>"}else{if(d.datatype==2){c="<span><img src='"+d.group_photo_url+"' style='width:48px; height:48px; margin-right:10px' onerror='this.src=\""+b+"\"'/>"+d.group_name+"</span>"}else{if(d.datatype==3){c="<span><img src='"+d.logo_url+"' style='width:48px; height:48px; margin-right:10px' onerror='this.src=\""+b+"\"'/>"+d.circle_name+"</span>"}}}return c}function SearchEdit_matcher(b){if(b.datatype==1){return ~b.login_account.split("@")[0].toLowerCase().indexOf(this.query.toLowerCase())||~b.nick_name.toLowerCase().indexOf(this.query.toLowerCase())}else{if(b.datatype==2){return ~b.group_name.toLowerCase().indexOf(this.query.toLowerCase())}else{if(b.datatype==3){return ~b.circle_name.toLowerCase().indexOf(this.query.toLowerCase())}}}return false}function SearchEdit_sorter(b){return b}function SearchEdit_updater(b){var d=this.source[b];var c=d;if(d.datatype==1){c=d.nick_name;window.location.href=SearchEdit_user_url_pre+"/"+d.login_account}else{if(d.datatype==2){c=d.group_name;window.location.href=SearchEdit_group_url_pre+"/"+d.group_id}else{if(d.datatype==3){c=d.circle_name;window.location.href=SearchEdit_circle_url_pre+d.network_domain}}}return c}function focusMoveToNext(d,e){var c=d.index(e)+1;var b=d.eq(c);if(b==null){return}if(b.attr("disabled")){focusMoveToNext(d,b)}else{d.eq(c).focus()}}function setErrInfo(b,c){b.addClass("non-validated");b.find(".alert_content").text(c);b.find(".alert").slideDown(0,function(){var d=$(this);setTimeout(function(){d.css("display","none").fadeOut()},2000)});b.find(".alert-ico").attr("src",g_resource_context+"bundles/fafatimewebase/images/error.png").show()}function clearErrInfo(b){b.removeClass("non-validated");b.find(".alert_content").text("");b.find(".alert").css("display","none");b.find(".alert-ico").attr("src",g_resource_context+"bundles/fafatimewebase/images/ok.png").show()}function validEmail(b){var c=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*(\.[a-zA-Z0-9_-]+)*@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)*\.([a-zA-Z]+){2,}$/;return c.test(b)}function DBC2SBC(e,c){var b="";e=e.replace(/。/g,"．");for(var d=0;d<e.length;d++){code=e.charCodeAt(d);if(c){if(code>=65281&&code<=65373){b+=String.fromCharCode(e.charCodeAt(d)-65248)}else{if(code==12288){b+=String.fromCharCode(e.charCodeAt(d)-12288+32)}else{b+=e.charAt(d)}}}else{if(code>=33&&code<=126){b+=String.fromCharCode(e.charCodeAt(d)+65248)}else{if(code==32){b+=String.fromCharCode(e.charCodeAt(d)-32+12288)}else{b+=e.charAt(d)}}}}return b}(function(c){function b(e){this.input=e;if(e.attr("type")=="password"){this.handlePassword()}c(e[0].form).submit(function(){if(e.hasClass("placeholder")&&e[0].value==e.attr("placeholder")){e[0].value=""}})}b.prototype={show:function(g){if(this.input[0].value===""||(g&&this.valueIsPlaceholder())){if(this.isPassword){try{this.input[0].setAttribute("type","text")}catch(f){this.input.before(this.fakePassword.show()).hide()}}this.input.addClass("placeholder");this.input[0].value=this.input.attr("placeholder")}},hide:function(){if(this.valueIsPlaceholder()&&this.input.hasClass("placeholder")){this.input.removeClass("placeholder");this.input[0].value="";if(this.isPassword){try{this.input[0].setAttribute("type","password")}catch(f){}this.input.show();this.input[0].focus()}}},valueIsPlaceholder:function(){return this.input[0].value==this.input.attr("placeholder")},handlePassword:function(){var e=this.input;e.attr("realType","password");this.isPassword=true;if(c.browser.msie&&e[0].outerHTML){var f=c(e[0].outerHTML.replace(/type=(['"])?password\1/gi,"type=$1text$1"));this.fakePassword=f.val(e.attr("placeholder")).addClass("placeholder").focus(function(){e.trigger("focus");c(this).hide()});c(e[0].form).submit(function(){f.remove();e.show()});e.hide();e.parent().append(f);f.show()}}};var d=!!("placeholder" in document.createElement("input"));c.fn.placeholder=function(){return d?this:this.each(function(){var e=c(this);var f=new b(e);f.show(true);e.focus(function(){if(e.attr("type")=="password"||e.attr("realtype")=="password"||e[0].type=="password"){f.hide()}else{if(e.val()==e.attr("placeholder")){var g=e[0].createTextRange();g.collapse(true);g.moveEnd("character",0);g.moveStart("character",0);g.select()}else{if(e.val()==""){f.show()}}}});e.keydown(function(g){f.hide()});e.blur(function(){f.show(false)});if(c.browser.msie){c(window).load(function(){if(e.val()){e.removeClass("placeholder")}f.show(true)});e.focus(function(){if(this.value==""){var g=this.createTextRange();g.collapse(true);g.moveStart("character",0);g.select()}})}})}})(jQuery);
/*!
 * jQuery Form Plugin
 * version: 3.15 (09-SEP-2012)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */
(function(f){var d={};d.fileapi=f("<input type='file'/>").get(0).files!==undefined;d.formdata=window.FormData!==undefined;f.fn.ajaxSubmit=function(j){if(!this.length){e("ajaxSubmit: skipping submit process - no element selected");return this}var h,A,m,o=this;if(typeof j=="function"){j={success:j}}h=this.attr("method");A=this.attr("action");m=(typeof A==="string")?f.trim(A):"";m=m||window.location.href||"";if(m){m=(m.match(/^([^#]+)/)||[])[1]}j=f.extend(true,{url:m,success:f.ajaxSettings.success,type:h||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},j);var u={};this.trigger("form-pre-serialize",[this,j,u]);if(u.veto){e("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(j.beforeSerialize&&j.beforeSerialize(this,j)===false){e("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var n=j.traditional;if(n===undefined){n=f.ajaxSettings.traditional}var s=[];var D,E=this.formToArray(j.semantic,s);if(j.data){j.extraData=j.data;D=f.param(j.data,n)}if(j.beforeSubmit&&j.beforeSubmit(E,this,j)===false){e("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[E,this,j,u]);if(u.veto){e("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var y=f.param(E,n);if(D){y=(y?(y+"&"+D):D)}if(j.type.toUpperCase()=="GET"){j.url+=(j.url.indexOf("?")>=0?"&":"?")+y;j.data=null}else{j.data=y}var G=[];if(j.resetForm){G.push(function(){o.resetForm()})}if(j.clearForm){G.push(function(){o.clearForm(j.includeHidden)})}if(!j.dataType&&j.target){var l=j.success||function(){};G.push(function(q){var k=j.replaceTarget?"replaceWith":"html";f(j.target)[k](q).each(l,arguments)})}else{if(j.success){G.push(j.success)}}j.success=function(J,q,K){var I=j.context||this;for(var H=0,k=G.length;H<k;H++){G[H].apply(I,[J,q,K||o,o])}};var C=f("input:file:enabled[value]",this);var p=C.length>0;var B="multipart/form-data";var x=(o.attr("enctype")==B||o.attr("encoding")==B);var w=d.fileapi&&d.formdata;e("fileAPI :"+w);var r=(p||x)&&!w;if(j.iframe!==false&&(j.iframe||r)){if(j.closeKeepAlive){f.get(j.closeKeepAlive,function(){F(E)})}else{F(E)}}else{if((p||x)&&w){t(E)}else{f.ajax(j)}}for(var z=0;z<s.length;z++){s[z]=null}this.trigger("form-submit-notify",[this,j]);return this;function g(J){var K=f.param(J).split("&");var q=K.length;var k={};var I,H;for(I=0;I<q;I++){H=K[I].split("=");k[decodeURIComponent(H[0])]=decodeURIComponent(H[1])}return k}function t(q){var k=new FormData();for(var H=0;H<q.length;H++){k.append(q[H].name,q[H].value)}if(j.extraData){var K=g(j.extraData);for(var L in K){if(K.hasOwnProperty(L)){k.append(L,K[L])}}}j.data=null;var J=f.extend(true,{},f.ajaxSettings,j,{contentType:false,processData:false,cache:false,type:"POST"});if(j.uploadProgress){J.xhr=function(){var M=jQuery.ajaxSettings.xhr();if(M.upload){M.upload.onprogress=function(Q){var P=0;var N=Q.loaded||Q.position;var O=Q.total;if(Q.lengthComputable){P=Math.ceil(N/O*100)}j.uploadProgress(Q,N,O,P)}}return M}}J.data=null;var I=J.beforeSend;J.beforeSend=function(N,M){M.data=k;if(I){I.call(this,N,M)}};f.ajax(J)}function F(af){var K=o[0],J,ab,V,ad,Y,M,Q,O,P,Z,ac,T;var N=!!f.fn.prop;if(f(":input[name=submit],:input[id=submit]",K).length){alert('Error: Form elements must not have name or id of "submit".');return}if(af){for(ab=0;ab<s.length;ab++){J=f(s[ab]);if(N){J.prop("disabled",false)}else{J.removeAttr("disabled")}}}V=f.extend(true,{},f.ajaxSettings,j);V.context=V.context||V;Y="jqFormIO"+(new Date().getTime());if(V.iframeTarget){M=f(V.iframeTarget);Z=M.attr("name");if(!Z){M.attr("name",Y)}else{Y=Z}}else{M=f('<iframe name="'+Y+'" src="'+V.iframeSrc+'" />');M.css({position:"absolute",top:"-1000px",left:"-1000px"})}Q=M[0];O={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(ai){var aj=(ai==="timeout"?"timeout":"aborted");e("aborting upload... "+aj);this.aborted=1;if(Q.contentWindow.document.execCommand){try{Q.contentWindow.document.execCommand("Stop")}catch(ak){}}M.attr("src",V.iframeSrc);O.error=aj;if(V.error){V.error.call(V.context,O,aj,ai)}if(ad){f.event.trigger("ajaxError",[O,V,aj])}if(V.complete){V.complete.call(V.context,O,aj)}}};ad=V.global;if(ad&&0===f.active++){f.event.trigger("ajaxStart")}if(ad){f.event.trigger("ajaxSend",[O,V])}if(V.beforeSend&&V.beforeSend.call(V.context,O,V)===false){if(V.global){f.active--}return}if(O.aborted){return}P=K.clk;if(P){Z=P.name;if(Z&&!P.disabled){V.extraData=V.extraData||{};V.extraData[Z]=P.value;if(P.type=="image"){V.extraData[Z+".x"]=K.clk_x;V.extraData[Z+".y"]=K.clk_y}}}var U=1;var R=2;function S(aj){var ai=aj.contentWindow?aj.contentWindow.document:aj.contentDocument?aj.contentDocument:aj.document;return ai}var I=f("meta[name=csrf-token]").attr("content");var H=f("meta[name=csrf-param]").attr("content");if(H&&I){V.extraData=V.extraData||{};V.extraData[H]=I}function aa(){var ak=o.attr("target"),ai=o.attr("action");K.setAttribute("target",Y);if(!h){K.setAttribute("method","POST")}if(ai!=V.url){K.setAttribute("action",V.url)}if(!V.skipEncodingOverride&&(!h||/post/i.test(h))){o.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(V.timeout){T=setTimeout(function(){ac=true;X(U)},V.timeout)}function al(){try{var an=S(Q).readyState;e("state = "+an);if(an&&an.toLowerCase()=="uninitialized"){setTimeout(al,50)}}catch(ao){e("Server abort: ",ao," (",ao.name,")");X(R);if(T){clearTimeout(T)}T=undefined}}var aj=[];try{if(V.extraData){for(var am in V.extraData){if(V.extraData.hasOwnProperty(am)){if(f.isPlainObject(V.extraData[am])&&V.extraData[am].hasOwnProperty("name")&&V.extraData[am].hasOwnProperty("value")){aj.push(f('<input type="hidden" name="'+V.extraData[am].name+'">').attr("value",V.extraData[am].value).appendTo(K)[0])}else{aj.push(f('<input type="hidden" name="'+am+'">').attr("value",V.extraData[am]).appendTo(K)[0])}}}}if(!V.iframeTarget){M.appendTo("body");if(Q.attachEvent){Q.attachEvent("onload",X)}else{Q.addEventListener("load",X,false)}}setTimeout(al,15);K.submit()}finally{K.setAttribute("action",ai);if(ak){K.setAttribute("target",ak)}else{o.removeAttr("target")}f(aj).remove()}}if(V.forceSync){aa()}else{setTimeout(aa,10)}var ag,ah,ae=50,L;function X(an){if(O.aborted||L){return}try{ah=S(Q)}catch(aq){e("cannot access response document: ",aq);an=R}if(an===U&&O){O.abort("timeout");return}else{if(an==R&&O){O.abort("server abort");return}}if(!ah||ah.location.href==V.iframeSrc){if(!ac){return}}if(Q.detachEvent){Q.detachEvent("onload",X)}else{Q.removeEventListener("load",X,false)}var al="success",ap;try{if(ac){throw"timeout"}var ak=V.dataType=="xml"||ah.XMLDocument||f.isXMLDoc(ah);e("isXml="+ak);if(!ak&&window.opera&&(ah.body===null||!ah.body.innerHTML)){if(--ae){e("requeing onLoad callback, DOM not available");setTimeout(X,250);return}}var ar=ah.body?ah.body:ah.documentElement;O.responseText=ar?ar.innerHTML:null;O.responseXML=ah.XMLDocument?ah.XMLDocument:ah;if(ak){V.dataType="xml"}O.getResponseHeader=function(av){var au={"content-type":V.dataType};return au[av]};if(ar){O.status=Number(ar.getAttribute("status"))||O.status;O.statusText=ar.getAttribute("statusText")||O.statusText}var ai=(V.dataType||"").toLowerCase();var ao=/(json|script|text)/.test(ai);if(ao||V.textarea){var am=ah.getElementsByTagName("textarea")[0];if(am){O.responseText=am.value;O.status=Number(am.getAttribute("status"))||O.status;O.statusText=am.getAttribute("statusText")||O.statusText}else{if(ao){var aj=ah.getElementsByTagName("pre")[0];var at=ah.getElementsByTagName("body")[0];if(aj){O.responseText=aj.textContent?aj.textContent:aj.innerText}else{if(at){O.responseText=at.textContent?at.textContent:at.innerText}}}}}else{if(ai=="xml"&&!O.responseXML&&O.responseText){O.responseXML=W(O.responseText)}}try{ag=k(O,ai,V)}catch(an){al="parsererror";O.error=ap=(an||al)}}catch(an){e("error caught: ",an);al="error";O.error=ap=(an||al)}if(O.aborted){e("upload aborted");al=null}if(O.status){al=(O.status>=200&&O.status<300||O.status===304)?"success":"error"}if(al==="success"){if(V.success){V.success.call(V.context,ag,"success",O)}if(ad){f.event.trigger("ajaxSuccess",[O,V])}}else{if(al){if(ap===undefined){ap=O.statusText}if(V.error){V.error.call(V.context,O,al,ap)}if(ad){f.event.trigger("ajaxError",[O,V,ap])}}}if(ad){f.event.trigger("ajaxComplete",[O,V])}if(ad&&!--f.active){f.event.trigger("ajaxStop")}if(V.complete){V.complete.call(V.context,O,al)}L=true;if(V.timeout){clearTimeout(T)}setTimeout(function(){if(!V.iframeTarget){M.remove()}O.responseXML=null},100)}var W=f.parseXML||function(ai,aj){if(window.ActiveXObject){aj=new ActiveXObject("Microsoft.XMLDOM");aj.async="false";aj.loadXML(ai)}else{aj=(new DOMParser()).parseFromString(ai,"text/xml")}return(aj&&aj.documentElement&&aj.documentElement.nodeName!="parsererror")?aj:null};var q=f.parseJSON||function(ai){return window["eval"]("("+ai+")")};var k=function(an,al,ak){var aj=an.getResponseHeader("content-type")||"",ai=al==="xml"||!al&&aj.indexOf("xml")>=0,am=ai?an.responseXML:an.responseText;if(ai&&am.documentElement.nodeName==="parsererror"){if(f.error){f.error("parsererror")}}if(ak&&ak.dataFilter){am=ak.dataFilter(am,al)}if(typeof am==="string"){if(al==="json"||!al&&aj.indexOf("json")>=0){am=q(am)}else{if(al==="script"||!al&&aj.indexOf("javascript")>=0){f.globalEval(am)}}}return am}}};f.fn.ajaxForm=function(g){g=g||{};g.delegation=g.delegation&&f.isFunction(f.fn.on);if(!g.delegation&&this.length===0){var h={s:this.selector,c:this.context};if(!f.isReady&&h.s){e("DOM not ready, queuing ajaxForm");f(function(){f(h.s,h.c).ajaxForm(g)});return this}e("terminating; zero elements found by selector"+(f.isReady?"":" (DOM not ready)"));return this}if(g.delegation){f(document).off("submit.form-plugin",this.selector,c).off("click.form-plugin",this.selector,b).on("submit.form-plugin",this.selector,g,c).on("click.form-plugin",this.selector,g,b);return this}return this.ajaxFormUnbind().bind("submit.form-plugin",g,c).bind("click.form-plugin",g,b)};function c(h){var g=h.data;if(!h.isDefaultPrevented()){h.preventDefault();f(this).ajaxSubmit(g)}}function b(l){var k=l.target;var h=f(k);if(!(h.is(":submit,input:image"))){var g=h.closest(":submit");if(g.length===0){return}k=g[0]}var j=this;j.clk=k;if(k.type=="image"){if(l.offsetX!==undefined){j.clk_x=l.offsetX;j.clk_y=l.offsetY}else{if(typeof f.fn.offset=="function"){var m=h.offset();j.clk_x=l.pageX-m.left;j.clk_y=l.pageY-m.top}else{j.clk_x=l.pageX-k.offsetLeft;j.clk_y=l.pageY-k.offsetTop}}}setTimeout(function(){j.clk=j.clk_x=j.clk_y=null},100)}f.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};f.fn.formToArray=function(x,g){var w=[];if(this.length===0){return w}var l=this[0];var p=x?l.getElementsByTagName("*"):l.elements;if(!p){return w}var r,q,o,y,m,t,k;for(r=0,t=p.length;r<t;r++){m=p[r];o=m.name;if(!o){continue}if(x&&l.clk&&m.type=="image"){if(!m.disabled&&l.clk==m){w.push({name:o,value:f(m).val(),type:m.type});w.push({name:o+".x",value:l.clk_x},{name:o+".y",value:l.clk_y})}continue}y=f.fieldValue(m,true);if(y&&y.constructor==Array){if(g){g.push(m)}for(q=0,k=y.length;q<k;q++){w.push({name:o,value:y[q]})}}else{if(d.fileapi&&m.type=="file"&&!m.disabled){if(g){g.push(m)}var h=m.files;if(h.length){for(q=0;q<h.length;q++){w.push({name:o,value:h[q],type:m.type})}}else{w.push({name:o,value:"",type:m.type})}}else{if(y!==null&&typeof y!="undefined"){if(g){g.push(m)}w.push({name:o,value:y,type:m.type,required:m.required})}}}}if(!x&&l.clk){var s=f(l.clk),u=s[0];o=u.name;if(o&&!u.disabled&&u.type=="image"){w.push({name:o,value:s.val()});w.push({name:o+".x",value:l.clk_x},{name:o+".y",value:l.clk_y})}}return w};f.fn.formSerialize=function(g){return f.param(this.formToArray(g))};f.fn.fieldSerialize=function(h){var g=[];this.each(function(){var m=this.name;if(!m){return}var k=f.fieldValue(this,h);if(k&&k.constructor==Array){for(var l=0,j=k.length;l<j;l++){g.push({name:m,value:k[l]})}}else{if(k!==null&&typeof k!="undefined"){g.push({name:this.name,value:k})}}});return f.param(g)};f.fn.fieldValue=function(m){for(var l=[],j=0,g=this.length;j<g;j++){var k=this[j];var h=f.fieldValue(k,m);if(h===null||typeof h=="undefined"||(h.constructor==Array&&!h.length)){continue}if(h.constructor==Array){f.merge(l,h)}else{l.push(h)}}return l};f.fieldValue=function(g,o){var j=g.name,u=g.type,w=g.tagName.toLowerCase();if(o===undefined){o=true}if(o&&(!j||g.disabled||u=="reset"||u=="button"||(u=="checkbox"||u=="radio")&&!g.checked||(u=="submit"||u=="image")&&g.form&&g.form.clk!=g||w=="select"&&g.selectedIndex==-1)){return null}if(w=="select"){var p=g.selectedIndex;if(p<0){return null}var r=[],h=g.options;var l=(u=="select-one");var q=(l?p+1:h.length);for(var k=(l?p:0);k<q;k++){var m=h[k];if(m.selected){var s=m.value;if(!s){s=(m.attributes&&m.attributes.value&&!(m.attributes.value.specified))?m.text:m.value}if(l){return s}r.push(s)}}return r}return f(g).val()};f.fn.clearForm=function(g){return this.each(function(){f("input,select,textarea",this).clearFields(g)})};f.fn.clearFields=f.fn.clearInputs=function(g){var h=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var k=this.type,j=this.tagName.toLowerCase();if(h.test(k)||j=="textarea"){this.value=""}else{if(k=="checkbox"||k=="radio"){this.checked=false}else{if(j=="select"){this.selectedIndex=-1}else{if(g){if((g===true&&/hidden/.test(k))||(typeof g=="string"&&f(this).is(g))){this.value=""}}}}}})};f.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};f.fn.enable=function(g){if(g===undefined){g=true}return this.each(function(){this.disabled=!g})};f.fn.selected=function(g){if(g===undefined){g=true}return this.each(function(){var h=this.type;if(h=="checkbox"||h=="radio"){this.checked=g}else{if(this.tagName.toLowerCase()=="option"){var j=f(this).parent("select");if(g&&j[0]&&j[0].type=="select-one"){j.find("option").selected(false)}this.selected=g}}})};f.fn.ajaxSubmit.debug=false;function e(){if(!f.fn.ajaxSubmit.debug){return}var g="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(g)}else{if(window.opera&&window.opera.postError){window.opera.postError(g)}}}})(jQuery);jQuery.fn.extend({mousewheel:function(b,d,c){return this.hover(function(){jQuery.event.mousewheel.giveFocus(this,b,d,c)},function(){jQuery.event.mousewheel.removeFocus(this)})},mousewheeldown:function(c,b){return this.mousewheel(function(){},c,b)},mousewheelup:function(c,b){return this.mousewheel(c,function(){},b)},unmousewheel:function(){return this.each(function(){jQuery(this).unmouseover().unmouseout();jQuery.event.mousewheel.removeFocus(this)})},unmousewheeldown:jQuery.fn.unmousewheel,unmousewheelup:jQuery.fn.unmousewheel});jQuery.event.mousewheel={giveFocus:function(d,b,e,c){if(d._handleMousewheel){jQuery(d).unmousewheel()}if(c==window.undefined&&e&&e.constructor!=Function){c=e;e=null}d._handleMousewheel=function(f){if(!f){f=window.event}if(c){if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}}var g=0;if(f.wheelDelta){g=f.wheelDelta/120;if(window.opera){g=-g}}else{if(f.detail){g=-f.detail/3}}if(b&&(g>0||!e)){b.apply(d,[f,g])}else{if(e&&g<0){e.apply(d,[f,g])}}};if(window.addEventListener){window.addEventListener("DOMMouseScroll",d._handleMousewheel,false)}window.onmousewheel=document.onmousewheel=d._handleMousewheel},removeFocus:function(b){if(!b._handleMousewheel){return}if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",b._handleMousewheel,false)}window.onmousewheel=document.onmousewheel=null;b._handleMousewheel=null}};function checkHover(c,b){if(getEvent(c).type=="mouseover"){return !contains(b,getEvent(c).relatedTarget||getEvent(c).fromElement)&&!((getEvent(c).relatedTarget||getEvent(c).fromElement)===b)}else{return !contains(b,getEvent(c).relatedTarget||getEvent(c).toElement)&&!((getEvent(c).relatedTarget||getEvent(c).toElement)===b)}}function contains(b,c){if(b.contains){return b!=c&&b.contains(c)}else{return !!(b.compareDocumentPosition(c)&16)}}function getEvent(b){return b||window.event}function setTab(c,d,f){for(i=1;i<=f;i++){var e=document.getElementById(c+i);var b=document.getElementById("con_"+c+"_"+i);e.className=i==d?"hover":"";b.style.display=i==d?"block":"none"}}function setInputTab(c){var d=$(c);d.siblings().removeClass("hover");d.siblings().find("span").removeClass("input_tab_hover");d.addClass("hover");d.find("span").attr("class","input_tab_hover");$(".lib_Contentbox .input_con_area").hide();$(".lib_Contentbox #con_"+d.attr("id")).show();var b=$.trim(d.text());b=="动态"?$("#li_facemenu").show():$("#li_facemenu").hide();b=="动态"?$("#li_at").show():$("#li_at").hide();b=="官方"?$(".set_top").show():$(".set_top").hide();b=="官方"?$("ul.post_list").find("a[group_value='PRIVATE']").parent().hide():$("ul.post_list").find("a[group_value='PRIVATE']").parent().show();b=="官方"?$(".publish[type='group'] input#txtNotify").parent().hide():$(".publish[type='group'] input#txtNotify").parent().show();window.publish_event=d.attr("publish_event");window.publish_event_param=d.attr("publish_event_param")}function setInputTabForPC(c){var d=$(c).parent();$(".lib_Contentbox .input_con_area").hide();$(".lib_Contentbox #con_"+d.attr("id")).show();var b=$.trim(d.text());b=="动态"?$("#li_facemenu").show():$("#li_facemenu").hide();b=="动态"?$("#li_at").show():$("#li_at").hide();b=="官方"?$(".set_top").show():$(".set_top").hide();b=="官方"?$("ul.post_list").find("a[group_value='PRIVATE']").parent().hide():$("ul.post_list").find("a[group_value='PRIVATE']").parent().show();b=="官方"?$(".publish[type='group'] input#txtNotify").parent().hide():$(".publish[type='group'] input#txtNotify").parent().show();window.publish_event=d.attr("publish_event");window.publish_event_param=d.attr("publish_event_param")}function setPublishEnable(){if(typeof(SNSComFileUpload)!="undefined"&&SNSComFileUpload!=null&&SNSComFileUpload.loading.length>0){return}$hover=$("#one1.hover,#one2.hover,#one3.hover,#one4.hover,#one5.hover");var b=$hover.find("span").text();if(b=="动态"||b=="提问"||b=="官方"||b=="活动"){$("#btnPublish").removeAttr("disabled")}else{if(b=="投票"){var c=$("div#divvote_options").find("input[type='text']");var d="";for(var e=0;e<c.length;e++){d+=$(c[e]).val()}if(d==""){return}if($("input#txtvote_title").val()==""){return}$("#btnPublish").removeAttr("disabled")}}}function _setPublishDisable(){$("#btnPublish").attr("disabled","disabled")}function setPublishDisable(b){if($(b).val()==""||$(b).val()==$(b).attr("placeholder")){_setPublishDisable()}}function setPublishing(b){$("#btnPublish").val(b?"发布...":"发  布")}function txtNotify_source(b,c){if(txtNotify_source_all.length>0){return txtNotify_source_all}$.getJSON(txtNotify_source_url,{network_domain:g_curr_network_domain,query:this.query,t:new Date().getTime()},function(e){txtNotify_source_100=e;for(var d=0;d<txtNotify_source_100.length;d++){txtNotify_source_100[d].index=d;txtNotify_source_100[d].toString=function(){return this.index}}c(txtNotify_source_100)});return null}function txtNotify_highlighter(b){return"<span>"+b.nick_name+"("+b.login_account+")</span>"}function txtNotify_matcher(b){if(this.query){return ~b.login_account.toLowerCase().indexOf(this.query.toLowerCase())||~b.nick_name.toLowerCase().indexOf(this.query.toLowerCase())}else{return true}}function txtNotify_sorter(b){return b}function txtNotify_updater(c){var b=$("#InputNotifyArea");var d=txtNotify_source_all.length>0?txtNotify_source_all:txtNotify_source_100;if($("input[value='"+d[c].login_account+"']",b).length==0){b.append(GetNotifyTemplate(d[c].login_account,d[c].nick_name))}return""}function GetNotifyTemplate(d,f){var e='<span class="NotifyObj"><input  type="hidden" value="';var c='"><span class="NotifyPerson">';var b='</span><span class="NotifyClose" onclick="NotifyClose_OnClick(this)">×</span></span>';return e+d+c+f+b}function NotifyClose_OnClick(b){$sender=$(b);$sender.parent().remove()}function txtNotify_OnKeyUp(d){if(d.keyCode==8){if($(this).val()==""){$("#InputNotifyArea .NotifyObj:last").remove()}}else{if(d.keyCode==13){var c=$(this);v=c.val();if(v==""){return}if(v.indexOf("@")<=0){c.val("");return}var b=$("#InputNotifyArea");if($("input[value='"+v+"']",b).length==0){b.append(GetNotifyTemplate(v,v))}c.val("")}}}function GetNotifyStaff(){var b=$.unique($("#InputNotifyArea input").map(function(){return $(this).val()})).toArray();return b}function ClearNotifyStaff(){$("#InputNotifyArea").empty()}function txtpost_to_group_highlighter(b){return"<span><img src='"+b.group_photo_url+"' style='width:48px; height:48px; margin-right:10px'/>"+b.group_name+"</span>"}function txtpost_to_group_matcher(b){if(this.query){return ~b.group_name.toLowerCase().indexOf(this.query.toLowerCase())}else{return true}}function txtpost_to_group_sorter(b){return b}function txtpost_to_group_updater(b){$("#apost_to_group").text("发布给："+this.source[b].group_name).show();$("#hpost_to_group").val(this.source[b].group_id);$("#txtpost_to_group").hide();$("#bcancel_post_to_group").show();$(".lib_notify").show();this.query="";return""}function apost_to_group_OnClick(){$("#apost_to_group").hide();$("#bcancel_post_to_group").hide();var b=$("#txtpost_to_group").show().focus();var c=b.data("typeahead");c.process(c.source).show()}function bcancel_post_to_group_OnClick(){$("#apost_to_group").text("发布给：全部同事").show();$("#hpost_to_group").val("ALL");$("#bcancel_post_to_group").hide();$("#InputNotifyArea .NotifyObj").remove();$(".lib_notify").hide()}function mi_post_to_group_OnClick(b){var d=$(b);var c=d.attr("group_value");$("#hpost_to_group").val(c);$("#spost_to_group_name").text(d.text());if(c=="ALL"){$("#InputNotifyArea .NotifyObj").remove();$(".lib_notify").hide()}else{$(".lib_notify").show()}}function publishNote(f){if($("#Trend").val()==""){var d="";var c=$("#one1.hover,#one2.hover,#one3.hover,#one4.hover,#one5.hover");var b=$.trim(c.find("span").text());if(b=="动态"){d="请先输入动态信息"}else{if(b=="提问"){d="请先输入想提的问题"}else{if(b=="活动"){d="请先输入活动内容"}else{if(b=="投票"){d="请先填写投票内容"}else{if(b=="官方"){d="请先输入官方信息"}}}}}$(f).attr("title",d);return}else{if(typeof(SNSComFileUpload)!="undefined"&&SNSComFileUpload!=null&&SNSComFileUpload.loading.length>0){$(f).attr("title","有文件正在上传，若要立即发布请先取消正在上传的文件。")}else{$(f).attr("title","发布")}}}function publishInput(){var b=$("#btnPublish").attr("disabled");if(typeof(b)!="undefined"&&b.indexOf("disabled")>-1){return}if(window[window.publish_event]){$("#uploadfilecontainer").slideUp();$("#uploadfilecontainer").children("div.file_upload_box").remove();SNSComFileUpload=null;window[window.publish_event](window.publish_event_param)}}function openfiledigl_OnShown(b){$("#li_picmenu").removeClass("open");if($(this).attr("isloaded")!="1"){LoadComponent("files",b.data.Aurl);$(this).attr("isloaded","1")}}function insertFileID(){var b=getCurrentSelectedFileID();if(b.fileId&&b.fileId!=""){addFile(b.fileName,b.fileId)}$("#openfiledigl").modal("hide")}function fileSelect(b){if(typeof(SNSComFileUpload)=="undefined"||SNSComFileUpload==null){if(typeof(SNSComFileUpload)=="undefined"){window.SNSComFileUpload=new ComFileUpload();SNSComFileUpload.registerEvent()}else{window.SNSComFileUpload=new ComFileUpload()}SNSComFileUpload.init({container:$("#uploadfilecontainer")[0],currfile:$("input#filedata")[0],upload_url:b});SNSComFileUpload.fileselect(null,function(){$("span#upload_file_sel").append("<input type='file' style='cursor: pointer; left: 24.5px; width: 70px; opacity: 0; position: absolute; top: 8px; z-index: 1000002; outline: medium none;' size='1' id='filedata' onchange=\"fileSelect('/fafatime.com/documnet/upload')\" hidefocus='hidefocus' name='filedata' tabindex='-1'>")});$("#li_picmenu").removeClass("open");$("#uploadfilecontainer").slideDown()}else{SNSComFileUpload.fileselect($("input#filedata")[0],function(){$("span#upload_file_sel").append("<input type='file' style='cursor: pointer; left: 24.5px; width: 70px; opacity: 0; position: absolute; top: 8px; z-index: 1000002; outline: medium none;' size='1' id='filedata' onchange=\"fileSelect('/fafatime.com/documnet/upload')\" hidefocus='hidefocus' name='filedata' tabindex='-1'>")});$("#li_picmenu").removeClass("open");$("#uploadfilecontainer").slideDown()}}function addFile(c,d){if($("#filesList input[value='"+d+"']").length>0){return}var b='<span class="NotifyObj"><input type="hidden" value="'+d+'"><span class="NotifyPerson">'+c+'</span><span class="NotifyClose" onclick="AttachClose_OnClick(this)">×</span></span>';$("#filesList").append(b);$("#filesList").parent().show()}function AttachClose_OnClick(b){$sender=$(b);$sender.parent().remove();if($("#filesList").children().length==0){$("#filesList").parent().hide()}if(typeof(SNSComFileUpload)!="undefined"&&SNSComFileUpload!=null){SNSComFileUpload.removeFile($sender.siblings("input[type='hidden']").val())}}function GetInputAttach(){var b=$.unique($("#filesList input").map(function(){return $(this).val()})).toArray();return b}function ClearInputAttach(){$("#filesList").empty().parent().hide()}function publishTrend(c){var b=$("#Trend").val();if(!b||b==$("#Trend").attr("placeholder")){return}_setPublishDisable();setPublishing(true);$.post(c,{network_domain:g_curr_network_domain,trend:b,notifystaff:GetNotifyStaff(),attachs:GetInputAttach(),post_to_group:$("#hpost_to_group").val(),t:new Date().getTime()},function(d){if(d.success=="1"){$("#Trend").val("");ClearNotifyStaff();ClearInputAttach();setPublishing(false);if(window.OnPublished){window.OnPublished(d.conv_id,"trend")}}},"json")}function publishOfficialTrend(c){var b=$("#officialTrend").val();if(!b||b==$("#officialTrend").attr("placeholder")){return}_setPublishDisable();setPublishing(true);$.post(c,{network_domain:g_curr_network_domain,trend:b,notifystaff:GetNotifyStaff(),attachs:GetInputAttach(),post_to_group:$("#hpost_to_group").val(),infotype:$("#divofficial_ismulti input:checked[name='official_sel_type']").val(),top:$("#istop").attr("checked")=="checked"?"1":"0",time:$("#serTime").attr("timeout"),t:new Date().getTime()},function(d){if(d.success=="1"){$("#officialTrend").val("");ClearNotifyStaff();ClearInputAttach();setPublishing(false);if(window.OnPublished){window.OnPublished(d.conv_id,"official")}}},"json")}function publishAsk(c){var b=$("#AskQuestion").val();if(!b||b==$("#AskQuestion").attr("placeholder")){return}_setPublishDisable();setPublishing(true);$.post(c,{network_domain:g_curr_network_domain,question:b,notifystaff:GetNotifyStaff(),attachs:GetInputAttach(),post_to_group:$("#hpost_to_group").val(),t:new Date().getTime()},function(d){if(d.success=="1"){$("#AskQuestion").val("");ClearNotifyStaff();ClearInputAttach();setPublishing(false);if(window.OnPublished){window.OnPublished(d.conv_id,"ask")}}},"json")}function seltogether_m_OnChange(){var b=new Number($("#seltogether_m").val());var e=new Date((b<new Date().getMonth()?new Date().getFullYear()+1:new Date().getFullYear()),b,"0").getDate();$seltogether_d=$("#seltogether_d");var d=$seltogether_d.val();if(!d){d=new Date().getDate()}$seltogether_d.empty();for(var c=1;c<=e;c++){$seltogether_d.append("<option value='"+c+"'>"+c+"日</option>")}$seltogether_d.val(d)}function publishTogether(d){var c=$("#together_title").val();if(!c||c==$("#together_title").attr("placeholder")){return}var b=new Number($("#seltogether_m").val());_setPublishDisable();setPublishing(true);$.post(d,{network_domain:g_curr_network_domain,title:c,will_date:(b<new Date().getMonth()?new Date().getFullYear()+1:new Date().getFullYear())+"/"+(b)+"/"+$("#seltogether_d").val()+" "+$("#seltogether_hm").val(),will_dur:$("#seltogether_dur").val(),will_addr:$("#together_addr").val(),together_desc:$("#together_desc").val(),notifystaff:GetNotifyStaff(),attachs:GetInputAttach(),post_to_group:$("#hpost_to_group").val(),map_point:$("#together_addr_map_point").val(),t:new Date().getTime()},function(e){if(e.success=="1"){$("#together_title").val("");$("#together_addr").val("");$("#together_desc").val("");ClearNotifyStaff();ClearInputAttach();setPublishing(false);if(window.OnPublished){window.OnPublished(e.conv_id,"together")}}},"json")}function together_map(){var c=document.getElementsByTagName("SCRIPT"),d=false;if(c!=null){for(var e=0;e<c.length;e++){if(c[e].src.split("?")[0].indexOf("Map.js")>-1){d=true;break}}}var b=$("#together_addr_map_point").val();if(b!=null&&b.length>0){b=b.split(",");b={x:b[0]*1,y:b[1]*1}}if(!d){var g=document.getElementsByTagName("HEAD").item(0);var f=document.createElement("script");f.type="text/javascript";f.src="/bundles/fafatimewebase/js/Map.js";g.appendChild(f);f.onload=f.onreadystatechange=function(){setTimeout(' fafaMap.Show("togetherMap_map","'+b+'",false)',100)}}else{fafaMap.Show("togetherMap_map",b,false)}}function togetherMap_save(){fafaMap.save(function(e){var b=e.x+","+e.y;$("#together_addr_map_point").val(b);var c=$("#together_addr").val();$("#together_addr").val(e.addr);$("#togetherMap").modal("hide")})}var ChineseNum=["一","二","三","四","五","六","七","八","九","十"];function vote_option_OnFocus(c){var e='<div class="ask_div4"><input type="text" onkeyup="setPublishEnable()" onblur="setPublishDisable(this)" class="text_input" placeholder="选项';var d='" onfocus="vote_option_OnFocus(this)"></div>';var b=$(c).parent().parent();var f=b.children().length;if(f>=ChineseNum.length){return}$(c).attr("onfocus","");b.append(e+ChineseNum[f]+d);$("input[placeholder]",b).placeholder()}function selvote_m_OnChange(){var b=new Number($("#selvote_m").val());var e=new Date((b<new Date().getMonth()?new Date().getFullYear()+1:new Date().getFullYear()),b,"0").getDate();$selvote_d=$("#selvote_d");var d=$selvote_d.val();if(!d){d=new Date().getDate()+3}$selvote_d.empty();for(var c=1;c<=e;c++){$selvote_d.append("<option value='"+c+"'>"+c+"日</option>")}d=d>e?e:d;$selvote_d.val(d)}function publishVote(d){var c=$("#txtvote_title").val();if(!c||c==$("#txtvote_title").attr("placeholder")){return}$optionvalues=$("#divvote_options input").filter(function(f){var g=$(this);var e=g.val();return e!=""&&e!=g.attr("placeholder")}).map(function(){return $(this).val()});var b=new Number($("#selvote_m").val());_setPublishDisable();setPublishing(true);$.post(d,{network_domain:g_curr_network_domain,title:c,is_multi:$("#divvote_ismulti input[name='vote_sel_type']:checked").val(),optionvalues:$optionvalues.toArray(),notifystaff:GetNotifyStaff(),attachs:GetInputAttach(),finishdate:(b<new Date().getMonth()?new Date().getFullYear()+1:new Date().getFullYear())+"/"+(b)+"/"+$("#selvote_d").val()+" "+$("#selvote_hm").val(),post_to_group:$("#hpost_to_group").val()},function(e){if(e.success=="1"){$("#txtvote_title").val("");$("#divvote_options input").val("");$("#divvote_options").children(":gt(2)").remove();$("#divvote_options").children(":last").children("input").attr("onfocus","vote_option_OnFocus(this)");ClearNotifyStaff();ClearInputAttach();setPublishing(false);if(window.OnPublished){window.OnPublished(e.conv_id,"vote")}}},"json")}function publishNotice(b){var c=$("#Notice").val();if(!c||c==$("#Notice").attr("placeholder")){return}_setPublishDisable();$.post(b,{notice:$("#Notice").val(),post_to_group:$("#hpost_to_group").val()==""?"all":$("#hpost_to_group").val(),t:new Date().getTime()},function(d){if(d.success=="1"){$("#Notice").val("");setPublishEnable();if(window.OnPublished){window.OnPublished(d.bulletin_id)}}},"json")}function setTopTime(){$("div.set_top span.set_time").bind("mouseover",function(e){if(checkHover(e,this)){if(typeof(set_top_timer)!="undefined"){clearTimeout(set_top_timer)}var f=$(this),c=f.siblings("ul.time_ul");var d=f.offset().left;var g=f.offset().top;c.css({left:(d+f.width()-c.width()+6).toString()+"px",top:(g+f.height()+2).toString()+"px"});set_top_timer=setTimeout(function(){c.slideDown(50)},500)}});$("div.set_top span.set_time").bind("mouseout",function(c){if(checkHover(c,this)){if(typeof(set_top_timer)!="undefined"){clearTimeout(set_top_timer)}set_top_timer=setTimeout(function(){$("div.set_top ul.time_ul").slideUp(50)},500)}});var b=$("div.set_top ul.time_ul");b.bind("mouseover",function(c){if(checkHover(c,this)){if(typeof(set_top_timer)!="undefined"){clearTimeout(set_top_timer)}}});b.bind("mouseout",function(c){if(checkHover(c,this)){$this=$(this);set_top_timer=setTimeout(function(){$this.slideUp(50)},500)}});b.find("li").bind("click",function(){var c=$(this).attr("timeout");var d=0;if(c=="1d"){d=1}else{if(c=="1w"){d=7}else{if(c=="1m"){d=30}}}$("#serTime").attr("timeout",d);$("#serTime").text($(this).text());$(this).parent().hide()})}function AtSomebody(){var e=$("#Trend");if(e.length==0){return}var c=e[0];var d=c.selectionStart;var f=c.value.length;c.value=c.value.slice(0,c.selectionStart)+"@"+c.value.slice(c.selectionStart,f);if(document.selection){if(!d){d=0}var b=c.createTextRange();b.moveEnd("character",d+1);b.moveStart("character",d+1);b.select();c.selectionStart=d+1}else{c.setSelectionRange(d+1,d+1)}setTimeout(function(){e.focus().keyup()},500)}function setDisplayTab(b){var c;if(b==null){c=$("div.tabbox li.hover");c.attr("isloadtop","0");$("#con_"+c.attr("id")).html(null)}else{c=$(b);c.siblings().removeClass("hover");c.addClass("hover");$(".contentbox #con_"+c.attr("id")).show().siblings().hide();if(c.attr("isloaded")){return}c.attr("isloaded","1")}LoadComponent("con_"+c.attr("id"),c.attr("loadurl"),{network_domain:g_curr_network_domain,trend:manager_trend})}function DelConv(c,d,f,b){var e='<div class="del"><p class="deltext">您确认要删除这条信息吗？</p><p class="delbox"><img class="deling" src="'+b+'" style="display:none; height: 24px; width: 24px; margin-left:20px; margin-right: 30px;"><input type="button" class="delbutton" value="删 除" onclick="DelConvOK(this, \''+d+"', '"+f+'\')"><input type="button" class="escbutton" value="取 消" onclick="DelConvCancel(this)"></p></div>';$(c).parent().parent().parent().append(e)}function DelConvOK(b,c,d){$(b).hide();$(b).siblings("img.deling").show();$.getJSON(c,{conv_root_id:d,t:new Date().getTime()},function(e){var f=$(b).parent().parent().parent().parent().parent().fadeOut("slow",function(){f.remove()})})}function DelConvCancel(b){$(b).parent().parent().remove()}function DelTrend(c,d,e,b){return DelConv(c,d,e,b)}function DelAsk(c,d,e,b){return DelConv(c,d,e,b)}function DelTogether(c,d,e,b){return DelConv(c,d,e,b)}function DelVote(c,d,e,b){return DelConv(c,d,e,b)}function DelReply(c,d,e,b){var f='<div class="del"><p class="deltext">您确认要删除这条信息吗？</p><p class="delbox"><img class="deling" src="'+b+'" style="display:none; height: 24px; width: 24px; margin-left:20px; margin-right: 30px;"><input type="button" class="delbutton" value="删 除" onclick="DelReplyOK(this, \''+d+"', '"+e+'\')"><input type="button" class="escbutton" value="取 消" onclick="DelReplyCancel(this)"></p></div>';$(c).parent().parent().append(f)}function DelReplyOK(b,c,d){$(b).hide();$(b).siblings("img.deling").show();$.getJSON(c,{conv_id:d,t:new Date().getTime()},function(e){var f=$(b).parent().parent().parent().parent().parent().parent().fadeOut("slow",function(){$replynum=$(b).parents("div.convbox").find("span.replynum");var g=new Number($replynum.first().text());$replynum.text(g-1);f.remove()})})}function DelReplyCancel(b){$(b).parent().parent().remove()}function LikeConv(b,e){var d=$(b);d.hide();d.siblings("img.liking").show();var c=d.attr("likeurl");$.getJSON(c,{conv_root_id:e,t:new Date().getTime()},function(g){if(g.success=="1"){d.text("取消赞");d.attr("onclick","UnLikeConv(this, '"+e+"')");d.show();d.siblings("img.liking").hide();var f=d.parents("div.convbox").find(".convdetail").children("div.like_outbox");f.fadeOut("slow",function(){f.find(".likeboxpart").after('<span class="likename" staff="'+g.like_staff+'"><a class="employee_name" login_account="'+g.like_staff+'" href="#">'+g.nick_name+"</a></span>");f.fadeIn("slow")})}})}function UnLikeConv(b,e){var d=$(b);d.hide();d.siblings("img.liking").show();var c=d.attr("unlikeurl");$.getJSON(c,{conv_root_id:e,t:new Date().getTime()},function(g){if(g.success=="1"){d.text("赞");d.attr("onclick","LikeConv(this, '"+e+"')");d.show();d.siblings("img.liking").hide();var f=d.parents("div.convbox").find(".convdetail").children("div.like_outbox");f.fadeOut("slow",function(){f.find("span[staff='"+g.like_staff+"']").remove();if(f.find("div.likebox").children().length>1){f.fadeIn("slow")}})}})}function ReplyLikeConv(b,e){var d=$(b);d.hide();d.siblings("img.liking").show();var c=d.attr("likeurl");$.getJSON(c,{conv_root_id:e,t:new Date().getTime()},function(g){if(g.success=="1"){d.text("取消赞");d.attr("onclick","ReplyUnLikeConv(this, '"+e+"')");d.show();d.siblings("img.liking").hide();var f=d.parents(".replyfunbox").siblings("div.like_outbox");f.fadeOut("slow",function(){f.find(".likeboxpart").after('<span class="likename" staff="'+g.like_staff+'"><a class="employee_name" login_account="'+g.like_staff+'" href="#">'+g.nick_name+"</a></span>");f.fadeIn("slow")})}})}function ReplyUnLikeConv(b,e){var d=$(b);d.hide();d.siblings("img.liking").show();var c=d.attr("unlikeurl");$.getJSON(c,{conv_root_id:e,t:new Date().getTime()},function(g){if(g.success=="1"){d.text("赞");d.attr("onclick","ReplyLikeConv(this, '"+e+"')");d.show();d.siblings("img.liking").hide();var f=d.parents(".replyfunbox").siblings("div.like_outbox");f.fadeOut("slow",function(){f.find("span[staff='"+g.like_staff+"']").remove();if(f.find("div.likebox").children().length>1){f.fadeIn("slow")}})}})}function ReplyLink_OnClick(b){$divcomment=$(b).parents("div.convbox").find("div.comment");if($.browser.msie&&$.browser.version==7){$divcomment.toggle().toggle().toggle()}else{$divcomment.toggle()}if($divcomment.css("display")!="none"){$divcomment.find("textarea.comtextarea").focus()}var c=$divcomment.find("span.reply_to_close");if(c.length>0){reply_to_close_OnClick(c[0])}}function replyinputarea_pre_OnClick(b){var c=$(b);c.hide();c.siblings(".replyinputarea").show().children("textarea.comtextarea").focus()}function setReplyEnable(b){$(b).parents("div.commentbox").find("input.comenter").removeAttr("disabled")}function setReplyDisable(b){$(b).parents("div.commentbox").find("input.comenter").attr("disabled","disabled")}function _setReplyDisable(b){setTimeout(function(){var c=$(b);if(c.val()==""&&c.siblings("div.reply_to_box").css("display")=="none"){setReplyDisable(b);var d=$(b).parent().siblings(".replyinputarea_pre");d.show().siblings(".replyinputarea").hide()}},100)}function reply_insertFace(d){var c=$(d).parents(".commentbox").find(".comtextarea")[0];var e=c.selectionStart;var f=c.value.length;c.value=c.value.slice(0,c.selectionStart)+"["+c.value.slice(c.selectionStart,f);if(document.selection){if(!e){e=0}var b=c.createTextRange();b.moveEnd("character",e+1);b.moveStart("character",e+1);b.select();c.selectionStart=e+1}else{c.setSelectionRange(e+1,e+1)}setTimeout(function(){$(c).focus().keyup()},500)}var insertFile_menu_Template='<a id="[DROPDOWNID]" class="dropdown-toggle" style="float:left;width:100%;height:100%;" role="button" data-toggle="dropdown" href="[MENUPICID]"></a><div class="replyuploadingfilebox" style="display: none;font-style: normal;text-align: left;width: 300px;"><div style="border: 1px solid #CCCCCC;display: inline-block;height: 20px;line-height: 20px;margin-left: 4px;margin-top: -4px;max-width: 270px;overflow: hidden;padding: 0 4px;word-break: break-all;position: relative;"><div style="position: absolute; width: 100%; background-color: red;"></div><img src="[LOADINGSMALLSRC]"/><span>正在上传：</span><span class="uploadingfilename"></span><div class="uploadingfileprogress"></div></div></div><ul id="[MENUPICID]" class="dropdown-menu picmenu" role="menu" aria-labelledby="[DROPDOWNID]"><li><a class="replyfilesel_a" tabindex="-1" style="overflow:hidden;"><form name="upload_file"  method="post" enctype="multipart/form-data"><input name="hpost_to_group" type="hidden" value="[HPOST_TO_GROUP]"/><span style="cursor:pointer;display: inline-block;position: relative;width: 154px;"><input type=hidden name="uploadSourcePage" value="home"><input tabindex="-1" name="filedata" hidefocus="hidefocus"  onchange="replyfileSelect(this)" size="1" style="cursor: pointer;left: 0;filter:alpha(opacity = 0); width:70px;opacity:0;-moz-opacity:0;position: absolute;top: 0;z-index: 1000002;outline: none;" multiple="" type="file">上传一个图片/文件</span></form></a></li><li class="picmenuspliter"><a tabindex="-1" href="#" class="picmenuspliter_a"></a></li><li><a tabindex="-1" data-toggle="modal" show=false href="#openfiledig_replyfile" >选择一个已有图片/文件</a></li></ul>';var insertFile_filediag_Template='<div class="modal" id="openfiledig_replyfile" data-backdrop=false style="display:none;width:735px;margin-left: -430px;" show=false> <div class="modal-header" style="padding: 0;"> <a class="close" data-dismiss="modal">×</a> <h5 style="margin: 0 0 0 10px;line-height: 25px;">选择一个文档</h5> </div> <div id="openfiledig_replyfile_files" class="modal-body" style="padding:1px;max-height: 450px;"> </div> <div class="modal-footer" style="padding: 5px 5px 5px 0;"> <a href="javascript:insertReplyFileID();" class="btn btn-primary insertSelFile" style="color:white;display:none;">添加附件</a> <A class=btn href="#" data-dismiss="modal" >关闭</A> </div> </div>';function reply_insertFile(c){var e=$(c);var f=$(c).parents(".commentbox").find(".comtextarea");if(f.val()==""){f.val(" ")}if(!e.hasClass("dropdown")){var b="drop_picmenu_"+new Date().getTime();var d="menuPic_"+new Date().getTime();e.append(insertFile_menu_Template.replace("[MENUPICID]",d).replace("[MENUPICID]",d).replace("[DROPDOWNID]",b).replace("[DROPDOWNID]",b).replace("[LOADINGSMALLSRC]",g_resource_context+"bundles/fafatimewebase/images/loadingsmall.gif").replace("[HPOST_TO_GROUP]",$("#hpost_to_group").val()));e.find(".replyfilesel_a").mousemove(function(j){var l=$(document);var g=$(this).offset();var k=j.clientX-(g.left-l.scrollLeft())-50;var h=j.clientY-(g.top-l.scrollTop())-20;$(this).find("input:file").css("left",k);$(this).find("input:file").css("top",h)});e.addClass("dropdown").addClass("open");if($("#openfiledig_replyfile").length==0){$("body").append(insertFile_filediag_Template)}}var b=e.children("a").first().attr("id");$("#openfiledig_replyfile").attr("dropdownid",b).off("shown").on("shown",{Aurl:g_documnet_selectUrl,dropdownid:b},openfiledig_replyfile_OnShown)}function openfiledig_replyfile_OnShown(b){$("#"+b.data.dropdownid).parent().removeClass("open");if($("#openfiledig_replyfile").attr("isloaded")!="1"){LoadComponent("openfiledig_replyfile_files",b.data.Aurl);$("#openfiledig_replyfile").attr("isloaded","1")}}function insertReplyFileID(){var b=getCurrentSelectedFileID();if(b.fileId&&b.fileId!=""){addReplyFile(b.fileName,b.fileId)}$("#openfiledig_replyfile").modal("hide")}function addReplyFile(d,e){var c=$("#"+$("#openfiledig_replyfile").attr("dropdownid")).parents(".commentbox").find(".lib_attachs_filesList");if(c.find("input[value='"+e+"']").length>0){return}var b='<span class="NotifyObj"><input type="hidden" value="'+e+'"><span class="NotifyPerson">'+d+'</span><span class="NotifyClose" onclick="ReplyAttachClose_OnClick(this)">×</span></span>';c.append(b);c.parent().show()}function ReplyAttachClose_OnClick(b){var d=$(b);var c=d.parents(".lib_attachs_filesList");d.parent().remove();if(c.children().length==0){c.parent().hide()}}function replyfileSelect(d){var e=$(d);var c=e.val().split("\\");fn=c[c.length-1];var b=e.parents(".dropdown");b.removeClass("open");b.find(".replyuploadingfilebox").show().find(".uploadingfilename").text(fn);b.find("form").ajaxSubmit({dataType:"json",url:g_documnet_uploadUrl,method:"post",uploadProgress:function(j,h,g,f){b.find(".uploadingfileprogress").css("width",f+"%")},success:function(f){if(f.succeed){addReplyFile(fn,f.fileid);b.find(".replyuploadingfilebox").hide().find(".uploadingfilename").text("")}else{b.find(".replyuploadingfilebox").find(".uploadingfilename").text("文件上传失败！")}b.find(".uploadingfileprogress").css("width","0%")}})}function GetReplyInputAttach(c){var b=$.unique(c.parents("div.commentbox").find(".lib_attachs_filesList input").map(function(){return $(this).val()})).toArray();return b}function GetReplyInputAttachName(c){var b=$.unique(c.parents("div.commentbox").find(".lib_attachs_filesList span.NotifyPerson").map(function(){return $(this).text()})).toArray();return b}function ClearReplyInputAttach(b){b.parents("div.commentbox").find(".lib_attachs_filesList").empty().parent().hide()}function ReplyConv(d){var g=$(d);var j=g.parents("div.commentbox").find("textarea.comtextarea");var b=j.val();var c=j.siblings("div.reply_to_box").find("a.reply_to_staff").attr("login_account");var f=j.siblings("div.reply_to_box").find("a.reply_to_staff").text();if(b==""){return}var e=g.attr("replyurl");var h=g.attr("conv_root_id");setReplyDisable(d);setReplying(d,true);$.post(e,{trend:manager_trend,conv_root_id:h,replayvalue:b,reply_to:c,reply_to_name:f,attachs:GetReplyInputAttach(g),attachs_name:GetReplyInputAttachName(g),t:new Date().getTime()},function(l){j.val("");setReplying(d,false);var m=j.parent().siblings(".replyinputarea_pre");m.show().siblings(".replyinputarea").hide();ClearReplyInputAttach(g);var k=g.parents("div.commentbox").find("div.smalltopic").children("ul");k.prepend(l);$replynum=$(d).parents("div.convbox").find("span.replynum");var o=new Number($replynum.first().text());$replynum.text(o+1);k.children("li").first().css("display","none").fadeIn("slow")})}function setReplying(b,c){$(b).val(c?"发布...":"确 定")}function reply_to_close_OnClick(b){var c=$(b);c.siblings("span").children(".reply_to_staff").attr("login_account","").text("");c.parent().hide()}function reply_to_link_OnClick(c){var e=$(c);var b=e.parents("div.commentbox").find("div.reply_to_box").show();var f=b.find("a.reply_to_staff");var d=e.parent().parent().siblings("p.reply_content").children("a.employee_name").first();f.attr("login_account",d.attr("login_account")).text(d.text());replyinputarea_pre_OnClick(e.parents("div.commentbox").children("div.replyinputarea_pre")[0])}function btnVote_OnClick(d){var h=$(d);var f=h.siblings(".ht_vote_url").val();var e=h.siblings(".ht_vote_id").val();var c=h.siblings(".ht_is_multi").val();var g="";if(c=="0"){g=h.parent().siblings(".votelist").find("input:radio:checked").val()}else{g=h.parent().siblings(".votelist").find("input:checkbox:checked").map(function(){return $(this).val()}).toArray()}if(g==""||typeof(g)=="undefined"){$(d).siblings("span.vote_notice").css("color","red").text("请选择投票选项！").show();var b=$(d).siblings("span.vote_notice");setTimeout(function(){b.hide()},3000);return}h.attr("disabled","disabled");h.val("投票中...");$.post(f,{trend:manager_trend,vote_id:e,is_multi:c,optionids:g},function(k){var l=$(k).children().children("li").css("display","none");var j=h.parent().parent().parent().parent();j.after(l);j.remove();l.fadeIn("slow")})}var $_CopyConvModal=null;var _allow_copy="1";var _curr_copyid=null;var _curr_copylastid=null;var _curr_copy_circle=null;var _curr_copy_group=null;var $_curr_copy_sender=null;function CopyConvPc_OnClick(b){var d=$(b);$_curr_copy_sender=d;_curr_copyid=d.attr("copyid");_curr_copylastid=d.attr("copylastid");_curr_copy_circle=d.attr("circle_id");_curr_copy_group=d.attr("group_id");$_CopyConvModal=$("#_CopyConvModal");if($_CopyConvModal.length==0){var c='<div class="modal" id="_CopyConvModal" style="display:none;width:320px;margin-left: -245px;" show="false"><div class="modal-header"><a class="close" data-dismiss="modal">×</a>转发</div><div id="_CopyConvModalBody" class="modal-body" style="padding:14px;"><div class="urlloading"><div /></div></div></div>';$("body").append(c);$_CopyConvModal=$("#_CopyConvModal");$_CopyConvModal.modal();$.get(d.attr("tplurl"),{t:new Date().getTime()},function(e){$_CopyConvModal.children("#_CopyConvModalBody").empty().append(e);$_CopyConvModal.on("shown",_CopyConvModal_OnShown);_CopyConvModal_OnShown()})}else{$_CopyConvModal.modal()}}function CopyConv_OnClick(b){var d=$(b);$_curr_copy_sender=d;_curr_copyid=d.attr("copyid");_curr_copylastid=d.attr("copylastid");_curr_copy_circle=d.attr("circle_id");_curr_copy_group=d.attr("group_id");$_CopyConvModal=$("#_CopyConvModal");if($_CopyConvModal.length==0){var c='<div class="modal" id="_CopyConvModal" style="display:none;width:490px;margin-left: -245px;" show="false"><div class="modal-header"><a class="close" data-dismiss="modal">×</a>转发</div><div id="_CopyConvModalBody" class="modal-body" style="padding:14px;"><div class="urlloading"><div /></div></div></div>';$("body").append(c);$_CopyConvModal=$("#_CopyConvModal");$_CopyConvModal.modal();$.get(d.attr("tplurl"),{t:new Date().getTime()},function(e){$_CopyConvModal.children("#_CopyConvModalBody").empty().append(e);$_CopyConvModal.on("shown",_CopyConvModal_OnShown);_CopyConvModal_OnShown()})}else{$_CopyConvModal.modal()}}function _CopyConvModal_OnShown(){HideCopyConvErr();$_CopyConvModal.find("#btnCopyConv").attr("disabled","disabled");var g=$_curr_copy_sender.parents(".convbox");var h=g.find("span.conv_content").text();if(h.length>100){h=h.substr(0,100)+"..."}var e=g.find(".post_staffname");$_CopyConvModal.find("#copy_content").val("转发");if(g.find("div.copyconv_d").length>0){$_CopyConvModal.find("#copy_content").val("//@"+e.text()+"{"+e.attr("eshortname")+"}:"+h);var d=g.find(".copyconv_d").children("span.repost").children("span").text();if(d.length>100){d=d.substr(0,100)+"..."}var j=g.find(".copyconv_d").children("span.repost").children("a.employee_name");$_CopyConvModal.find(".oldconv_content").text("@"+j.text()+"{"+j.attr("eshortname")+"}:"+d)}else{$_CopyConvModal.find(".oldconv_content").text("@"+e.text()+"{"+e.attr("eshortname")+"}:"+h)}var c=$_CopyConvModal.find("#copy_circle_sel");var b=c.find("option");if(_curr_copy_group=="ALL"){if(c.val()==_curr_copy_circle&&b.length<=1){}else{for(var f=0;f<b.length;f++){if(b.eq(f).val()!=_curr_copy_circle){c.val(b.eq(f).val());break}}}}else{}getAllowCopy(c[0]);copy_circle_sel_OnChange(c[0])}function HideCopyConvErr(){$_CopyConvModal.find("div.copyerrmsg").hide();$_CopyConvModal.find("#btnCopyConv").removeAttr("disabled");$_CopyConvModal.find("#copy_content").removeAttr("disabled")}function ShowCopyConvErr(b){$_CopyConvModal.find("div.copyerrmsg").text(b).show();$_CopyConvModal.find("#btnCopyConv").attr("disabled","disabled");$_CopyConvModal.find("#copy_content").attr("disabled","disabled")}function getAllowCopy(b){$.getJSON($(b).attr("allowurl"),{network_domain:g_curr_network_domain,t:new Date().getTime()},function(c){_allow_copy=c.allow_copy;copy_group_sel_OnChange()})}var txtcopy_to_group_source_url="";var txtcopy_to_group_source_circle="";function copy_circle_sel_OnChange(c){var d=$(c);var b=d.siblings("#copy_group_sel");b.children(":not(#grouploading)").hide();b.children("#grouploading").show();txtcopy_to_group_source_url=d.attr("groupurl");txtcopy_to_group_source_circle=d.val();$.getJSON(txtcopy_to_group_source_url,{circle:txtcopy_to_group_source_circle,t:new Date().getTime()},function(f){txtcopy_to_group_source_all=f;for(var e=0;e<txtcopy_to_group_source_all.length;e++){txtcopy_to_group_source_all[e].index=e;txtcopy_to_group_source_all[e].toString=function(){return this.index}}b.children("#grouploading").hide();$("#acopy_to_group").text("全体成员").show().parent().parent().show();$("#hcopy_to_group").val("ALL");copy_group_sel_OnChange()})}function copy_group_sel_OnChange(){if(txtcopy_to_group_source_circle!=_curr_copy_circle&&_allow_copy=="1"){ShowCopyConvErr("该条消息不能被转发哟！")}else{HideCopyConvErr()}}var txtcopy_to_group_source_all=[];var txtcopy_to_group_source_100=[];function txtcopy_to_group_source(b,c){if(txtcopy_to_group_source_all.length>0){return txtcopy_to_group_source_all}$.getJSON(txtcopy_to_group_source_url,{circle:txtcopy_to_group_source_circle,query:this.query,t:new Date().getTime()},function(e){txtcopy_to_group_source_100=e;for(var d=0;d<txtcopy_to_group_source_100.length;d++){txtcopy_to_group_source_100[d].index=d;txtcopy_to_group_source_100[d].toString=function(){return this.index}}c(txtcopy_to_group_source_100)});return null}function txtcopy_to_group_highlighter(b){return"<span><img src='"+b.group_photo_url+"' style='width:48px; height:48px; margin-right:10px' onerror=\"this.src='"+g_resource_context+"bundles/fafatimewebase/images/no_photo.png'\"/>"+b.group_name+"</span>"}function txtcopy_to_group_matcher(b){if(this.query){return ~b.group_name.toLowerCase().indexOf(this.query.toLowerCase())}else{return true}}function txtcopy_to_group_sorter(b){return b}function txtcopy_to_group_updater(b){var c=txtcopy_to_group_source_all.length>0?txtcopy_to_group_source_all:txtcopy_to_group_source_100;$("#acopy_to_group").text(c[b].group_name).show();$("#hcopy_to_group").val(c[b].group_id);$("#txtcopy_to_group").hide();$("#bcancel_copy_to_group").show();this.query="";copy_group_sel_OnChange();return""}function acopy_to_group_OnClick(){if(txtcopy_to_group_source_all.length==0){$("#acopy_to_group").attr("title","你还未加入该圈子的任何群，只能转给全体成员！");return}else{$("#acopy_to_group").removeAttr("title")}$("#acopy_to_group").hide();$("#bcancel_copy_to_group").hide();var b=$("#txtcopy_to_group").show().focus();var c=b.data("typeahead");c.process(txtcopy_to_group_source_all)}function bcancel_copy_to_group_OnClick(){$("#acopy_to_group").text("全体成员").show();$("#hcopy_to_group").val("ALL");$("#bcancel_copy_to_group").hide();copy_group_sel_OnChange()}function copy_content_OnBlur(b){var c=$(b);if(c.val().length==0){$_CopyConvModal.find("#btnCopyConv").attr("disabled","disabled")}else{$_CopyConvModal.find("#btnCopyConv").removeAttr("disabled")}}function btnCopyConv_OnClick(d){var e=$(d);var b=$_CopyConvModal.find("#copy_content").val();if(!b){return}var c=$("#hcopy_to_group").val();if(txtcopy_to_group_source_circle||txtcopy_to_group_source_circle!=""||c||c!=""){}else{alert("系统出错？无法转发");return}$_CopyConvModal.modal("hide");$.post(e.attr("copyurl"),{trend:manager_trend,copy_content:b,post_to_circle:txtcopy_to_group_source_circle,post_to_group:c,copy_id:_curr_copyid,copy_last_id:_curr_copylastid,t:new Date().getTime()},function(f){if(f.success=="1"){e.parents("div.convbox").find("span.copynum").each(function(h,j){var g=$(j);var k=new Number(g.text());g.text(k+1)});if(window.OnPublished){window.OnPublished(f.conv_id)}}else{console.debug(f)}},"json")}function AttenConv_OnClick(d){var b='<div class="label_outbox AttenLabelBox" style="position: absolute; background: white; z-index: 999; right: 0px; bottom: 20px;"><span class="label_box label_box_edit" style="line-height: 24px; "><div style="color: #888; border-bottom: 1px solid;">收藏成功！你可输入标签以便分类</div><span style="color: #888;">标签：</span><span class="label_allname"></span><span class="label_delname"></span><span class="label_edit"> <input class="label_input" type="text" style="border: 1px solid;" onfocus="CollectLabel.label_input_OnFocus(this)"/> <input class="label_save" type="button" value="保存" atten_id="[ATTEN_ID]" onclick="AttenConvLabelSave_OnClick(this)"/> <input class="label_cancel" type="button" value="取消" onclick="AttenConvLabelCancel_OnClick(this)" /> </span></span></div>';var f=$(d);f.children("span").hide();f.children("img.attening").show();var e=f.attr("attenurl");var c=f.attr("attenid");$.getJSON(e,{conv_root_id:c,t:new Date().getTime()},function(g){if(g.success=="1"){var h=new Number(f.find("span.attennum").text());f.find("span.attennum").text(h+1);f.parent().parent().append(b.replace("[ATTEN_ID]",c));f.parent().parent().find("input.label_input").focus()}f.find("span.attentext").text("取消收藏");f.attr("onclick","UnAttenConv_OnClick(this)");f.children("span").show();f.children("img.attening").hide()})}function AttenConv_OnClick_Pc(d){var b='<div class="label_outbox AttenLabelBox" style="position: absolute; background: white; z-index: 999; right: 0px; bottom: 20px;"><span class="label_box label_box_edit" style="line-height: 24px; "><div style="color: #888; border-bottom: 1px solid;">收藏成功！你可输入标签以便分类</div><span style="color: #888;">标签：</span><span class="label_allname"></span><span class="label_delname"></span><span class="label_edit"> <input class="label_input" type="text" style="border: 1px solid;" onfocus="CollectLabel.label_input_OnFocus(this)"/> <input class="label_save" type="button" value="保存" atten_id="[ATTEN_ID]" onclick="AttenConvLabelSave_OnClick(this)"/> <input class="label_cancel" type="button" value="取消" onclick="AttenConvLabelCancel_OnClick(this)" /> </span></span></div>';var f=$(d);f.children("span").hide();f.children("img.attening").show();var e=f.attr("attenurl");var c=f.attr("attenid");$.getJSON(e,{conv_root_id:c,t:new Date().getTime()},function(k){if(k.success=="1"){var m=new Number(f.find("span.attennum").text());if(m==null){m=0}f.find("span.attennum").text(m+1);var g=f.parent().parent().parent();var j=80;var l=g.offset().top+g.height()+5;var h=$(b.replace("[ATTEN_ID]",c));h.css({left:(j.toString()+"px"),top:l.toString()+"px"});$(document.body).append(h);$(document.body).find("input.label_input").focus()}f.find("span.attentext").text("取消收藏");f.attr("onclick","UnAttenConv_OnClick_Pc(this)");f.children("span").show();f.children("img.attening").hide()})}function UnAttenConv_OnClick(b){var d=$(b);d.parent().parent().children("div.AttenLabelBox").remove();d.children("span").hide();d.children("img.attening").show();var c=d.attr("unattenurl");$.getJSON(c,{conv_root_id:d.attr("attenid"),t:new Date().getTime()},function(e){if(e.success=="1"){var f=new Number(d.find("span.attennum").text());d.find("span.attennum").text(f-1);$(".convbox[conv_id='"+d.attr("attenid")+"']").children(".convdetail").find("div.label_outbox").remove()}d.find("span.attentext").text("收藏");d.attr("onclick","AttenConv_OnClick(this)");d.children("span").show();d.children("img.attening").hide()})}function UnAttenConv_OnClick_Pc(b){var d=$(b);d.parent().parent().children("div.AttenLabelBox").remove();d.children("span").hide();d.children("img.attening").show();var c=d.attr("unattenurl");$.getJSON(c,{conv_root_id:d.attr("attenid"),t:new Date().getTime()},function(e){if(e.success=="1"){var f=new Number(d.find("span.attennum").text());d.find("span.attennum").text(f-1)}d.find("span.attentext").text("收藏");d.attr("onclick","AttenConv_OnClick_Pc(this)");d.children("span").show();d.children("img.attening").hide()})}function AttenConvLabelSave_OnClick(d){var g=$(d);var e=g.parent().siblings(".label_allname");var b=g.siblings("input.label_input").val();if(b!=""){e.append("<span class='label_name'>"+b+"</span>")}var c=e.children("span.label_name").map(function(){return $(this).text()}).toArray();var f=g.attr("atten_id");$.getJSON(g_saveLabelUrl,{atten_id:f,label_names:c,t:new Date().getTime()},function(h){if(h.success=="1"){if(c[c.length-1]!=""){var j=GetAttenConvLabelDom(f,c[c.length-1]);$(".convbox[conv_id='"+f+"']").children(".convdetail").append(j);j.fadeIn(200)}}g.attr("disabled",false).val("保存");g.parents("div.AttenLabelBox").remove()});g.siblings("input.label_input").val("");g.attr("disabled","disabled").val("保存中")}function GetAttenConvLabelDom(e,c){var b=arguments[2]?arguments[2]:"1分钟前";var d=[];d.push("<div style='display:none;' class='label_outbox'>");d.push("<span class='label_title'>标签：</span>");d.push("<span class='label_box'>");d.push("<span class='label_allname'><span class='label_name'>"+c+"</span></span>");d.push("<span class='label_delname'></span>");d.push("<span class='label_edit'>");d.push("<span onclick='CollectLabel.label_add_OnClick(this)' class='label_add'> + 加标签</span>");d.push("<input type='text' onfocus='CollectLabel.label_input_OnFocus(this)' class='label_input' style='border: 1px solid;'>");d.push("<input type='button' atten_id='"+e+"' onclick='CollectLabel.label_save_OnClick(this)' value='保存' class='label_save'>");d.push("<input type='button' onclick='CollectLabel.label_cancel_OnClick(this)' value='取消' class='label_cancel'>");d.push("</span></span><span class='label_date'>收藏："+b+"</span></div>");return $(d.join(""))}function AttenConvLabelCancel_OnClick(b){var c=$(b);c.parents("div.AttenLabelBox").remove()}function JoinTogether_OnClick(b){var d=$(b);d.text("我要退出");d.attr("onclick","UnJoinTogether_OnClick(this)");var c=d.attr("joinurl");$.getJSON(c,{together_id:d.attr("together_id"),t:new Date().getTime()},function(f){if(f.success=="1"){var e=d.parents("div.convbox").find(".convdetail").children().children("div.together_staffs_outbox");e.fadeOut("slow",function(){e.find(".together_staffsboxpart").after('<span class="together_staff" staff="'+f.join_staff+'"><a class="employee_name" login_account="'+f.join_staff+'" href="#">'+f.nick_name+"</a></span>");e.fadeIn("slow")})}})}function UnJoinTogether_OnClick(b){var d=$(b);d.text("我要参加");d.attr("onclick","JoinTogether_OnClick(this)");var c=d.attr("unjoinurl");$.getJSON(c,{together_id:d.attr("together_id"),t:new Date().getTime()},function(f){if(f.success=="1"){var e=d.parents("div.convbox").find(".convdetail").children().children("div.together_staffs_outbox");e.fadeOut("slow",function(){e.find("span[staff='"+f.join_staff+"']").remove();if(e.find("div.together_staffsbox").children().length>1){e.fadeIn("slow")}})}})}window.picviewer=[];function conv_img_zoomout_OnClick(f){$images=$(f).parent().parent().find("img");var e=$(f).parentsUntil("div.convbox[conv_id]");var g=$(e[e.length-1]).parent().attr("conv_id");var c=[];for(var d=0;d<$images.length;d++){c.push({convid:g,url:$($images[d]).attr("src")})}$(f).parent().parent().children().hide();var b=new PictureSNSViewer();b.boxshow({ImgList:c,res:$(f).parent().parent()[0],sender:f,load_conv_url:g_load_conv_url,onClose:function(){$(f).parent().parent().children().show()}});picviewer.push(b)}function conv_img_zoomin_OnClick(c){var d=$(c);d.parent().hide();d.parent().siblings("img.imgzoomsmall").show();var b=d.parents(".convbox").offset().top-50;if($(document).scrollTop()>b){$(document).scrollTop(b)}}function conv_img_zoomin_a_OnClick(b){conv_img_zoomin_OnClick($(b).parent().siblings("img.imgzoonbig")[0])}var CollectLabel={$element:null,$menu:null,shown:false,label_add_OnClick:function(b){var c=$(b);c.parents(".label_box").addClass("label_box_edit");c.siblings(".label_input").focus()},label_cancel_OnClick:function(b){var d=$(b);var c=this.$element.parent().siblings(".label_allname");var e=c.siblings(".label_delname");c.children("span.new_label_name").remove();e.children().detach().appendTo(c);d.siblings(".label_input").val("");d.parents(".label_box").removeClass("label_box_edit")},label_save_OnClick:function(c){this.addlabel();var f=$(c);var e=f.parent().siblings(".label_allname");var b=e.children("span.label_name").map(function(){return $(this).text()}).toArray();var d=this;$.getJSON(g_saveLabelUrl,{atten_id:f.attr("atten_id"),label_names:b,t:new Date().getTime()},function(h){if(h.success=="1"){e.children("span.new_label_name").removeClass("new_label_name");e.siblings(".label_delname").empty();for(var g=0;g<b.length;g++){if(d.$menu.children("li").children("a:contains('"+b[g]+"')").length==0&&b[g]!=""){d.$menu.append("<li><a>"+b[g]+"</a></li>")}}}});f.siblings(".label_input").val("");f.parents(".label_box").removeClass("label_box_edit")},label_input_OnFocus:function(b){var d=$(b);if(d.data("hasInited")){this.$element=d;var c=this;setTimeout(function(){c.show()},150);return}d.data("hasInited",1);if(this.$menu){}else{this.$menu=$('<ul class="collectlabel-menu"><li class="title">不超过3个标签</li></ul>').appendTo("body");var c=this;$.getJSON(g_getLabelUrl,{t:new Date().getTime()},function(f){for(var e=0;e<f.length;e++){c.$menu.append("<li><a>"+f[e].label_name+"</a></li>")}})}this.$element=d;this.$element.on("blur",$.proxy(this.blur,this)).on("keypress",$.proxy(this.keypress,this)).on("keyup",$.proxy(this.keyup,this));if($.browser.webkit||$.browser.msie){d.on("keydown",$.proxy(this.keydown,this))}this.$menu.on("click",$.proxy(this.click,this)).on("mouseenter","li",$.proxy(this.mouseenter,this))},show:function(){var b=$.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:b.top+b.height,left:b.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},click:function(b){b.stopPropagation();b.preventDefault();this.select()},mouseenter:function(b){this.$menu.find(".active").removeClass("active");$(b.currentTarget).filter(":not(.title)").addClass("active")},select:function(){var b=this.$menu.find(".active");if(b.length==0){return}var c=b.text();this.$element.val(c).change();this.addlabel();return this.hide()},addlabel:function(){var b=this.$element.val().replace(/\s\s*$/,"").replace(/\'|\"/g,"").substr(0,6);var d=this.$element.parent().siblings(".label_allname");var e=d.siblings(".label_delname");this.$element.val("");if(b==""){return}if(d.children().length>=3){return}if(d.children("span.label_name:contains('"+b+"')").length>0){return}var c=e.children("span.label_name:contains('"+b+"')");if(c.length>0){c.detach().appendTo(d)}else{d.append('<span class="label_name new_label_name">'+b+"</span>")}if(this.shown){this.show()}},blur:function(c){var b=this;setTimeout(function(){b.hide()},150)},move:function(b){if(!this.shown){return}switch(b.keyCode){case 9:case 13:case 27:b.preventDefault();break;case 38:b.preventDefault();this.prev();break;case 40:b.preventDefault();this.next();break}b.stopPropagation()},backspace:function(){var c=this.$element.val();if(c!=""){return}var d=this.$element.parent().siblings(".label_allname");var e=d.siblings(".label_delname");var b=d.children().last();if(b.hasClass("new_label_name")||e.children("span.label_name:contains('"+b.text()+"')")>0){b.remove()}else{b.detach().appendTo(e)}if(this.shown){this.show()}},keydown:function(b){this.iskeypress=true;this.LastKeyDownCode=b.keyCode;this.suppressKeyPressRepeat=!~$.inArray(b.keyCode,[40,38,9,13,27]);this.move(b);if(b.keyCode==8){this.backspace()}},keypress:function(b){this.iskeypress=true;if(this.suppressKeyPressRepeat){return}this.move(b);if(b.keyCode==8){this.backspace()}},keyup:function(b){if(!this.iskeypress){return}this.iskeypress=false;if(this.LastKeyDownCode==229){return}switch(b.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown||this.$element.val().length>0){this.addlabel();return}this.select();break;case 27:this.$element.blur();this.label_cancel_OnClick(this.$element.siblings("input.label_cancel"));if(!this.shown){return}this.hide();break;case 32:this.addlabel();break}b.stopPropagation();b.preventDefault()},next:function(c){var d=this.$menu.find(".active").removeClass("active"),b=d.next();if(!b.length){b=$(this.$menu.find("li:not(.title)")[0])}b.addClass("active")},prev:function(c){var d=this.$menu.find(".active").removeClass("active"),b=d.prev();if(b.hasClass("title")){b=b.prev()}if(!b.length){b=this.$menu.find("li:not(.title)").last()}b.addClass("active")}};var ReplyList={getPage:function(d){var g=new Date().getTime();var b=$(".relaydetail_list").first();var e=b.find(".reply_pager");var c=e.attr("url");var f=e.attr("conv_root_id");b.empty().append("<br>").attr("id",g);LoadComponent(g,c,{conv_root_id:f,pageindex:d,t:new Date().getTime()})}};var CopyList={getPage:function(d){var c=$("#convcopylist");var e=c.find(".copylist_pager");var b=e.attr("url");var f=e.attr("conv_root_id");c.empty().append("<br>");LoadComponent("convcopylist",b,{conv_root_id:f,pageindex:d,t:new Date().getTime()})}};function getTopConv(d){var b=$("#con_"+d.attr("id"));var c=b.find("ul.conv_box[type='topbox']");if(typeof(d.attr("gettopurl"))=="undefined"||d.attr("gettopurl")==""){return}$.post(d.attr("gettopurl"),{},function(e){if(c.length>0){c.remove()}$ul=$(e).css("display","none");if($ul.find("li").length==0){$ul.css("height","0px")}b.find("div.topicbox").prepend($ul);$ul.fadeIn("slow");overLengthAct();setListAct();registermoreoper();d.attr("isloadtop","1")})}function topControl(d,b){var c=$("#two1.hover[gettopurl],#two2.hover[gettopurl],#two3.hover[gettopurl],#two4.hover[gettopurl],#two5.hover[gettopurl],#two6.hover[gettopurl]");if(c.length>0){getTopConv(c)}}function totalLoad(b){var d=b.attr("pageindex");if(!d){d=1}var c=b.attr("scrollloadnum");if(!c){c=1}return(d*1-1)*3+(c*1)}function act_register(b,c,d){b.live(c,function(){$this=$(this);var g=$this.attr("act_url");var f=$this.parent().parent().attr("conv_id");var e={conv_id:f,network_domain:g_curr_network_domain};$.post(g,e,function(h){d(f,h)})})}function getMoreSetUrl(b){return $("ul.set_list[conv_id='"+b+"']")}function setHS(d,b){var c=getMoreSetUrl(d).find("span[act='"+b+"']");c.parent().siblings("li").find("span[act*='"+b.replace("cancel_","")+"']").parent().show();c.parent().hide()}function setListAct(){var k=$("span.official_publish_type_action");for(var e=0;e<k.length;e++){var d=$(k[e]);if(d.attr("register")=="1"){continue}if(ismanager!="1"){d.siblings("ul.set_list").find("span[act*='top']").parent().remove();d.siblings("ul.set_list").find("span[act*='hide']").css("margin-left","-20px")}d.bind("mouseover",function(m){if(checkHover(m,this)){if(typeof(set_ul_timer)!="undefined"){clearTimeout(set_ul_timer)}var n=$(this);var j=$(this).siblings("ul.set_list");var l=n.css("left").replace("px","");var o=n.css("top").replace("px","");j.css({left:(l*1+n.parent().width()-j.width()).toString()+"px",top:(o*1+n.height()).toString()+"px"});set_ul_timer=setTimeout(function(){j.show()},500)}});d.bind("mouseout",function(j){if(checkHover(j,this)){$this=$(this);if(typeof(set_ul_timer)!="undefined"){clearTimeout(set_ul_timer)}set_ul_timer=setTimeout(function(){$this.siblings("ul.set_list").hide()},500)}});var g=d.siblings("ul.set_list");g.bind("mouseover",function(j){if(checkHover(j,this)){if(typeof(set_ul_timer)!="undefined"){clearTimeout(set_ul_timer)}}});g.bind("mouseout",function(j){if(checkHover(j,this)){$this=$(this);set_ul_timer=setTimeout(function(){$this.hide()},500)}});g.attr("top")==g.attr("conv_id")?g.find("span[act='top']").parent().hide():g.find("span[act='cancel_top']").parent().hide();g.attr("hide")==g.attr("conv_id")?g.find("span[act='hide']").parent().hide():g.find("span[act='cancel_hide']").parent().hide();$links=g.find("span.oneset");for(var c=0;c<$links.length;c++){$link=$($links[c]);var b=$link.attr("act");var h=function(j,l){},f="click";if(b=="top"){h=function(j,l){setHS(j,"top");topControl(j,"1")}}else{if(b=="cancel_top"){h=function(j,l){setHS(j,"cancel_top");topControl(j,"0")}}else{if(b=="hide"){h=function(l,m){if(m.s=="1"){setHS(l,"hide");var j=$("#con_two1 div[conv_id='"+l+"']");if(j.length>0){j.attr("hide","").parent().remove();if(j.parent().parent().attr("type")=="topbox"){topControl(l,"1")}}}}}else{if(b=="cancel_hide"){h=function(j,l){if(l.s=="1"){setHS(j,"cancel_hide");$("#two1").attr("isloaded","0")}}}}}}act_register($link,f,h)}d.attr("register","1")}}function registermoreoper(){var e=$("span.moreoper");for(var d=0;d<e.length;d++){var b=$(e[d]);if(b.register=="1"){continue}b.bind("mouseover",function(f){if(checkHover(f,this)){if(typeof(moreoper_timer)!="undefined"){clearTimeout(moreoper_timer)}var g=$(this);moreoper_timer=setTimeout(function(){g.siblings("ul.convoper").slideDown(200)},500)}});b.bind("mouseout",function(f){if(checkHover(f,this)){if(typeof(moreoper_timer)!="undefined"){clearTimeout(moreoper_timer)}var g=$(this);moreoper_timer=setTimeout(function(){g.siblings("ul.convoper").slideUp(200)},500)}});var c=b.siblings("ul.convoper");c.bind("mouseover",function(f){if(checkHover(f,this)){if(typeof(moreoper_timer)!="undefined"){clearTimeout(moreoper_timer)}}});c.bind("mouseout",function(f){if(checkHover(f,this)){$this=$(this);moreoper_timer=setTimeout(function(){$this.slideUp(200)},500)}});b.attr("register","1")}}var getEventCoord=function(g){var b=g||event,h=document,f=/^b/i.test(h.compatMode)?h.body:h.documentElement,c=typeof b.pageX=="number",j=typeof b.layerX=="number";return{pageX:c?b.pageX:b.clientX+f.scrollLeft,pageY:c?b.pageY:b.clientY+f.scrollTop,clientX:b.clientX,clientY:b.clientY,layerX:j?b.layerX:b.offsetX,layerY:j?b.layerY:b.offsetY}};function checkHover(c,b){if(getEvent(c).type=="mouseover"){return !contains(b,getEvent(c).relatedTarget||getEvent(c).fromElement)&&!((getEvent(c).relatedTarget||getEvent(c).fromElement)===b)}else{return !contains(b,getEvent(c).relatedTarget||getEvent(c).toElement)&&!((getEvent(c).relatedTarget||getEvent(c).toElement)===b)}}function contains(b,c){if(b.contains){return b!=c&&b.contains(c)}else{return !!(b.compareDocumentPosition(c)&16)}}function getEvent(b){return b||window.event}var Employees={hoverTimer:null,outTimer:null,_account:"",_ajaxObj:null,empCards:[],modalDlag:null,Aurl:"",personUrl:"",sendMsgUrl:"",attentionUrl:"",getaccountUrl:"",attentionBind:function(){$(".attention,.employee_card_attention").text(function(){var b=$(this).attr("state");return b=="0"?"关注":(b=="1"?"已关注":"互相关注")});$(".attention").attr("class",function(){var b=$(this).attr("state");return b=="0"?"attention attention_concern":(b=="1"?"attention attention_already":"attention attention_mutual")});$(".employee_card_attention").attr("class",function(){var b=$(this).attr("state");return b=="0"?"employee_card_attention employee_card_attention_concern":(b=="1"?"employee_card_attention employee_card_attention_already":"employee_card_attention employee_card_attention_mutual")});$(".attention").live("mouseover",function(){if($(this).attr("state")!="0"){$(this).attr("class","attention attention_escconcern");$(this).text("取消关注")}});$(".employee_card_attention").live("mouseover",function(){if($(this).attr("state")!="0"){$(this).attr("class","employee_card_attention employee_card_attention_escconcern");$(this).text("取消关注")}});$(".attention").live("mouseout",function(){var c=$(this).attr("state");if(c!="0"){var b=c=="1"?"attention attention_already":"attention attention_mutual";$(this).attr("class",b);$(this).text(c=="1"?"已关注":"互相关注")}});$(".employee_card_attention").live("mouseout",function(){var c=$(this).attr("state");if(c!="0"){var b=c=="1"?"employee_card_attention employee_card_attention_already":"employee_card_attention employee_card_attention_mutual";$(this).attr("class",b);$(this).text(c=="1"?"已关注":"互相关注")}});$(".attention_concern,.employee_card_attention_concern").live("click",function(){var b=$(this);if(b.attr("submit")=="1"){return}b.attr("submit","1");if(b.attr("class").indexOf("employee_card_attention")>-1){b.attr({"class":"employee_card_attention employee_card_attention_loading"})}else{b.attr({"class":"attention attention_loading"})}b.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');$.post(Employees.attentionUrl+"/"+b.attr("login_account"),"",function(e){if(e.succeed){var c=e.both=="1"?"attention attention_already":"attention attention_mutual";if(b.attr("class").indexOf("employee_card_attention")>-1){c=e.both=="1"?"employee_card_attention employee_card_attention_already":"employee_card_attention employee_card_attention_mutual"}(b).attr({state:e.both,"class":c});(b).html(e.both=="1"?"已关注":"互相关注");$(".attention[login_account='"+b.attr("login_account")+"']").attr({state:e.both,"class":c});$(".attention[login_account='"+b.attr("login_account")+"']").text(e.both=="1"?"已关注":"互相关注");b.removeAttr("submit");Employees.empCards[b.attr("login_account")]=null}})});$(".attention_escconcern,.employee_card_attention_escconcern").live("click",function(){var b=$(this);if(b.attr("submit")=="1"){return}b.attr("submit","1");if(b.attr("class").indexOf("employee_card_attention")>-1){b.attr({"class":"employee_card_attention employee_card_attention_loading"})}else{b.attr({"class":"attention attention_loading"})}b.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');$.post(Employees.attentionUrl.replace("attention","cancelattention")+"/"+b.attr("login_account"),"",function(c){if(c.succeed){if(b.attr("class").indexOf("employee_card_attention")>-1){(b).attr({state:"0","class":"employee_card_attention employee_card_attention_concern"});(b).html("关注");$(".attention[login_account='"+b.attr("login_account")+"']").attr({state:"0","class":"employee_card_attention employee_card_attention_concern"});$(".attention[login_account='"+b.attr("login_account")+"']").text("关注")}else{(b).attr({state:"0","class":"attention attention_concern"});(b).html("关注");$(".attention[login_account='"+b.attr("login_account")+"']").attr({state:"0","class":"attention attention_concern"});$(".attention[login_account='"+b.attr("login_account")+"']").text("关注")}b.removeAttr("submit");Employees.empCards[b.attr("login_account")]=null}})})},employeeBind:function(){$(".employee_name").live("mouseout",function(b){if(checkHover(b,this)){clearTimeout(Employees.hoverTimer);Employees.outTimer=setTimeout("Employees.hide()",500)}});$(".employee_name").live("mouseover",function(g){clearTimeout(Employees.outTimer);if(checkHover(g,this)){var d=getEventCoord(g);var c=$(this).text();var f=$(this).attr("login_account");if(f!=null&&f!=""){$(this).attr("target","_blank");$(this).attr("href",Employees.personUrl.replace("foo",f));c=f}else{if(Employees.empCards[c]==null){var b=$(this).attr("isload");if(b!="1"&&b!="2"){$(this).attr("target","_self");$(this).attr("href","javascript:Employees.getEmpAccount('"+c+"')")}}}Employees.hoverTimer=setTimeout(" Employees.show("+(d.pageX)+","+(d.pageY)+",'"+c+"')",500)}});$("#employee_card_dlag_sendmsg").live("click",function(){if(FaFaMessage._conn==null||!FaFaMessage._conn.connected){return}var b=$(this).parent().parent();var c=new roster();c.jid=$(".fafa_jid").text();c.name=$(".personalname").text();c.dept=$(".personaldept").text();FaFaChatWin.AddRoster(c);FaFaChatWin.ShowRoster(c.jid);$("#employee_card_dlag").modal("hide")});$("#employee_card_dlag_storage").live("click",function(e){var c=$(this);var b=c.attr("login_account");if(typeof(b)=="undefined"||b==""){return}c.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中');$.post(c.attr("url")+"?typeid=M001&editType=copy&addr_account="+b,"",function(f){if(f.s=="1"){c.html("已收藏");c.removeAttr("login_account");Employees.empCards[c.attr("login_account")]=null}else{c.html("<font style='color:red'>提交失败</font>")}})})},getEmpAccount:function(b){var c=$("a.employee_name:contains('"+b+"'):not([login_account])");c.attr("isload","2");$.post(Employees.getaccountUrl+"/"+encodeURIComponent(b),"",function(e){if(e==""){return}c.attr("isload","1");c.attr("login_account",e);c.attr("href",Employees.personUrl.replace("foo",e));window.open(c.attr("href"),"","")})},load:function(_Aurl,_personUrl,_sendMsgUrl,_attentionUrl,_getaccountUrl){this.Aurl=_Aurl;this.personUrl=_personUrl;this.sendMsgUrl=_sendMsgUrl;this.attentionUrl=_attentionUrl;this.getaccountUrl=_getaccountUrl;var _cx=$("#employee_card_dlag");if(_cx.length==0){_cx=document.createElement("DIV");_cx.id="employee_card_dlag";_cx.className="modal";with(_cx.style){width="411px";display="none";padding="0px";overflow="hidden";borderRadius="0px 0px 0px 0px"}_cx.innerHTML="<div id='employee_card_dlag_body' class='modal-body' style='overflow:hidden;padding:0px;'></div>";document.body.appendChild(_cx);this.modalDlag=$("#employee_card_dlag");if(this.modalDlag.modal==null){return}this.modalDlag.modal({show:false,backdrop:false});this.modalDlag.on("shown",{Aurl:_Aurl},Employees.getInfo);$("#employee_card_dlag_sendmsg").bind("click",function(){var fafa_jid=$("#emp_card_detail .fafa_jid").text();if(fafa_jid==""){return}})}this.modalDlag.live("mouseout",function(e){clearTimeout(Employees.hoverTimer);if(checkHover(e,this)){Employees.outTimer=setTimeout("Employees.hide()",500)}});this.modalDlag.live("mouseover",function(e){clearTimeout(Employees.outTimer)});this.employeeBind();this.attentionBind()},getInfo:function(b){$("#employee_card_dlag_body").html("");if(Employees.empCards[Employees._account]==null){$("#employee_card_dlag .modal-footer").css({display:"none"});$("#employee_card_dlag_body").append("<div class='urlloading'><div /></div>");Employees._ajaxObj=$.get(b.data.Aurl+"&account="+encodeURIComponent(Employees._account),{t:new Date().getTime()},function(c){Employees._ajaxObj=null;if(c.length==0){return}$("#employee_card_dlag_body").html(c);if($("a.employee_name:contains('"+Employees._account+"')").attr("onlyshow")=="1"){$(".pesonalbutton").css("display","none")}else{$("#employee_card_dlag_personweb").attr("href",$("#emp_card_detail .personweburl").text());$(".pesonalname").attr("href",$("#emp_card_detail .personweburl").text());$("#employee_card_dlag_body urlloading").remove();$("#employee_card_dlag .modal-footer").css({display:"",padding:"5px"});Employees.autoXY();$("#employee_card_dlag .employee_card_attention").text(function(){var d=$("#emp_card_detail .employee_card_attention").attr("state");return d=="0"?"关注":(d=="1"?"已关注":"互相关注")});$("#employee_card_dlag .employee_card_attention").attr("class",function(){var d=$("#emp_card_detail .employee_card_attention").attr("state");return d=="0"?"employee_card_attention employee_card_attention_concern":(d=="1"?"employee_card_attention employee_card_attention_already":"employee_card_attention employee_card_attention_mutual")});Employees.empCards[Employees._account]=$("#employee_card_dlag_body").html();$("a.employee_name:contains('"+Employees._account+"'):not([login_account])").attr("href",$("#employee_card_dlag .personweburl").text());$("a.employee_name:contains('"+Employees._account+"'):not([login_account])").attr("login_account",$("#employee_card_dlag .attention").attr("login_account"))}})}else{$("#employee_card_dlag_body").html(Employees.empCards[Employees._account]);Employees.autoXY();$("a.employee_name:contains('"+Employees._account+"'):not([login_account])").attr("href",$("#employee_card_dlag .personweburl").text());$("a.employee_name:contains('"+Employees._account+"'):not([login_account])").attr("login_account",$("#employee_card_dlag .employee_card_attention").attr("login_account"))}},autoXY:function(){var h=$("#employee_card_dlag_attention");var g=$("#emp_card_detail #attention");var c=g.text();if($("#emp_card_detail .fafa_jid").text()==""){$("#employee_card_dlag .pesonalbutton").html("")}else{$("#employee_card_dlag .pesonalbutton").css({display:""});h.attr("state",c);h.attr("login_account",g.attr("login_account"));if(c!="-1"){h.css({display:""})}else{h.css({display:"none"})}}var b=Employees.modalDlag;var e=b.attr("y")*1,d=b.attr("x")*1,f=b.height();e=e>((self.innerHeight||$(self).height())-f)?e-f-15:e+10;d=d<150?d+20:d;d=d>((self.innerWidth||$(self).width())-150)?d-300:d-150;b.css({top:e,left:d});$("#employee_card_dlag_sendmsg").attr("title",(FaFaMessage._conn==null||!FaFaMessage._conn.connected)?"WebIM未登录，不能发送消息":"立即给TA发送消息")},show:function(b,f,e){this._account=e;var c=b-($(document).scrollLeft()),d=f-$(document).scrollTop();Employees.modalDlag.attr("x",c);Employees.modalDlag.attr("y",d);Employees.modalDlag.css({top:d,left:c,margin:0});if(Employees.modalDlag.css("display")!="none"){if(Employees.empCards[Employees._account]!=null){$("#employee_card_dlag_body").html(Employees.empCards[Employees._account]);Employees.autoXY()}else{Employees.modalDlag.trigger("shown")}}else{Employees.modalDlag.modal("show")}},hide:function(){this._account="";if(Employees._ajaxObj!=null){$("#employee_card_dlag_body urlloading").remove();Employees._ajaxObj.abort()}$("#employee_card_dlag_body").html("");Employees.modalDlag.modal("hide")}};(function(){var c={boxID:"autoTalkBox",valuepWrap:"autoTalkText",wrap:"recipientsTips",listWrap:"autoTipsUserList",position:"autoUserTipsPosition",positionHTML:'<span id="autoUserTipsPosition">&nbsp;123</span>',className:"autoSelected",url:""};var e='<div id="autoTalkBox"style="z-index:-2000;top:$top$px;left:$left$px;width:$width$px;height:$height$px;z-index:1;position:absolute;scroll-top:$SCTOP$px;overflow:hidden;overflow-y:auto;visibility:hidden;word-break:break-all;word-wrap:break-word;*letter-spacing:0.6px;"><span id="autoTalkText"></span></div><div id="recipientsTips" class="recipients-tips"><div style="margin: 2px 0px 2px 2px; border-bottom: 1px solid #ccc;">选择最近@的或直接输入</div><ul id="autoTipsUserList"></ul></div>';var b='<li><a rel="$ID$" >@$NAME${$ESHORTNAME$}</a></li>';var j={$:function(k){return document.getElementById(k)},DC:function(k){return document.createElement(k)},BS:function(){var l=document.body,k=document.documentElement,m=l.scrollTop+k.scrollTop;left=l.scrollLeft+k.scrollLeft;return{top:m,left:left}},FF:(function(){var k=navigator.userAgent.toLowerCase();return/firefox\/([\d\.]+)/.test(k)})()};var f={info:function(l){var n=l.getBoundingClientRect();var k=l.offsetWidth;var m=l.offsetHeight;return{top:n.top,left:n.left,width:k,height:m}},getCursorPosition:function(m){if(document.selection){m.focus();var n=document.selection;var k=null;k=n.createRange();var l=k.duplicate();l.moveToElementText(m);l.setEndPoint("EndToEnd",k);m.selectionStart=l.text.length-k.text.length;m.selectionEnd=m.selectionStart+k.text.length;return m.selectionStart}else{return m.selectionStart}},setCursorPosition:function(l,m){var o=m=="end"?l.value.length:m;if(document.selection){var k=l.createTextRange();k.moveEnd("character",-l.value.length);k.moveEnd("character",o);k.moveStart("character",o);k.select()}else{l.setSelectionRange(o,o);l.focus()}},add:function(l,k){var o=l.value;var m=m||"";if(document.selection){document.selection.createRange().text=k}else{var n=l.selectionStart;var p=l.value.length;l.value=l.value.slice(0,l.selectionStart)+k+l.value.slice(l.selectionStart,p);this.setCursorPosition(l,n+k.length)}},del:function(k,o){var m=this.getCursorPosition(k);var l=k.scrollTop;k.value=k.value.slice(0,m-o)+k.value.slice(m);this.setCursorPosition(k,m-o);j.FF&&setTimeout(function(){k.scrollTop=l},10)}};var h={inquiry:function(n,p,k){if(p==""){return friendsData.slice(0,k)}var m=new RegExp(p,"i");var l=0;var o=[];while(o.length<k&&l<n.length){if(m.test(n[l]["user"])){o.push(n[l])}l++}return o},lastAjaxObj:null,getData:function(l,m,k){if(this.lastAjaxObj){this.lastAjaxObj.abort()}this.lastAjaxObj=$.getJSON(l,{query:m,t:new Date().getTime()},function(n){k(n)})}};var d={_this:null,index:-1,list:null,selectIndex:function(l){if(j.$(c.wrap).style.display=="none"){return true}var k=d.index;switch(l){case 40:k=k+1;break;case 38:k=k-1;break;case 13:return d._this.enter();break}k=k>=d.list.length?0:k<0?d.list.length-1:k;return d.setSelected(k)},setSelected:function(k){if(d.index>=0){d.list[d.index].className=""}d.list[k].className=c.className;d.index=k;return false}};var g=function(k){var m=k.id?j.$(k.id):k.elem;var o=5;var n={};var l="";c.url=k.url?k.url:"";n.start=function(){if(!j.$(c.boxID)){var q=e.slice();var r=f.info(m);var s=j.DC("DIV");var p=j.BS();q=q.replace("$top$",(r.top+p.top)).replace("$left$",(r.left+p.left)).replace("$width$",r.width).replace("$height$",r.height).replace("$SCTOP$","0");s.innerHTML=q;document.body.appendChild(s)}else{n.updatePosstion()}};n.keyupFn=function(t){var t=t||window.event;var r=t.keyCode;if(r==38||r==40||r==13){if(r==13&&j.$(c.wrap).style.display!="none"){n.enter()}return false}var s=f.getCursorPosition(m);if(!s){return n.hide()}var p=m.value.slice(0,s);var w=p.slice(-o);var q=w.match(/(.+)?@([\w\u4e00-\u9fa5]+)$|@$/);if(q==null){return n.hide()}var u=q[2]?q[2]:"";j.$(c.valuepWrap).innerHTML=p.slice(0,p.length-u.length).replace(/\n/g,"<br/>").replace(/\s/g,"&nbsp;")+c.positionHTML;n.showList(u)};n.showList=function(p){l=p;h.getData(c.url,p,n._showList)};n._showList=function(u){var y=b.slice();var x="";var z=u.length;if(z==0){n.hide();return}var t=new RegExp(l);var s="<strong>"+l+"</strong>";for(var w=0;w<z;w++){var q=u[w]["nick_name"].replace(t,s);x+=y.replace("$NAME$",q).replace(/\$ESHORTNAME\$/g,u[w]["eshortname"]).replace("$ID$",u[w]["nick_name"]+"{"+u[w]["eshortname"]+"}")}n.updatePosstion();var r=j.$(c.position).getBoundingClientRect();var B=j.BS();var A=j.$(c.wrap).style;A.top=r.top+20+B.top+"px";A.left=r.left-5+"px";j.$(c.listWrap).innerHTML=x;n.show()};n.KeyDown=function(q){var q=q||window.event;var p=q.keyCode;if(p==38||p==40||p==13){return d.selectIndex(p)}return true};n.updatePosstion=function(){var r=f.info(m);var q=j.BS();var s=j.$(c.boxID).style;s.top=r.top+q.top+"px";s.left=r.left+q.left+"px";s.width=r.width+"px";s.height=r.height+"px";j.$(c.boxID).scrollTop=m.scrollTop};n.show=function(){d.list=j.$(c.listWrap).getElementsByTagName("li");d.index=-1;d._this=n;n.cursorSelect(d.list);$(m).bind("keydown",n.KeyDown);j.$(c.wrap).style.display="block"};n.cursorSelect=function(q){for(var p=0;p<q.length;p++){q[p].onmouseover=(function(r){return function(){d.setSelected(r)}})(p);q[p].onclick=n.enter}};n.hide=function(){d.list=null;d.index=-1;d._this=null;$(m).unbind("keydown",n.KeyDown);j.$(c.wrap).style.display="none"};n.bind=function(){$(m).bind("keyup",n.keyupFn);$(m).bind("click",n.keyupFn);$(m).bind("blur",function(){setTimeout(n.hide,500)})};n.enter=function(){f.del(m,l.length,l);f.add(m,d.list[d.index].getElementsByTagName("A")[0].rel+" ");n.hide();return false};return n};window.userAutoTips=function(l){var k=g(l);k.start();k.bind()};$(".userAutoTips").live("focus",function(){var k=$(this);if(k.attr("hasInituserAutoTips")){return}k.attr("hasInituserAutoTips","1");userAutoTips({elem:this,url:g_userAutoTipsUrl})})})();(function(){var c={boxID:"autoFaceTalkBox",valuepWrap:"autoFaceTalkText",wrap:"recipientsFaceTips",listWrap:"autoFaceTipsUserList",position:"autoFaceUserTipsPosition",positionHTML:'<span id="autoFaceUserTipsPosition">&nbsp;123</span>',className:"autoSelected",url:""};var e='<div id="autoFaceTalkBox" style="z-index:-2000;top:$top$px;left:$left$px;width:$width$px;height:$height$px;z-index:1;position:absolute;scroll-top:$SCTOP$px;overflow:hidden;overflow-y:auto;visibility:hidden;word-break:break-all;word-wrap:break-word;*letter-spacing:0.6px;"><span id="autoFaceTalkText"></span></div><div id="recipientsFaceTips" class="recipients-tips"><ul id="autoFaceTipsUserList"></ul></div>';var b='<li><a rel="$ID$" ><img src="$SRC$" alt="$ALT$" title="$TITLE$"/></a></li>';var j={$:function(k){return document.getElementById(k)},DC:function(k){return document.createElement(k)},BS:function(){var l=document.body,k=document.documentElement,m=l.scrollTop+k.scrollTop;left=l.scrollLeft+k.scrollLeft;return{top:m,left:left}},FF:(function(){var k=navigator.userAgent.toLowerCase();return/firefox\/([\d\.]+)/.test(k)})()};var f={info:function(l){var n=l.getBoundingClientRect();var k=l.offsetWidth;var m=l.offsetHeight;return{top:n.top,left:n.left,width:k,height:m}},getCursorPosition:function(m){if(document.selection){m.focus();var n=document.selection;var k=null;k=n.createRange();var l=k.duplicate();l.moveToElementText(m);l.setEndPoint("EndToEnd",k);m.selectionStart=l.text.length-k.text.length;m.selectionEnd=m.selectionStart+k.text.length;return m.selectionStart}else{return m.selectionStart}},setCursorPosition:function(l,m){var o=m=="end"?l.value.length:m;if(document.selection){var k=l.createTextRange();k.moveEnd("character",-l.value.length);k.moveEnd("character",o);k.moveStart("character",o);k.select()}else{l.setSelectionRange(o,o);l.focus()}},add:function(l,k){var o=l.value;var m=m||"";if(document.selection){var n=l.selectionStart;document.selection.createRange().text=k;l.selectionStart=n+k.length}else{var n=l.selectionStart;var p=l.value.length;l.value=l.value.slice(0,l.selectionStart)+k+l.value.slice(l.selectionStart,p);this.setCursorPosition(l,n+k.length)}},del:function(k,o){var m=this.getCursorPosition(k);var l=k.scrollTop;k.value=k.value.slice(0,m-o)+k.value.slice(m);this.setCursorPosition(k,m-o);j.FF&&setTimeout(function(){k.scrollTop=l},10)}};var h={lastAjaxObj:null,cacheData:null,getData:function(l,m,k){if(this.cacheData){return(k(this.cacheData))}if(this.lastAjaxObj){this.lastAjaxObj.abort()}this.lastAjaxObj=$.getJSON(l,{query:m,t:new Date().getTime()},function(n){h.cacheData=n;k(n)})}};var d={_this:null,index:-1,list:null,selectIndex:function(l){if(j.$(c.wrap).style.display=="none"){return true}var k=d.index;switch(l){case 37:k=k-1;break;case 38:if(k<0){k=0}else{if(k>=10){k=k-10}}break;case 39:k=k+1;break;case 40:if(k<0){k=0}else{if(k<d.list.length-10){k=k+10}}break;case 13:return d._this.enter();break}k=k>=d.list.length?0:k<0?d.list.length-1:k;return d.setSelected(k)},setSelected:function(k){if(d.index>=0){d.list[d.index].className=""}d.list[k].className=c.className;d.index=k;return false}};var g=function(k){var n=5;var m={};var l="";c.url=k.url?k.url:"";m.elem=k.id?j.$(k.id):k.elem;m.start=function(){if(!j.$(c.boxID)){var p=e.slice();var q=f.info(m.elem);var r=j.DC("DIV");var o=j.BS();p=p.replace("$top$",(q.top+o.top)).replace("$left$",(q.left+o.left)).replace("$width$",q.width).replace("$height$",q.height).replace("$SCTOP$","0");r.innerHTML=p;document.body.appendChild(r)}else{m.updatePosstion()}};m.keyupFn=function(s){var s=s||window.event;var o=s.keyCode;if(o==37||o==38||o==39||o==40||o==13){if(o==13&&j.$(c.wrap).style.display!="none"){m.enter()}return false}var u=f.getCursorPosition(m.elem);if(!u){return m.hide()}var y=m.elem.value.slice(0,u);var p=y.slice(-n);var w=p.match(/(.+)?\[([\w\u4e00-\u9fa5]+\]{0,1})$|\[$/);if(w==null){return m.hide()}var r=w[2]?w[2]:"";j.$(c.valuepWrap).innerHTML=y.slice(0,y.length-r.length).replace(/\n/g,"<br/>").replace(/\s/g,"&nbsp;")+c.positionHTML;if(r.indexOf("]")<0){var x=m.elem.value.slice(u,u+n);var t=x.match(/([\w\u4e00-\u9fa5]+\])/);if(t){var q=t[1]?t[1]:"";r+=q;f.setCursorPosition(m.elem,u+q.length)}}m.showList(r)};m.showList=function(o){l=o;h.getData(c.url,o,m._showList)};m._showList=function(u){if(j.$(c.listWrap).innerHTML==""){var s=b.slice();var t="";var o=u.length;if(o==0){m.hide();return}for(var r=0;r<o;r++){t+=s.replace("$SRC$",g_resource_context+"bundles/fafatimewebase/images/face/"+u[r].value).replace("$ALT$",u[r].key).replace("$TITLE$",u[r].key).replace("$ID$",u[r].key)}j.$(c.listWrap).innerHTML=t;d.list=j.$(c.listWrap).getElementsByTagName("li");d.index=-1}d._this=m;m.cursorSelect(d.list);m.updatePosstion();var w=j.$(c.position).getBoundingClientRect();var q=j.BS();var x=j.$(c.wrap).style;x.top=w.top+20+q.top+"px";x.left=w.left-5+"px";m.show()};m.KeyDown=function(p){var p=p||window.event;var o=p.keyCode;if(o==37||o==38||o==39||o==40||o==13){return d.selectIndex(o)}return true};m.updatePosstion=function(){var q=f.info(m.elem);var o=j.BS();var r=j.$(c.boxID).style;r.top=q.top+o.top+"px";r.left=q.left+o.left+"px";r.width=q.width+"px";r.height=q.height+"px";j.$(c.boxID).scrollTop=m.elem.scrollTop};m.show=function(){$(m.elem).bind("keydown",m.KeyDown);j.$(c.wrap).style.display="block"};m.cursorSelect=function(p){for(var o=0;o<p.length;o++){p[o].onmouseover=(function(q){return function(){d.setSelected(q)}})(o);p[o].onclick=m.enter}};m.hide=function(){$(m.elem).unbind("keydown",m.KeyDown);j.$(c.wrap).style.display="none"};m.bind=function(){$(m.elem).bind("keyup",m.keyupFn);$(m.elem).bind("click",m.keyupFn);$(m.elem).bind("blur",function(){setTimeout(m.hide,500)})};m.enter=function(){f.del(m.elem,l.length,l);f.add(m.elem,d.list[d.index].getElementsByTagName("A")[0].rel+"] ");m.hide();return false};return m};window.FaceAutoTips=function(l){var k=g(l);k.start();k.bind()};$(".FaceAutoTips").live("focus",function(){var k=$(this);if(k.attr("hasInitFaceAutoTips")){return}k.attr("hasInitFaceAutoTips","1");FaceAutoTips({elem:this,url:g_FaceAutoTipsUrl})})})();var Message={maxNum:99,mRefreshTimer:null,nRefreshTimer:null,pRefreshTimer:null,refreshTimerLong:1000*60,_messageUrl:"",_noticeUrl:"",_privateMsgUrl:"",load:function(b,d,c){this._messageUrl=b;this._noticeUrl=d;this._privateMsgUrl=c;if(b!=null){this.loadMessage()}if(d!=null){this.loadNotice()}if(c!=null){this.loadPrivateMsg()}},loadMessage:function(){if(Message.mRefreshTimer!=null){clearTimeout(Message.mRefreshTimer)}$.post(Message._messageUrl,"",function(c){var b=c*1>Message.maxNum?Message.maxNum:c*1;if(b==0){$(".icon_message span").hide()}else{$(".icon_message span").show()}$(".icon_message span").text(b);Message.mRefreshTimer=setTimeout("Message.loadMessage()",Message.refreshTimerLong)})},loadNotice:function(){if(Message.nRefreshTimer!=null){clearTimeout(Message.nRefreshTimer)}$.post(Message._noticeUrl,"",function(c){var b=c*1>Message.maxNum?Message.maxNum:c*1;if(b==0){$(".icon_notice span").hide()}else{$(".icon_notice span").show()}$(".icon_notice span").text(b);Message.nRefreshTimer=setTimeout("Message.loadNotice()",Message.refreshTimerLong)})},loadPrivateMsg:function(){},deleteMsg:function(d,e,b){var c=d;$.getJSON(c,{msg_id_str:e},function(f){if(f.success=="1"){b()}})},getPage:function(c){var d=$("#messagebox");var b=d.children("input.msgtype:hidden").val();d.empty();LoadComponent("messagebox",d.attr("getmsgurl")+"/"+b+"/"+c.toString())},deleteAll:function(){var d=$(".messagelist input:checkbox:checked").parent().siblings("input.msg_id:hidden").map(function(){return $(this).val()}).toArray().join(",");var e=$("#messagebox");var b=e.children("input.msgtype:hidden").val();var c=e.children("input.pageindex:hidden").val();e.empty();e.prepend("<div class='urlloading'><div /></div>");Message.deleteMsg(e.attr("delmsgurl"),d,function(){e.empty();LoadComponent("messagebox",e.attr("getmsgurl")+"/"+b+"/"+c)})},toShowDetail:function(d){var b=$(d).siblings("input.msg_id:hidden").val();var g=$("#messagebox");var c=g.children("input.msgtype:hidden").val();var f=g.children("input.pageindex:hidden").val();g.empty();LoadComponent("messagebox",g.attr("detailurl")+"/"+b.toString(),{re_type:c,re_pageindex:f})},deMsg:function(){var f=$("#messagebox");var c=f.children("input.nextone:hidden").val();var d=f.children("input.re_type:hidden").val();var e=f.children("input.re_pageindex:hidden").val();var b=f.children("input.msg_id:hidden").val();f.empty();f.prepend("<div class='urlloading'><div /></div>");Message.deleteMsg(f.attr("delmsgurl"),b,function(){f.empty();if(c&&c!=""){LoadComponent("messagebox",f.attr("detailurl")+"/"+c,{re_type:d,re_pageindex:e})}else{LoadComponent("messagebox",f.attr("getmsgurl")+"/"+1+"/"+1)}})},returnPrePage:function(){var d=$("#messagebox");var b=d.children("input.re_type:hidden").val();var c=d.children("input.re_pageindex:hidden").val();d.empty();LoadComponent("messagebox",d.attr("getmsgurl")+"/"+b+"/"+c)},gotoLastMsg:function(){var e=$("#messagebox");var b=e.children("input.lastone:hidden").val();var c=e.children("input.re_type:hidden").val();var d=e.children("input.re_pageindex:hidden").val();e.empty();LoadComponent("messagebox",e.attr("detailurl")+"/"+b,{re_type:c,re_pageindex:d})},gotoNextMsg:function(){var e=$("#messagebox");var b=e.children("input.nextone:hidden").val();var c=e.children("input.re_type:hidden").val();var d=e.children("input.re_pageindex:hidden").val();e.empty();LoadComponent("messagebox",e.attr("detailurl")+"/"+b,{re_type:c,re_pageindex:d})},replyMsg:function(){var c=$("#messagebox");var b=c.children("input.msg_id:hidden").val();c.empty();LoadComponent("messagebox",c.attr("pushurl")+"/"+b)},publishMsg:function(c){var b=$("#title").val();var d=$("#Msg").val();if(!d||d==$("#Msg").attr("placeholder")||!b||b==$("#title").attr("placeholder")){return}$.getJSON(c,{titl:b,msg:d,txtNotify:GetNotifyStaff(),attachs:GetInputAttach(),t:new Date().getTime()},function(e){var f=$("#messagebox");f.empty();f.append('<div class="no-messages"><img width="26" height="27" class="prompticon">发布成功！</div>')})},mobileRegApprove:function(b,c){$.post(b,{account:c},function(d){},"text");$(".messagebutton[value='<< 返回']").first().click()},refuseJoinCircle:function(c,b){$.post(c,{para:b},function(d){},"text");$(".messagebutton[value='<< 返回']").first().click()}};var Notice={getPage:function(c){var d=$("#messagebox");var b=d.children("input.noticetype:hidden").val();d.empty();LoadComponent("messagebox",d.attr("getnoticeurl")+"/"+b+"/"+c.toString())},toShowDetail:function(d){var b=$(d).parent().parent().parent().siblings("input.bulletin_id:hidden").val();var g=$("#messagebox");var c=g.children("input.noticetype:hidden").val();var f=g.children("input.pageindex:hidden").val();g.empty();LoadComponent("messagebox",g.attr("detailurl")+"/"+b.toString(),{re_type:c,re_pageindex:f})},returnPrePage:function(){var d=$("#messagebox");var b=d.children("input.re_type:hidden").val();var c=d.children("input.re_pageindex:hidden").val();d.empty();LoadComponent("messagebox",d.attr("getnoticeurl")+"/"+b+"/"+c)},gotoLastMsg:function(){var e=$("#messagebox");var b=e.children("input.lastone:hidden").val();var c=e.children("input.re_type:hidden").val();var d=e.children("input.re_pageindex:hidden").val();e.empty();LoadComponent("messagebox",e.attr("detailurl")+"/"+b,{re_type:c,re_pageindex:d})},gotoNextMsg:function(){var e=$("#messagebox");var b=e.children("input.nextone:hidden").val();var c=e.children("input.re_type:hidden").val();var d=e.children("input.re_pageindex:hidden").val();e.empty();LoadComponent("messagebox",e.attr("detailurl")+"/"+b,{re_type:c,re_pageindex:d})}};function EnterpriseHome_OnPublished(e,f){var d=["two1","two2","two3","two4","two5","two6"];for(var b=0;b<d.length;b++){var c=$("#con_"+d[b]).attr("type");if(typeof(c)=="undefined"||c==f||c=="conv"){EnterpriseHome_OnPublished_GetNewConv(d[b],e)}}}function EnterpriseHome_OnPublished_GetNewConv(c,f){var g=$(".unreadconvcount div");if(g.length>0){g.click();return}var e=$("#"+c+"[isloaded='1']");if(e.length>0){var d=$("#con_"+c+" ul.conv_box[type='normalbox']");var b=$("#"+c);$.get(e.attr("onpublishurl"),{conv_id:f,t:new Date().getTime()},function(j){$li=$(j).children().children("li").css("display","none");$li.children("input:hidden.endid").remove();var h=$li.find("div.convbox");if(h.attr("top")!=h.attr("conv_id")||$("ul.conv_box[type='topbox']").length==0){d.prepend($li);$li.fadeIn("slow")}else{getTopConv(b)}if($(j).find(".fafa-map").length>0){fafaMap.AutoShow()}overLengthAct();setListAct();registermoreoper()})}}function ConvFilter_OnClick(b){var c=$(b);setDisplayTab($("#"+c.attr("targetid"))[0]);c.parent().parent().children().removeClass("topic_in");c.parent().addClass("topic_in")}function EnterpriseHome_Document_OnScroll(){var j=$(document);if(j.scrollTop()+$(window).height()>=j.height()-100){var b=$("#two1.hover,#two2.hover,#two3.hover,#two4.hover,#two5.hover,#two6.hover");if(b.attr("isscrollloading")){return}var f=b.attr("scrollloadnum");if(!f){f=1}if(f>=3){return}var c=b.attr("id");var h=$("#con_"+c);var d=b.attr("hasmore");var e=b.attr("pageindex");if(!e){e=1}if(h.children("div.urlloading").length>0){return}if(d&&d=="0"){return}b.attr("isscrollloading","1");var g=GetConvMinID(b,h);h.append("<div class='urlloading'><div /></div>");$.get(b.attr("loadurl"),{network_domain:g_curr_network_domain,endid:g,pageindex:e,t:new Date().getTime()},function(l){h.find("div.urlloading").remove();var k=$(l).children("ul").children("li");b.attr("endid",k.find("input:hidden.endid").val());b.attr("hasmore",k.length);h.children("div").children("ul.conv_box[type='normalbox']").append(k);b.attr("scrollloadnum",++f);b.removeAttr("isscrollloading");overLengthAct();setListAct();registermoreoper();if((e>1&&k.length<15)||f>=3){GenPageHtml(e,h.children("div"),b.attr("loadurl"))}})}}function GenPageHtml(b,d,c){if(d.find("#pagination450").length>0){return}$.get(c,{network_domain:g_curr_network_domain,pre450num:"1",t:new Date().getTime()},function(j){var e=parseInt((j.pre450num-1)/45)+1;var k='<div id="pagination450" class="pagination pagination-right"><ul>';var h="</ul></div>";var g="";for(var f=1;f<=e;f++){g+="<li "+(b==f?'class="active"':"")+'><a href="javascript:void(0);" onclick="EnterpriseHome_OnPage(this)">'+f+"</a></li>"}d.append(k+g+h)})}function ShowPageHtml(b){b.children("div.pagination").show()}function EnterpriseHome_OnPage(c){var f=$(c);var d=f.text();var b=$("#two1.hover, #two2.hover, #two3.hover,#two4.hover,#two5.hover,#two6.hover");var g=$("#con_"+b.attr("id"));var e=GetConvMinID(b,g);if(d=="1"&&b.attr("gettopurl")!="undefined"&&b.attr("gettopurl")!=""){b.attr("isloadtop","0")}b.attr("isscrollloading","1");b.attr("scrollloadnum","1");b.removeAttr("hasmore");b.removeAttr("endid");b.attr("pageindex",d);b.attr("maxid",GetConvMaxID(b,g));g.children().remove();g.append("<div class='urlloading'><div /></div>");g.load(b.attr("loadurl"),{network_domain:g_curr_network_domain,pageindex:d},function(){g.find("div.urlloading").remove();b.removeAttr("isscrollloading")})}var _InfoHint='<div id="infohint" style="border: 0px none; min-height: 0px; padding: 0px; text-align: center; cursor: pointer;"><div style="background-color: #FEFFE2; border: 1px solid #F8F09E; color: #CF9D2F;" >$info$</div></div>';var _InfoHintTimer=null;function ShowInfoHint(d,c){var b=$("#two1.hover, #two2.hover, #two3.hover,#two4.hover,#two5.hover,#two6.hover");var e=$("#con_"+b.attr("id"));if(e.find("#infohint").length==0){e.prepend(_InfoHint.replace("$info$",d))}else{e.find("#infohint").html(_InfoHint.replace("$info$",d))}if(_InfoHintTimer!=null){window.clearTimeout(_InfoHintTimer)}_InfoHintTimer=window.setTimeout(function(){$("#infohint").remove()},c)}var _UnreadTemplate='<div class="unreadconvcount" style="border: 0px none; min-height: 0px; padding: 0px; text-align: center; cursor: pointer;"><div style="background-color: #FEFFE2; border: 1px solid #F8F09E; color: #CF9D2F;" onclick="UnreadConvCount_OnClick(this)">你有 <span>$COUNT$</span> 条新信息，点击查看</div></div>';var _LastReadSplitTemplate='<li class="lastreadsplit" style="text-align: center; min-height: 0px; padding: 10px 0px;"><div><span class="hr_here" style="display: inline-block; height: 0px; border: 1px solid rgb(204, 204, 204);margin: 0px 10px;"></span><span>你上次看到这里了哟～</span><span class="hr_here" style="display: inline-block; height: 0px; border: 1px solid rgb(204, 204, 204);margin: 0px 10px;"></span></div></li>';function EnterpriseHome_GetConvUnreadCount_Timeout(){var b=$("#two1.hover, #two2.hover, #two3.hover,#two4.hover,#two5.hover,#two6.hover");if(b.length==0){window.setTimeout(EnterpriseHome_GetConvUnreadCount_Timeout,1000*60*3);return}var e=$("#con_"+b.attr("id"));var c=GetConvMaxID(b,e);if(typeof(c)=="undefined"||c==null||c==""||c<0){window.setTimeout(EnterpriseHome_GetConvUnreadCount_Timeout,1000*60*3)}var d=b.attr("loadunreadurl");$.getJSON(d,{network_domain:g_curr_network_domain,maxid:c,onlycount:"1",t:new Date().getTime()},function(g){var f=e;if(f.attr("class").indexOf("hover")>-1){f.children("div.unreadconvcount").remove();if(g.unreadcount>0){f.prepend(_UnreadTemplate.replace("$COUNT$",g.unreadcount))}window.setTimeout(EnterpriseHome_GetConvUnreadCount_Timeout,1000*60*3)}})}function GetConvMaxID(b,c){return Math.max(b.attr("maxid")||-10,Math.max.apply(null,c.find("div.convbox").map(function(){return $(this).attr("conv_id")}).toArray()))}function GetConvMinID(b,c){return Math.max(-10,b.attr("endid")||Math.min.apply(null,c.find("ul.conv_box[type='normalbox']").find("div.convbox").map(function(){return $(this).attr("conv_id")}).toArray()))}function UnreadConvCount_OnClick(c){var b=$("#two1.hover, #two2.hover, #two3.hover,#two4.hover,#two5.hover,#two6.hover");var f=$("#con_"+b.attr("id"));var e=b.attr("loadunreadurl");var d=f;d.children(".unreadconvcount").html('<div style="background-color: #FEFFE2; border: 1px solid #F8F09E; color: #CF9D2F;" onclick="UnreadConvCount_OnClick(this)">正在努力为您加载数据，请稍候...</div>');$.get(e,{trend:manager_trend,network_domain:g_curr_network_domain,maxid:GetConvMaxID(b,f),t:new Date().getTime()},function(n){d.children(".unreadconvcount").remove();$li=$(n).children().children("li").css("display","none");$li.children("input:hidden.endid").remove();var j=d.find("ul.conv_box[type='normalbox']");j.children(".lastreadsplit").remove();j.prepend(_LastReadSplitTemplate);var m=[],k=0;for(var l=0;l<$li.length;l++){var h=$($li[l]).find("div.convbox");if(h.attr("top")!=h.attr("conv_id")){m.push("<li class='clearfix'>"+$($li[l]).html()+"</li>")}else{k++}}var g=$(m.join(""));j.prepend(g);if(k>0){getTopConv(b)}g.fadeIn("slow");overLengthAct();setListAct();registermoreoper()})}function ViewTogetherDetails(b){$("#loadimg").show();$("#togetherdetails").show();$("#viewtogether").html("<div>正在加载活动</div>");$.post(b,function(c){$("#loadimg").hide();$("#viewtogether").html(c)})}function ViewVoteDetails(b,d){var c=$(".voteenter input:hidden:[value="+d+"]");if(c.length>0){}$("#votedetails #loadimg").show();$("#votedetails").show();$("#viewvote").html("<div>正在加载投票数据</div>");$.post(b,function(e){$("#votedetails #loadimg").hide();$("#viewvote").html(e)})}function inapp(b){window.location=appcenter_index.replace("AAA",b)}var updateLastLogintimeUrl="";function LoadFirstWizard(n){updateLastLogintimeUrl=n;var e=$("#content").offset();var l="/bundles/fafatimewebase/images/firstWizard/";var d=[{text:l+"0font.png",img:l+"0.png",img_pos:[(e.top+70)+"px",(e.left+170)+"px"],text_pos:[(e.top+70+175)+"px",(e.left+170+166)+"px"]},{text:l+"1font.png",img:l+"1.png",img_pos:[(e.top-35)+"px",(e.left-31)+"px"],text_pos:[(e.top-35+283)+"px",(e.left-31+269)+"px"]},{text:l+"2font.png",img:l+"2.png",img_pos:[(e.top-35)+"px",(e.left+741)+"px"],text_pos:[(e.top-35+248)+"px",(e.left+741-525)+"px"]},{text:l+"3font.png",img:l+"3.png",img_pos:[0,0],text_pos:[253,250]},{text:l+"4font.png",img:l+"4.png",img_pos:[(e.top)+"px",(e.left+200)+"px"],text_pos:[(e.top+184)+"px",(e.left+200+150)+"px"]},];var m=document.documentElement||document.body;m.style.overflow="hidden";var g=document.createElement("DIV");g.id="FirstWizard";document.body.appendChild(g);var o=document.createElement("DIV");o.id="FirstWizard_showImg";document.body.appendChild(o);o=$(o);g=$(g);var k=document.createElement("DIV");k.id="fafa_cur";o.append(k);$(k).css({position:"absolute",top:"70%",left:"50%",height:"10px","line-height":"10px",width:"50px","text-align":"center"});var b=[];for(var f=0;f<d.length;f++){b.push("<a style='font-size:60px;color:#fff;display:none'>.</a>")}$(k).html(b.join(""));var j=document.createElement("img");j.src=d[0].img;$(j).css({position:"absolute",top:d[0].img_pos[0],left:d[0].img_pos[1]});var h=document.createElement("img");h.src=d[0].text;$(h).css({position:"absolute",top:d[0].text_pos[0],left:d[0].text_pos[1]});o.append(j);o.append(h);o.attr("page","0");g.css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"#000000","z-index":10000,filter:"alpha(opacity=80)",opacity:" 0.8","-moz-opacity":"0.8","-khtml-opacity":"0.8"});o.css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","z-index":10001});o.bind("click",function(q){var p=$(this).attr("page");if($(this)[0].type=="input"){return}if(p=="0"){$("#fafa_cur a:gt(0)").css("display","")}$("#fafa_cur a:eq("+p+")").css("color","#ffffff");p=p*1+1;$("#fafa_cur a:eq("+p+")").css("color","#F9FC00");var c=p==d.length;if(c){m.style.overflow="auto";g.remove();o.remove();updateLastLogintime();return}o.attr("page",p);o.find("img").hide();var r=[o.find("img:eq(0)"),o.find("img:eq(1)")];if(d[p].img_pos[0]==0){r[0].attr("src",d[p].img);r[0].css({left:"",top:"",bottom:d[p].img_pos[0],right:d[p].img_pos[1]});r[1].attr("src",d[p].text);r[1].css({left:"",top:"",bottom:d[p].text_pos[0],right:d[p].text_pos[1]})}else{r[0].attr("src",d[p].img);r[0].css({top:d[p].img_pos[0],left:d[p].img_pos[1]});r[1].attr("src",d[p].text);r[1].css({top:d[p].text_pos[0],left:d[p].text_pos[1]})}setTimeout('$("#FirstWizard_showImg").find("img").show();',200);if(p=="4"){setTimeout("FirstWizardByLast();",200)}})}function FirstWizardByLast(){var f=$("#FirstWizard"),c=$("#FirstWizard_showImg");var g=c.find("img:eq(0)").offset();var d=document.createElement("textarea");d.id="txtInput2";$(d).css({border:"0px",height:"60px",left:(g.left+20)+"px",position:"absolute",top:(g.top+43)+"px",width:"485px"});c.append(d);$(d).bind("click",function(h){h.stopPropagation()});$(d).bind("mousedown",function(h){$("#btnPublish2").attr("disabled",false);h.stopPropagation()});var e='<span style="display: block;left: '+(g.left+450)+"px; position: absolute; top: "+(g.top+120)+'px;"><input id="btnPublish2" name="btnPublish2" type="button" class="libenter" value="发  布" onclick="publishInput()" disabled></span>';c.append(e);$("#btnPublish2").bind("click",function(j){j.stopPropagation();$("#Trend").val($("#txtInput2").val());publishInput();var h=document.documentElement||document.body;h.style.overflow="auto";setTimeout("$('#FirstWizard').remove();$('#FirstWizard_showImg').remove()",1000);updateLastLogintime();return});var b='<span id="__txt" style="font-weight: bold;color: blue;cursor: pointer;display: block;left: '+(g.left+400)+"px; position: absolute; top: "+(g.top+10)+'px;">还没想好说些什么</span>';c.append(b);$("#__txt").bind("click",function(j){j.stopPropagation();var h=document.documentElement||document.body;h.style.overflow="auto";f.remove();c.remove();updateLastLogintime();return})}function updateLastLogintime(){$.post(updateLastLogintimeUrl,"",function(b){})}function viewallcontent_OnClick(f,c){if(checkHover(f,c)){var d=$(c);if(d.attr("isexpand")!="1"){d.parent().siblings("p.news").removeClass("news_maxheight");d.find("span").attr("class","arrow_down");d.find("a").text("收起");d.attr("isexpand","1")}else{d.parent().siblings("p.news").addClass("news_maxheight");d.find("span").attr("class","arrow_up");d.find("a").text("查看全部");d.attr("isexpand","0");var b=d.siblings("p.news").offset().top-50;if($(document).scrollTop()>b){$(document).scrollTop(b)}}}}function loadtoplist(){var b=$("#two1.hover[gettopurl], #two2.hover[gettopurl], #two3.hover[gettopurl],#two4.hover[gettopurl],#two5.hover[gettopurl],#two6.hover[gettopurl]");if(b.length>0){if(b.attr("isloadtop")!="1"){getTopConv(b)}}}function overLengthAct(){var c="<div class='viewall'><span style='float:left;font-weight:700;padding-bottom:2px;'>………………</span><span class='mit_view'><a href='javascript:void(0);' style='float:left;margin-left:4px;color:#0088CC'>显示全部</a><div class='arrow_t'><span class='arrow_down'></span></div></span>";var b=$(".news_maxheight");for(var d=0;d<b.length;d++){$this=$(b[d]);if($this[0].scrollHeight>parseInt($this.css("max-height").replace("px",""))&&$this.siblings(".viewall").length==0){$this.after(c);$this.siblings(".viewall").find(".mit_view").click(function(f){var g=$(this);if(g.attr("isexpand")!="1"){g.parent().siblings("p.news").removeClass("news_maxheight");g.find("span").attr("class","arrow_up");g.find("a").text("收起");g.attr("isexpand","1")}else{g.parent().siblings("p.news").addClass("news_maxheight");g.find("span").attr("class","arrow_down");g.find("a").text("查看全部");g.attr("isexpand","0");var e=g.parent().siblings("p.news").offset().top-50;if($(document).scrollTop()>e){$(document).scrollTop(e)}}})}}}$(document).ready(function(){var b=$("ul.topic_options li a");b.click(function(){$("ul.topic_options").find("span.topic_in,a.topic_in").removeClass("topic_in");$(this).siblings("span.squareico").addClass("topic_in");$(this).addClass("topic_in");$("div.topb span").text($(this).text())})});function anchorMode(b){var d=b.offset().top+b.height();var c=$(window).height();$(document).scroll((d-c)>0?c:((d<0)?d:0))}function createNavigation(b){}function circlePadding(e,f){var b=$("#"+e);var d=b.parent();var c=d.find("div:hidden:first");if(c.length==0){if(f!=null){f(e)}}else{b.remove();c.css("display","block")}}function cancelCircleApply(b){wefafaWin.weconfirm(null,"圈子申请","确定要取消加入该圈子的申请？","",function(c){$.getJSON(circle_cancel_apply_url+"/"+c,{},function(e){if(e.success=="1"){$("li .circles_item[id='"+c+"']").remove()}})},b)}function right_applyAddCircle(b){var e=$(b);var d=e.siblings(".circle_id").val();var c=e.siblings(".create_staff").val();var f=e.parents(".recomcircleitem").find(".cirlcename").text();e.removeAttr("onclick");e.text("提交中...");ShowInfoHint("正在提交您加入圈子的申请，请稍等...",10000);$.post(circle_join_apply_url,{createStaff:c,circleId:d,circleName:f},function(g){e.html("加入<span></span>");if(g=="0"){ShowInfoHint("申请失败：您已提交过申请，请等待圈子管理员的审批。",5000);CircleCard.hide();e.unbind("click").bind("click",function(){right_applyAddCircle(this)});return}if(g=="99999"){ShowInfoHint("申请失败：您申请的圈子数已达到了最大数量限制。",5000);CircleCard.hide();e.unbind("click").bind("click",function(){right_applyAddCircle(this)});return}if(g=="-2"){ShowInfoHint("申请失败：您所加入的圈子过多，已达到了等级限制。",5000);CircleCard.hide();e.unbind("click").bind("click",function(){right_applyAddCircle(this)});return}if(g=="-3"){ShowInfoHint("申请失败：该圈子已满员。",5000);CircleCard.hide();e.unbind("click").bind("click",function(){right_applyAddCircle(this)});return}ShowInfoHint("您加入圈子的申请已提交，请等待圈子管理员的审批。",5000);circlePadding(d);CircleCard.hide();e.text("已经申请");e.parents(".recomcircleitem").fadeOut("slow",function(){e.parent().parent().remove()})},"text")}var ajaxHttpConnRef=null,authModalDlag=null,isAuthElementHover=false;function show_auth_comment(authUrl){var _cx=$("#view_auth_comment_dlag");if(_cx.length==0){_cx=document.createElement("DIV");_cx.id="view_auth_comment_dlag";_cx.className="modal";with(_cx.style){width="400px";display="none";padding="0px";overflow="hidden";borderRadius="5px 5px 5px 5px"}_cx.innerHTML="<div id='view_auth_comment_dlag_body' class='modal-body' style='overflow:hidden;padding:0px;'></div>";document.body.appendChild(_cx);authModalDlag=$("#view_auth_comment_dlag");if(authModalDlag.modal==null){return}authModalDlag.modal({show:false,backdrop:false});authModalDlag.on("shown",{Aurl:authUrl},function(para){$("#view_auth_comment_dlag_body").html("<div class='urlloading'>加载等级信息...<div /></div>");ajaxHttpConnRef=$.get(para.data.Aurl,{},function(d){ajaxHttpConnRef=null;$("#view_auth_comment_dlag_body").html(d)})})}}var wefafaWin={confirm_sender:null,confirm_ok_fun:null,confirm_para:null,weconfirm:function(d,g,c,f,b){var h=$("#wefafa_confirm");if(h.length>0){return}var e="";moda='<div class="wefafa_confirm modal"  id="wefafa_confirm" data-backdrop=false style="z-index:20000;display:none;height: 129px;margin-left: -110px;margin-top: -60px;width: 220px;" show=false>  <div class="doc_window_title">  	<span>&nbsp;&nbsp;{title}</span>  </div>  <div>    <div class="doc_rd_deleteconfirm_left"></div>    <div class="doc_rd_deleteconfirm_right">        <div class="doc_rd_deleteconfirm_text">{txt}</div>        <div style="margin-left: 0px;margin-top: 20px;float:left"><span id="wefafa_confirm_sureBtn" onclick="wefafaWin.confirm_ok()" class="doc_md_content_right_btn">确定</span><span id="wefafa_confirm_cancelBtn" onclick="wefafaWin.confirm_cancel()" class="doc_md_content_right_btn">取消</span></div>        <div class="wefafa_confirm_hint" style="margin-left: 70px;height:10px;width:130px;float:left"></div>   </div>  </div></div>';$(document.body).append(moda.replace("{title}",g).replace("{txt}",c));$(document.body).append("<div id='wefafa_confirm_cover' style='background-color: #111111;height: 100%;left: 0;opacity: 0.5;filter:alpha(opacity=50);-moz-opacity:0.5;-khtml-opacity:0.5; position: fixed; top: 0;width: 100%;z-index: 10000;'>");h=$("#wefafa_confirm");h.show();this.confirm_ok_fun=f;this.confirm_sender=d;this.confirm_para=b},confirm_ok:function(){$("#wefafa_confirm_cover").remove();this.confirm_ok_fun(this.confirm_para==null?this.confirm_sender:this.confirm_para);$("#wefafa_confirm").remove();return true},confirm_cancel:function(){$("#wefafa_confirm_cover").remove();$("#wefafa_confirm").remove();return false}};(function(b){b.fn.maxlength=function(d){var c=jQuery.extend({events:[],maxCharacters:200,status:true,statusClass:"status",statusText:"还能输入字符数:",notificationClass:"notification",showAlert:false,alertText:"You have typed too many characters.",slider:false},d);b.merge(c.events,["keyup"]);return this.each(function(){var h=b(this);var e=b(this).val().length;function l(){var m=c.maxCharacters-e;if(m<0){m=0}h.next("div").html(c.statusText+" "+m)}function k(){var m=true;if(e>=c.maxCharacters){m=false;h.addClass(c.notificationClass);h.val(h.val().substr(0,c.maxCharacters));f()}else{if(h.hasClass(c.notificationClass)){h.removeClass(c.notificationClass)}}if(c.status){l()}}function f(){if(c.showAlert){alert(c.alertText)}}function j(){var m=false;if(h.is("textarea")){m=true}else{if(h.filter("input[type=text]")){m=true}else{if(h.filter("input[type=password]")){m=true}}}return m}if(!j()){return false}b.each(c.events,function(n,m){h.bind(m,function(o){e=h.val().length;k()})});if(c.status){h.after(b("<div/>").addClass(c.statusClass).html("-"));l()}if(!c.status){var g=h.next("div."+c.statusClass);if(g){g.remove()}}if(c.slider){h.next().hide();h.focus(function(){h.next().slideDown("fast")});h.blur(function(){h.next().slideUp("fast")})}})}})(jQuery);var currentSelectedFileID="";var currentSelectedFileName="";var $docshowlist=null,fileListOffset=0,minHeight=0,issearch=false,circles=[],groups=[],moveingFileID="",doc_hoverTimer=null,$deleteIcon=null,dirsCache=new HashMap(),filesCache=new HashMap(),shareDirs=new HashMap(),currentDir="",dochoverTimer=null,docoutTimer;$(document).ready(function(){$docshowlist=$("#docshowlist");if($docshowlist.length==0){return}fileListOffset=$docshowlist.offset();minHeight=$docshowlist.css("min-Height").replace("px","")*1});function loadGroupDocList(c,b){$("#middlepath").html("");setDirPath(c,b);$("#hpost_to_group").val(c.substring(1));loadDocList(c);issearch=false}function loadDocList(e){var b=$("#con_mgr_two1");b.html("<div class='urlloading'><div />");currentDir=e;if(dirsCache!=null&&dirsCache.get(currentDir)!=null){showDoc(filesCache.get(currentDir),dirsCache.get(currentDir));return}var d=null,c=null;$.get($docshowlist.attr("dirurl")+"?parentid="+e,"",function(f){d=f.data;dirsCache.put(currentDir,d);if(c==null){return}showDoc(c,d)});$.get($docshowlist.attr("fileurl")+"?parentid="+e,"",function(f){c=f.data;if(f.info!=null&&f.info.length>0){shareDirs.put(currentDir,f.info)}filesCache.put(currentDir,c);if(d==null){return}showDoc(c,d)})}function showDoc(h,c){var b=$("#con_mgr_two1");b.find("urlloading").remove();var j=shareDirs.get(currentDir);j=j==null?[]:j;if(h.length==0&&c.length==0&&j.length==0){b.html("<span style='color:#999999;text-align:center;line-height: 30px;height: 30px;display: block;width:100%'>该文件夹为空</span>");return}var e=[];for(var d=0;d<c.length;d++){var g=c[d].isshare=="1"?"共享文件夹":"文件夹";e.push("<div class='list_tr doc_row' style='height:25px' acc='"+c[d].owner+"' user='"+c[d].nick_name+"' jid='"+c[d].fafa_jid+"'><span class='doc_info_name' dir_id='"+c[d].id+"' style='border:0px;'><img src='/bundles/fafatimewebase/images/folder.png'>&nbsp;<a title='点击进入文件夹'>"+c[d].name+"</a></span>");e.push("<span class='doc_info_owner' style='cursor:default'>"+g+"</span>");e.push("<span class='doc_info_cdate' style='cursor:default'>"+c[d].createdate+"</span></div>")}for(var d=0;d<j.length;d++){var g="共享文件夹";e.push("<div class='list_tr doc_row' style='height:25px' acc='"+j[d].login_account+"' user='"+j[d].nick_name+"' jid='"+j[d].fafa_jid+"'><span class='doc_info_name' dir_id='"+j[d].id+"' style='border:0px;'><img src='/bundles/fafatimewebase/images/folder.png'>&nbsp;<a title='点击进入文件夹'>共享文件-"+j[d].nick_name+"</a></span>");e.push("<span class='doc_info_owner' style='cursor:default'>"+g+"</span>");e.push("<span class='doc_info_cdate' style='cursor:default'></span></div>")}for(var d=0;d<h.length;d++){var g="";if(h[d].file_ext==""){g="未知类型"}else{if("'gif','bmp','jpeg','jpg','png'".indexOf(h[d].file_ext)>-1){g=h[d].file_ext.toUpperCase()+" 图像"}else{if("'aif','snd','mid','avi','mpeg','mp4','mp3','wav','tiff','aiff','mov','mpg','ram','rm','ra','rmvb','asf','wmv','wma'".indexOf(h[d].file_ext)>-1){g=h[d].file_ext.toUpperCase()+" 媒体文件"}else{g=h[d].file_ext.toUpperCase()+" 文件"}}}var f="";if("'gif','bmp','jpeg','jpg','png'".indexOf(h[d].file_ext)>-1){f="/getfile/image/small/"+h[d].file_id}else{f="/bundles/fafatimewebase/images/"+h[d].ext_icon}e.push("<div class='list_tr doc_row' style='height:25px' acc='"+h[d].up_by_staff+"' user='"+h[d].nick_name+"' jid='"+h[d].fafa_jid+"'><span class='doc_info_name' file_id='"+h[d].file_id+"' style='border:0px;'><img onerror=\"this.src='/bundles/fafatimewebase/images/imgicon.png'\" src='"+f+"'>&nbsp;<a href='javascript:openfile(\""+h[d].file_id+"\")' title='点击查看文件'>"+h[d].file_name+"</a></span>");e.push("<span class='doc_info_owner' style='cursor:default'>"+g+"</span>");e.push("<span class='doc_info_cdate' style='cursor:default'>"+h[d].up_date+"</span></div>")}b.html(e.join(""))}function loadAttributes(b){}function setDirPath(l,h){clearTimeout(dochoverTimer);clearTimeout(docoutTimer);if(l.indexOf("|")>0){$(".doc_tools_cfile").hide()}else{$(".doc_tools_cfile").show()}$("#doc_tools").hide();var b=$(".dirlist");var m=$("#middlepath");var k=b.find("[dir_id='"+l+"']");if(k.length==0){m.append('<span class="dirsplit">/</span><span dir_id="'+l+'" class="dirpath">'+h+"</span>")}else{var d=b.find("[dir_id]");for(var g=d.length-1;g>0;g--){var o=$(d[g]);if(o.attr("dir_id")==l){break}o.prev().remove();o.remove()}}var e=m.width();var d=m.find("span");var n=d.find(":hidden");var c=0;for(var g=0;g<d.length;g++){c+=(d[g]).offsetWidth}if(c<=e){n.css("display","block");b.find("[dir_id='']").text("文档库");return}var g=0;while(c>e){(d[g]).css("display","none");g++;(d[g]).css("display","none");g++;c=0;for(var f=g;f<d.length;f++){c+=(d[f]).offsetWidth}}for(var f=g;f<d.length;f++){(d[f]).css("display","block")}b.find("[dir_id='']").text("文档库/..")}function show_tools_item(b,j,g,h){var c=document.getElementById("doc_share"),c=c==null?"none":c.style.display;if(document.getElementById("doc_open").style.display!="none"||document.getElementById("doc_createDir").style.display!="none"||document.getElementById("doc_delete").style.display!="none"||document.getElementById("doc_publish").style.display!="none"||document.getElementById("doc_create_content").style.display!="none"||c!="none"){return}var f=$("#doc_tools"),d=f.find("div");d.attr("objectid",h);if(g){var e=$(".doc_info_name[dir_id='"+h+"']").parent().attr("jid");d.attr("isdir","1");d.attr("isfile","");d.hide();if(g_owner!=e){return}f.find(".doc_tools_rename").show();f.find(".doc_tools_share").show();f.find(".doc_tools_delete").show()}else{var e=$(".doc_info_name[file_id='"+h+"']").parent().attr("jid");d.attr("isfile","1");d.attr("isdir","");d.show();if(g_owner!=e){f.find(".doc_tools_share").hide();f.find(".doc_tools_publish").hide();f.find(".doc_tools_delete").hide()}f.find(".doc_tools_rename").hide()}f.css({left:b+"px",top:j+"px",display:"block","z-index":"10000"})}function openfile(b){$("#doc_tools").hide();var e=$(".doc_open");e.find(".doc_window_title span:eq(0)").html("&nbsp;&nbsp;文件查看-"+$(".doc_info_name[file_id='"+b+"'] a").text());$("#filefrm")[0].src=e.attr("url")+"?fileid="+b;$("#download_to_location").attr("href",path.replace("getfile","downloadfile")+b);var c=path.indexOf("http")>-1?path+b:document.location.protocol+"//"+document.location.host+(document.location.port!=""&&document.location.port!="80"?":"+document.location.port:"")+path+b;$("#file_addr_text").val(c);e.show();Clipboardinit();var d=filecomcache.get(b);$("#allcontent").find(".com_one").unbind().remove();$("#com_all_note .com_all").hide();if(typeof(d)=="undefined"||d.length>=5){LoadData(null,getcomUrl+"?isdir=&isfile=1&resourceid="+b+"&gettype=all",function(f){showAllComment(f.cominfo,b)})}else{showAllComment(d,b)}}function showAllComment(d,c){var b=$("#content_list");b.find(".com_one").unbind().remove();if(d.length==0){$("#com_all_note").text("暂无评论!").show()}else{$("#com_all_note").hide();$(".com_all").show();b.append(getComHTML(d));$(".com_all a").unbind("click").click(function(){showPutCard(c,"","")});b.find(".com_reply").bind("click",function(h){var k=h||window.event;if(checkHover(h,this)){var g=$(this).parent().parent().find("a[value='conv_account']");var j=g.attr("login_account");var f=g.text();showPutCard(c,j,f)}})}}function showPutCard(d,e,c){$("#putcard").unbind().remove();var b=[];b.push("<div class='modal doc_comment' isdir='' isfile='1' objectid='"+d+"' id='putcard'>");b.push("<div class='doc_window_title'><span>&nbsp;&nbsp;发表评论</span><span onclick='$(\"#putcard\").unbind().remove();' style='cursor:pointer;float:right;font-size:15px;margin-right:5px;'>×</span></div><div class='comment_list'>");b.push("<div style='width:100%;text-align:center;display:none;padding-top:50px;' id='sub'>正在保存...</div>");b.push("<div class='com_write_all'><div class='com_write_title_all'>");if(e!=""){b.push("<span>我对<a login_account='"+e+"'>"+c+"</a>说:</span>")}else{b.push("<span>我说:</span>")}b.push("</div><textarea maxlength='50' placeholder='写下你想说的!'>");b.push("</textarea><div class='sta_all'>还能输入字符数:<span class='com_letter'>50</span>");b.push("<input class='doc_md_content_right_btn putCom' type='button' value='提交' style='float:right;margin-right:4px;'/></div></div></div></div>");$(document.body).append(b.join(""));$(".com_write_all textarea").bind("keyup change",function(){var h=parseInt($(this).attr("maxlength"));var f=$(this).val().length;var g=$(this).val();if(f<h){$("#putcard .com_letter").text(h-f)}else{$(this).val(g.substring(0,h));$("#putcard .com_letter").text("0")}});$(".putCom").click(function(){submitCom($(".com_write_title_all").find("a"),$(".com_write_all textarea").val(),$("#putcard"),"0")})}function submitCom(){var e=arguments[0]?arguments[0]:$(".com_write_title").find("a");var c=arguments[1]?arguments[1]:$(".com_write textarea").val();if(c==""){return}var d=arguments[2]?arguments[2]:$("#doc_comment");var f=(e.length==1?e.attr("login_account"):"");var b=arguments[3]?arguments[3]:"1";$.getJSON(putComUrl+(b=="1"?"":"?gettype=all"),{isdir:d.attr("isdir"),isfile:d.attr("isfile"),resourceid:d.attr("objectid"),content:c,conv_to:f},function(g){if(g.s=="1"){if(b=="1"){if(d.attr("isdir")=="1"){dircomcache.put(d.attr("objectid"),g.cominfo)}else{filecomcache.put(d.attr("objectid"),g.cominfo)}showComment(g.cominfo)}else{$("#putcard").unbind().remove();showAllComment(g.cominfo)}}else{}});if(b=="1"){$("#com_note").text("正在保存...").show().siblings().hide();$(".com_write").hide();$(".com_content").show()}else{$("#sub").show();$(".com_write_all").hide()}}function changeComCard(){var c=$("div.com_write");var b=$("div.com_content");if($("#doc_comment").attr("active")=="0"||c.find(".com_write_title").text()==""){return}if(c.css("display")=="none"){c.show();b.hide();c.find("textarea").focus()}else{c.hide();b.show()}}function LoadData(c,b,f){var e=arguments[3]?arguments[3]:"/bundles/fafatimewebase/images/loading.gif";var d=arguments[4]?arguments[4]:c;$.post(b,{},function(g){$(d).siblings(".LoadPage_loadcontainter").remove();$(c).show();f(g)});$(d).after("<div class='LoadPage_loadcontainter' style='width:auto;height:auto;text-align:center;'><img align='center' src='"+e+"'/></div>");$(".LoadPage_loadcontainter").css({width:$(c).width()+"px",height:$(c).height()})}function closeSS(){$(".share_set_div").hide();$(".share_group_select").remove();$(".share_group_div,.share_dept_div").unbind();$(".share_user_list").remove();$("#estop").remove()}function submitSS(){$("#estop").remove();$(".share_content").hide();$(".share_load").show().text("正在保存...");var f=[];var d=[];var b=[];if($(".share_set_ul input:checkbox[value='group']").attr("checked")){var c=$(".share_group_select li[isattach='1']");for(var g=0;g<c.length;g++){f.push($(c[g]).attr("val"))}}if($(".share_set_ul input:checkbox[value='dept']").attr("checked")){var c=$(".dept_list").find(".t");for(var e=0;e<c.length;e++){d.push($(c[e]).attr("val"))}}if($(".share_set_ul input:checkbox[value='user']").attr("checked")){var c=$(".user_list").children("span");for(var g=0;g<c.length;g++){b.push($(c[g]).attr("val"))}}$.getJSON(shareSetUrl,{group_list:f,dept_list:d,user_list:b,isdir:$(".share_set_div").attr("isdir"),isfile:$(".share_set_div").attr("isfile"),resourceid:$(".share_set_div").attr("objectid"),isshare:$(".isshare_ul input:checked").attr("isshare")},function(h){if(h.s=="1"){if($(".share_set_div").attr("isdir")=="1"){dirsharecache.put($(".share_set_div").attr("objectid"),h.shareinfo)}else{filesharecache.put($(".share_set_div").attr("objectid"),h.shareinfo)}closeSS()}else{}})}function estop(e){if(e){var d="<div style='display:none' id='estop'></div>";$(document.body).append(d);var b=$(".share_set_table");var f=b.width();var h=b.height();var c=b.offset().left;var g=b.offset().top;$("#estop").css({position:"absolute",left:c+"px",top:g+"px",width:f+"px",height:h+"px","background-color":"#CCC",opacity:"0.5",cursor:"not-allowed","z-index":"1090"});$("#estop").show()}else{$("#estop").remove()}}var ElementAction={ppmList:Array(),ppmAction:function(e,b){var d=arguments[2]?arguments[2]:"blow";var c=arguments[3]?arguments[3]:"click";var f=arguments[4]?arguments[4]:e;$(e).bind(c,function(l){if(l.type=="click"||checkHover(l,this)){var p=$(f).offset().top;var k=$(f).offset().left;var o=f.offsetHeight;var n=k;var m=p+o;$(b).css({left:n,top:m});if($(b).parent().length==0){$(document.body).append(b)}else{$(b).show()}$(this).siblings().find("input").attr("checked",true);var h=ElementAction.ppmList.length;var g=0;while(h>-1){h--;if(ElementAction.ppmList[h]==b){g++;break}}if(g==1){return}ElementAction.ppmList.push(b)}});$(e).bind("mouseout",function(g){if(checkHover(g,this)){sheetClose=setTimeout(function(h){ElementAction.ppmRemove(null)},300)}});$(b).bind("mouseover",function(g){if(checkHover(g,this)){if(typeof(sheetClose)!="undefined"){clearTimeout(sheetClose)}ElementAction.ppmRemove(this)}});$(b).bind("mouseout",function(g){if(checkHover(g,this)){sheetClose=setTimeout(function(){ElementAction.ppmRemove(null)},300)}})},ppmRemove:function(b){var c=-1;for(c=ElementAction.ppmList.length-1;c>-1;c--){if(ElementAction.ppmList[c]==b){break}$(ElementAction.ppmList[c]).hide()}if(ElementAction.ppmList.length>0){ElementAction.ppmList.splice(c+1,ElementAction.ppmList.length-c-1)}}};function createUserList(g){$(".share_user_list").remove();var h="<ul style='display:none' class='share_user_list'>";var d=0;for(var f=0;f<usercontainter.length;f++){if(usercontainter[f]["login_account"].indexOf(g)>-1||usercontainter[f]["nick_name"].indexOf(g)>-1){h+="<li val='"+usercontainter[f]["login_account"]+"'><span>"+usercontainter[f]["nick_name"]+"</span>("+usercontainter[f]["login_account"]+")</li>";d++}}h+="</ul>";if(d==0){return false}else{$(document.body).append(h);var e=$(".share_user_div"),b=e.offset().left,j=e.offset().top,k=e.height();var c=$(".share_user_list");c.css({left:b+"px",top:(j+k+3)+"px"});c.find("li:first").addClass("user_isattach").attr("isattach","1");c.find("li").bind("click",function(){$this=$(this);$this.siblings(".user_isattach").removeClass("user_isattach").attr("isattach","0");$this.addClass("user_isattach");$this.attr("isattach","1");var l=$this.attr("val");if(e.find("span[val='"+l+"']").length==0){$(".user_list").append("<span class='t share_active' val='"+$this.attr("val")+"'>"+$this.find("span").text()+"<span class='c' onclick='$(this).parent().remove()'>×</span></span>");$(".share_user_list").remove();$(".share_user_text").focus();setShareUserLayout()}});c.show();return true}}function setShareUserLayout(){var b=160-$(".user_list").width()-5;if(b<=0){}$(".share_user_text").css("width",b+"px").val("")}function setGDLayout(e,d){var c=e.scrollWidth;var f=$(d).width();$(e).css("margin-left",(c-f>0?f-c:0)+"px")}function groupRe(b,c){$parent=$(c).parent();$(".share_group_select li[val='"+$parent.attr("val")+"']").attr("isattach","0").css("background-color","");$parent.remove();if($(".select_group").siblings().length==0){$(".select_group").show()}setGDLayout($(".group_list")[0],$(".share_group_div")[0]);if(b&&b.stopPropagation){b.stopPropagation()}else{window.event.cancelBubble=true}}function deptRe(b,c){$parent=$(c).parent();$parent.remove();if($(".select_dept").siblings().length==0){$(".select_dept").show()}setGDLayout($(".dept_list")[0],$(".share_dept_div")[0]);if(b&&b.stopPropagation){b.stopPropagation()}else{window.event.cancelBubble=true}}function showShareContainter(c){if($(".share_set_div").length==0){var b=[];b.push("<div id='doc_share' style='display:none' isdir='"+c[0]+"' isfile='"+c[1]+"' objectid='"+c[2]+"' class='modal share_set_div'>");b.push("<div class='doc_window_title'><span>&nbsp;&nbsp;共享设置</span></div>");b.push("<div style='width:100%;height:50px;border-bottom:1px solid #CCC'><div class='share_image_div'></div><div class='share_name_div'>"+c[3]+"</div></div>");b.push("<div class='share_load'>正在加载共享信息...</div><div style='display:none' class='share_content'>");b.push("<ul class='isshare_ul'><li><input type='radio' name='fff' isshare='0'/>不共享</li><li><input type='radio' name='fff' isshare='1'/>共享</li></ul>");b.push("<table class='share_set_table'><tr><td width='60px'>共享范围：</td>");b.push("<td><ul class='share_set_ul'><li><div><input type='checkbox' value='user'/>指定用户：</div><div class='share_user_div'><span class='user_list'></span><input type='text' style='border:0;padding:0;padding-left:3px;height:24px;background-color:white;margin-bottom:0;box-shadow:none;' class='share_user_text'/></div></li><li><div><input type='checkbox' value='group'/>指定群组：</div><div class='share_group_div'><span class='group_list'><span class='select_group'>选择群组</span></span></div></li><li><div><input type='checkbox' value='dept'/>指定部门：</div><div class='share_dept_div'><span class='dept_list'><span class='select_dept'>选择部门</span></span></div></li></ul></td></tr></table>");b.push("<div class='share_bar_div'><span class='doc_md_content_right_btn' onclick='submitSS()' >保存</span><span class='doc_md_content_right_btn' onclick='closeSS()'>取消</span></div></div></div>");$docshowlist.append(b.join(""));$(".isshare_ul input:radio").click(function(){if($(this).attr("isshare")=="1"){estop(false)}else{estop(true)}});$(".share_set_ul input:checkbox").click(function(){var g=$(this);if(!!g.attr("checked")){if(g.val()=="user"){$(".share_user_text").attr("disabled",false);$(".share_user_div").css("cursor","text")}}else{if(g.val()=="user"){$(".share_user_text").attr("disabled",true);$(".share_user_div").css("cursor","not-allowed")}}});$(".share_user_text").bind("keydown",function(g){var k=$(".share_user_div"),h=$(".share_user_list"),n=h.find("li[isattach='1']"),p=n.next(),o=n.prev();var m=g||window.event;if(g.keyCode==40){n.attr("isattach","0");n.removeClass("user_isattach");if(p.length==1){p.attr("isattach","1");p.addClass("user_isattach")}else{var l=h.find("li:eq(0)");l.attr("isattach","1");l.addClass("user_isattach")}return false}else{if(g.keyCode==38){n.attr("isattach","0");n.removeClass("user_isattach");if(o.length==1){o.attr("isattach","1");o.addClass("user_isattach")}else{h.find("li:last").attr("isattach","1");h.find("li:last").addClass("user_isattach")}return false}else{if(g.keyCode==13){var j=n.attr("val");if(k.find("span[val='"+j+"']").length==0){$(".user_list .share_active").removeClass("share_active");$(".user_list").append("<span class='t share_active' val='"+j+"'>"+n.find("span").text()+"<span class='c' onclick='$(this).parent().remove()'>×</span></span>");$(".share_user_list").remove();setShareUserLayout()}}}}});$(".share_user_div").click(function(g){if(checkHover(g,this)){$(".share_user_text").focus()}});$(".share_user_text").die("keyup").live("keyup",function(j){if(typeof(keyword)!="undefined"&&$(".share_user_list").length==1&&keyword==$(".share_user_text").val()){return}keyword=$(".share_user_text").val();var h=keyword.match(/^[A-Za-z0-9]{1,}$/),g=keyword.match(/^[A-Za-z0-9\u4e00-\u9fa5]{1,}$/);if(g==null&&h==null){$(".share_user_list").remove();return}if(typeof(usercontainter)=="undefined"){window.usercontainter=new Array()}if(!createUserList(keyword)){LoadData(null,getPersonUrl+"?keyword="+keyword+"&keytype="+(h==null?"name":""),function(k){if(k.length>0){usercontainter=k;createUserList(keyword)}})}})}else{$(".share_content").hide();$(".share_set_div").attr({isdir:c[0],isfile:c[1],objectid:c[2]});$(".share_name_div").text(c[3]);$(".share_load").show().text("正在加载共享信息...")}var e;if(c[0]=="1"){e=$("span.doc_info_name[dir_id='"+c[2]+"']").parent()}else{e=$("span.doc_info_name[file_id='"+c[2]+"']").parent()}var f=e[0].offsetTop;var d=$("#doc_share").height();$("#doc_share").css("top",(f-d)>0?((f-d)+"px"):"0px");$(".share_set_div").show()}window.filesharecache=new HashMap();window.dirsharecache=new HashMap();window.filecomcache=new HashMap();window.dircomcache=new HashMap();function getShareCard(g,f){var b=null;if(f[0]=="1"){b=dirsharecache.get(f[2])}else{b=filesharecache.get(f[2])}if(typeof(groups)=="undefined"||typeof(depts)=="undefined"||typeof(b)=="undefined"){window.groups=g.groups;window.depts=g.depts;b=g.shareinfo}var l="<ul style='display:none' class='share_group_select'>";for(var m=0;m<groups.length;m++){var c=0;for(var e=0;e<b.groups.length;e++){if(b.groups[e]["objectid"]==groups[m]["group_id"]){c=1;break}}l+="<li isattach='"+c+"' val='"+groups[m]["group_id"]+"'>"+groups[m]["group_name"]+"</li>"}l+="</ul>";var j="<ul style='display:none' class='share_dept_select'>";for(var m=0;m<depts.length;m++){var c=0;for(var e=0;e<b.depts.length;e++){if(b.depts[e]["objectid"]==depts[m]["dept_id"]){c=1;break}}j+="<li isattach='"+c+"' val='"+depts[m]["dept_id"]+"'>"+depts[m]["dept_name"]+"</li>"}j+="</ul>";if(g!=""){if(f[0]=="1"){dirsharecache.put(f[2],b)}else{filesharecache.put(f[2],b)}}$(document.body).append(l);$(".select_group").show().siblings("span").remove();$(".select_dept").show().siblings("span").remove();$(".user_list").find("span").remove();$(".share_set_ul input:checkbox").attr("checked",false);if(b.groups.length>0){$(".share_set_ul input:checkbox[value='group']").attr("checked",true);$(".select_group").hide();for(var e=0;e<b.groups.length;e++){$(".group_list").append("<span class='t' val='"+b.groups[e]["objectid"]+"'>"+b.groups[e]["object_name"]+"<span onclick='groupRe(event,this)' class='c'>×</span></span>")}setGDLayout($(".group_list")[0],$(".share_group_div")[0])}if(b.depts.length>0){$(".share_set_ul input:checkbox[value='dept']").attr("checked",true);$(".select_dept").hide();for(var e=0;e<b.depts.length;e++){$(".dept_list").append("<span class='t' val='"+b.depts[e]["objectid"]+"'>"+b.depts[e]["object_name"]+"<span onclick='deptRe(event,this)' class='c'>×</span></span>")}setGDLayout($(".dept_list")[0],$(".share_dept_div")[0])}if(b.persons.length==0){$(".share_user_text").attr("disabled",true);$(".share_user_div").css("cursor","not-allowed")}else{$(".share_set_ul input:checkbox[value='user']").attr("checked",true);$(".share_user_text").attr("disabled",false);var h=$(".user_list");var k=[];for(var e=0;e<b.persons.length;e++){k.push("<span class='t' val='"+b.persons[e]["objectid"]+"'>"+b.persons[e]["object_name"]+"<span onclick='$(this).parent().remove()' class='c'>×</span></span>")}h.append(k.join(""));setShareUserLayout()}$(".share_group_select li[isattach='1'],.share_dept_select li[isattach='1']").css("background-color","#dcdcdc");$(".share_group_select li").click(function(){var d=$(this);if(d.attr("isattach")=="1"){d.css("background-color","");d.attr("isattach","0");$(".group_list").children("span[val='"+d.attr("val")+"']").remove();if($(".select_group").siblings().length==0){$(".select_group").show()}}else{d.css("background-color","#dcdcdc");d.attr("isattach","1");$(".select_group").hide();$(".group_list").append("<span class='t' val='"+d.attr("val")+"'>"+d.text()+"<span onclick='groupRe(event,this)' class='c'>×</span></span>");setGDLayout($(".group_list")[0],$(".share_group_div")[0])}});ElementAction.ppmAction($(".share_group_div")[0],$(".share_group_select")[0]);ElementAction.ppmAction($(".share_dept_div")[0],$("#deptlist")[0]);$(".dept_list .c").bind("click",function(){$(this).parent().remove();if($(".select_dept").siblings().length==0){$(".select_dept").show()}});$(".share_load").hide();$(".share_content").show();if(b.depts.length+b.groups.length+b.persons.length>0){$(".isshare_ul input:radio[isshare='1']").attr("checked",true);estop(false)}else{$(".isshare_ul input:radio[isshare='0']").attr("checked",true);estop(true)}}function getMoreCom(){openfile($("#doc_comment").attr("objectid"))}function getComHTML(d){var c=[];for(var b=0;b<d.length;b++){c.push("<div class='com_one'><div><span class='t'><a value='conv_account' class='employee_name' login_account='"+d[b]["conv_account"]+"'>"+d[b]["conv_nickname"]+"</a>");if(d[b]["conv_to"]!=""){c.push("对<a value='conv_to' class='employee_name' login_account='"+d[b]["conv_to"]+"'>"+d[b]["to_nickname"]+"</a>")}c.push("说:</span></div><div><p>"+d[b]["content"]+"</p></div><div><span>"+d[b]["conv_time"]+"</span><a class='com_reply'>回复</a></div></div>")}return c.join("")}function showComment(d){var b=$("#conv_div"),c=$("#com_note"),e=$(".com_write textarea");b.find(".com_one").unbind().remove();if(d.length==0){c.text("暂无评论!");c.show().siblings().hide();return}else{c.hide();$(".com_5").show();$("#conv_content").append(getComHTML(d)).css("top","0px");$("#conv_content a.com_reply").bind("click",function(j){var h=j||window.event;if(checkHover(j,this)){var g=$(this).parent().parent().find("a[value='conv_account']");var k=g.attr("login_account");var f=g.text();$(".com_write_title").html("").append("<span>我对<a login_account='"+k+"'>"+f+"</a>说:</span>");e.val("");$("#conv_div .com_letter").text(e.attr("maxlength"));changeComCard();if(h&&h.stopPropagation){h.stopPropagation()}else{window.event.cancelBubble=true}}})}$(".com_write").hide();b.show();$("div.com_content").show()}function showshare(d){var c=[];if(d.persons.length>0){c.push("<p>共享用户:");for(var b=0;b<d.persons.length;b++){if(b==d.persons.length-1){c.push("<a class='employee_name' login_account='"+d.persons[b]["objectid"]+"'>"+d.persons[b]["object_name"]+"</a>")}else{c.push("<a class='employee_name' login_account='"+d.persons[b]["objectid"]+"'>"+d.persons[b]["object_name"]+"</a>,")}}c.push("</p>")}if(d.groups.length>0){c.push("<p>共享群组:");for(var b=0;b<d.groups.length;b++){if(b==d.groups.length-1){c.push("<a objectid='"+d.groups[b]["object_id"]+"'>"+d.groups[b]["object_name"]+"</a>")}else{c.push("<a objectid='"+d.groups[b]["object_id"]+"'>"+d.groups[b]["object_name"]+"</a>,")}}c.push("</p>")}if(d.depts.length>0){c.push("<p>共享群组:");for(var b=0;b<d.depts.length;b++){if(b==d.depts.length-1){c.push("<a objectid='"+d.depts[b]["object_id"]+"'>"+d.depts[b]["object_name"]+"</a>")}else{c.push("<a objectid='"+d.depts[b]["object_id"]+"'>"+d.depts[b]["object_name"]+"</a>,")}}c.push("</p>")}$("#docinfo_share").html("").append(c.join(""))}function winScroll(b){if(b.preventDefault){b.preventDefault()}b.returnValue=false}function convScroll(k){var j=document.getElementById("conv_content");var d=$("#conv_containter").height();var b=j.scrollHeight;if(b>d){var g=k||window.event,f,h=10;if(g.wheelDelta){f=g.wheelDeilta}else{if(g.detail){f=g.detail}}var c=j.style.top==""?0:((j.style.top.match(/\d+/)[0])*(-1));if(f>0){if(c>d-b){if(c-h>(d-b)){j.style.top=(c-h)+"px"}else{j.style.top=(d-b)+"px"}}}else{if(c<0){if(c+h<0){j.style.top=(c+h)+"px"}else{j.style.top="0px"}}}}if(g.preventDefault){g.preventDefault()}g.returnValue=false}function init(h,d,m,c){if(m){loadGroupDocList(m,c)}else{loadDocList("")}$(".doc_info_name").live("click",function(){var o=$(this);var j=o.attr("dir_id");if(typeof(j)!="undefined"&&j!=""){setDirPath(j,$.trim(o.text()));loadDocList(j);return}var p=o.attr("file_id");if(typeof(p)=="undefined"||p==""){return}});$(".com_write textarea").bind("keyup change",function(){var p=parseInt($(this).attr("maxlength"));var j=$(this).val().length;var o=$(this).val();if(j<p){$("#conv_div .com_letter").text(p-j)}else{$(this).val(o.substring(0,p));$("#conv_div .com_letter").text("0")}});if(mode!="select"){var g=document.getElementById("conv_content");if(g.addEventListener){g.addEventListener("DOMMouseScroll",convScroll,false)}g.onmousewheel=convScroll;window.moves=0;$("#com_note,#com_put").live("click",function(){if($(".com_write").css("display")!="none"){return}if($("#doc_comment").attr("active")=="1"){$("div.com_write_title").html("").append("<span>我说:</span>");changeComCard();$(".com_write").find("textarea").focus()}});$(".doc_tools_share").live("click",function(){var o=$(this);var p=o.attr("objectid");var j=[];j.push(o.attr("isdir"));j.push(o.attr("isfile"));j.push(p);var q=null;if(j[0]=="1"){q=dirsharecache.get(j[2]);j.push($(".doc_info_name[dir_id='"+p+"']").text())}else{q=filesharecache.get(j[2]);j.push($(".doc_info_name[file_id='"+p+"']").text())}$("#doc_tools").hide();showShareContainter(j);if(typeof(window.groups)!="undefined"&&typeof(window.depts)!="undefined"&&typeof(q)!="undefined"){getShareCard("",j);return}LoadData(null,d+"?isdir="+j[0]+"&isfile="+j[1]+"&resourceid="+j[2],function(r){getShareCard(r,j)})});$(".list_tr").live("mouseout",function(j){clearTimeout(dochoverTimer);clearTimeout(docoutTimer);if(checkHover(j,this)){docoutTimer=setTimeout("$('#doc_tools').hide()",100)}});$(".list_tr").live("mouseover",function(q){clearTimeout(docoutTimer);if(checkHover(q,this)){var p=$(this).find(".doc_info_name");var j=p.offset();var o={w:p.find("a").width()+30,h:p.height()};var r=p.attr("dir_id");dochoverTimer=setTimeout("show_tools_item("+(j.left+o.w)+","+(j.top+((o.h-20)/2))+","+(r==null?false:true)+",'"+(p.attr("dir_id")||p.attr("file_id"))+"')",100)}});$(".doc_info_name a").live("mouseout",function(j){clearTimeout(dochoverTimer);clearTimeout(docoutTimer);if(checkHover(j,this)){docoutTimer=setTimeout("$('#doc_tools').hide()",100)}});$(".doc_info_name a").live("mouseover",function(r){clearTimeout(docoutTimer);if(checkHover(r,this)){var o=$(this);var q=o.parent();var j=q.offset();var p={w:o.width()+30,h:q.height()};var t=q.attr("dir_id");dochoverTimer=setTimeout("show_tools_item("+(j.left+p.w)+","+(j.top+((p.h-20)/2))+","+(t==null?false:true)+",'"+(q.attr("dir_id")||q.attr("file_id"))+"')",100)}});$(".doc_info_name img").live("mouseout",function(j){clearTimeout(dochoverTimer);clearTimeout(docoutTimer);if(checkHover(j,this)){docoutTimer=setTimeout("$('#doc_tools').hide()",100)}});$(".doc_info_name img").live("mouseover",function(q){clearTimeout(docoutTimer);if(checkHover(q,this)){var p=$(this).parent();var j=p.offset();var o={w:p.find("a").width()+30,h:p.height()};var r=p.attr("dir_id");dochoverTimer=setTimeout("show_tools_item("+(j.left+o.w)+","+(j.top+((o.h-20)/2))+","+(r==null?false:true)+",'"+(p.attr("dir_id")||p.attr("file_id"))+"')",100)}});$("#doc_tools").live("mouseover",function(j){clearTimeout(docoutTimer)});$(".doc_tools_rename").live("click",function(){$("#doc_tools").hide();var o=$(this).attr("objectid");var j=$(".doc_createDir");j.find("input").val($(".doc_info_name[dir_id='"+o+"']").text());j.find("input")[0].focus();$(".savehint").html("");j.find(".doc_window_title span").html("&nbsp;&nbsp;重命名文件夹");$("#saveDir").attr("dir_id",o);j.show()});$(".doc_tools_delete").live("click",function(){$("#doc_tools").hide();var s=$(this).attr("objectid");var o=$(this).attr("isdir");var r=$("#deleteDoc"),q=$("#cancelDelete"),p=$(".doc_deleteconfirm");r.attr("objectid",s);var j=(o!=null&&o!="")?p.attr("checkdirurl")+"?dirid="+s:p.attr("checkfileurl")+"?fileid="+s;r.hide();q.text("关闭");p.find(".doc_rd_deleteconfirm_text").html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>&nbsp;删除前信息收集...');p.show();$.get(j,"",function(t){if(t.succeed==0){p.find(".doc_rd_deleteconfirm_text").html(t.msg);return}r.show();q.text("取消");if(o!=null&&o!=""){p.find(".doc_window_title span").html("&nbsp;&nbsp;删除文件夹");p.find(".doc_rd_deleteconfirm_text").html("确定要删除该文件夹？");r.attr("url_name","deletedirurl")}else{p.find(".doc_window_title span").html("&nbsp;&nbsp;删除文件");p.find(".doc_rd_deleteconfirm_text").html("确定要删除该文件？");r.attr("url_name","deletefileurl")}})});$(".doc_tools_open").live("click",function(){$("#doc_tools").hide();openfile($(this).attr("objectid"))});$(".doc_tools_download").live("click",function(){$("#doc_tools").hide();$("#filefrm").attr("src",path.replace("getfile","downloadfile")+$(this).attr("objectid"))});$(".doc_open_file_download").live("click",function(){$("#filefrm").attr("src",$(this).attr("src"));$("#doc_tools").hide()});$(".doc_tools_publish").live("click",function(){var j=$(this).attr("objectid");$("#savePublish").attr("objectid",j);$("#doc_tools").hide();$file_text=$(".doc_info_name[file_id='"+j+"']").text();FaFaShare.share_Show_Window($file_text+"  打开:"+(path+j)+" 下载："+(path.replace("getfile","downloadfile")+j))});$(".doc_tools_cfile").unbind("click").bind("click",function(){if(currentDir.indexOf("|")>0){return}$("#save_new_doc_hint").html("");$("#doc_create_content").show()});$("#saveNewDoc").unbind("click").bind("click",function(){var o=$.trim($("#newdoc_name").val()),j=$("#save_new_doc_hint");if(o==""){j.html("<font color=red>&nbsp;&nbsp;提示：文档名称不能为空！</font>").show();setTimeout(function(){$("#save_new_doc_hint").hide()},3000);return}var p=$.trim(newDoc_Input.getSource());if(p==""){j.html("<font color=red>&nbsp;&nbsp;提示：文档正文不能为空！</font>").show();setTimeout(function(){$("#save_new_doc_hint").hide()},3000);return}$("#newdoc_content").val(p);$("#newdoc_parent_dir").val(currentDir);$("#frm_newdoc").ajaxSubmit({dataType:"json",success:function(q){if(q.succeed){j.html("&nbsp;&nbsp;提示：文档保存成功").show();setTimeout(function(){$("#doc_create_content").hide();newDoc_Input.setSource("")},2000);$.get($docshowlist.attr("fileurl")+"?parentid="+currentDir+"&fileid="+q.fileid,"",function(r){if(r.data.length>0){files=r.data.concat(filesCache.get(currentDir));filesCache.put(currentDir,files);showDoc(files,dirsCache.get(currentDir))}})}else{j.html("<font color=red>&nbsp;&nbsp;提示：保存失败</font>").show();setTimeout(function(){$("#doc_create_content").hide();newDoc_Input.setSource("")},3000)}},error:function(q){j.html("<font color=red>&nbsp;&nbsp;提示：保存失败</font>").show();setTimeout(function(){$("#doc_create_content").hide();newDoc_Input.setSource("")},3000)}})})}$("#docSearchCondition").unbind().bind("keypress",function(j){if(j.keyCode==13){$("#btnDocSearch").trigger("click")}});$("#btnDocSearch").live("click",function(){var j=$.trim($("#docSearchCondition").val());if(j==""){return}var p=$("#con_mgr_two1");p.html("<div class='urlloading'><div />");var q=[],r=[];var o=$("#hpost_to_group").val();if(o!=null&&o!=""){o="g"+o}else{o=""}$.get($docshowlist.attr("fileurl")+"?parentid="+o+(j!=null?"&name="+j:""),"",function(s){q=s.data;currentDir="search";showDoc(q,[]);issearch=true})});$(".list_tr").live("click",function(){var t=$(this);$(".doc_row_active").attr("class","list_tr doc_row");t.attr("class","list_tr doc_row_active");var w=t.find(".doc_info_name");if(w.length==0){return}var j=w.attr("file_id");if(mode=="select"){if(typeof(j)=="undefined"||j==""){$(".insertSelFile").hide();return}currentSelectedFileID=j;currentSelectedFileName=w.text();$(".insertSelFile").show();return}if($("#attributes_list_hint").length>0){$("#attributes_list_content").show();$("#attributes_list_hint").remove()}var p=t.offset().top,q=p-fileListOffset.top,E=$(".doc_attributes"),u=$(".doc_comment");if(q>minHeight){p=q+t.height()-E.height()-u.height();E.css("top",p+"px");u.css("top",p+"px")}else{E.css("top","0px");u.css("top","0px")}var D="",r=t.attr("jid");if(typeof(r)!="undefined"&&r!=""&&r!=g_owner){D="<img style='cursor:pointer;width:16px;height:16px;margin-left: 5px;' title='给Ta发送消息' src='/bundles/fafatimewebase/images/reg_t0.png' onclick=\"FaFaChatWin.ShowRoster('"+r+"')\">"}$("#docinfo_name span:eq(1)").text(w.text());$("#docinfo_owner span:eq(1)").html("<a class='employee_name' login_account='"+t.attr("acc")+"'>"+t.attr("user")+"</a>"+D);$("#docinfo_date span:eq(1)").text(t.find(".doc_info_cdate").text());var s=E.attr("url");var F=$(this).find(".doc_info_name[dir_id]");var o=$(this).find(".doc_info_name[file_id]"),x,y;if(F.length!=0){x=F.attr("dir_id");y=dirsharecache.get(x)}else{x=o.attr("file_id");y=filesharecache.get(x)}if(typeof(y)=="undefined"){LoadData(null,d+"?isdir="+(F.length==0?"0":"1")+"&isfile="+(F.length==0?"1":"0")+"&resourceid="+x,function(G){y=G.shareinfo;window.groups=G.groups;window.depts=G.depts;if(F.length!=0){dirsharecache.put(x,y)}else{filesharecache.put(x,y)}showshare(y)})}else{showshare(y)}var B=$("#doc_comment"),A=B.find(".comfor"),C,z=$(".com_write_title");A.text("/"+w.text());A.attr("title",w.text());B.attr("active","1");z.text("");z.siblings("textarea").val("");$("#conv_div .com_letter").text(z.siblings("textarea").attr("maxlength"));if(F.length!=0){x=F.attr("dir_id");C=dircomcache.get(x)}else{x=o.attr("file_id");C=filecomcache.get(x)}B.attr("objectid",x);if(F.length!=0){B.attr("isdir","1")}else{B.attr("isfile","1")}if(typeof(C)=="undefined"){LoadData(null,getcomUrl+"?isdir="+(F.length==0?"0":"1")+"&isfile="+(F.length==0?"1":"0")+"&resourceid="+x,function(G){C=G.cominfo;if(F.length!=0){dircomcache.put(x,C)}else{filecomcache.put(x,C)}showComment(C)})}else{showComment(C)}});$(".dirpath").live("click",function(){var j=$(this).attr("dir_id");if(currentDir==j&&!issearch){return}issearch=false;if(j==null||j==""){$("#hpost_to_group").val("")}setDirPath(j);loadDocList(j)});$(".dir_tools_returnup").live("click",function(){if(currentDir==""&&!issearch){return}var j=$(".dirlist [dir_id='"+currentDir+"']");driid=j.prev().prev().attr("dir_id");if(driid==null){driid=""}setDirPath(driid);loadDocList(driid)});$(".dir_tools_refresh").live("click",function(){dirsCache.put(currentDir,null);shareDirs.put(currentDir,null);loadDocList(currentDir)});if(mode!="select"){$(".doc_tools_cdir").bind("click",function(){var j=$(".doc_createDir");j.show();j.find("input").val("");j.find("input")[0].focus();$(".savehint").html("");j.find(".doc_window_title span").html("&nbsp;&nbsp;创建新文件夹");$("#saveDir").attr("dir_id","")});$("#cancelDir").bind("click",function(){$(".doc_createDir").hide()});$("#cancelDelete").bind("click",function(){$(".doc_deleteconfirm").hide()});$("#cancelPublish").bind("click",function(){$(".doc_publish").hide();b=false});$("#deleteDoc").bind("click",function(){var o=$(this);var p=o.attr("url_name");var j=o.attr(p);$(".deletehint").html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');$.post(j,"fileid="+o.attr("objectid"),function(q){$("#deleteDoc").hide();$("#cancelDelete").text("关闭");$(".deletehint").html("");if(q.succeed==1){$(".doc_rd_deleteconfirm_left").attr("class","doc_rd_deleteconfirm_left_ok");$(".doc_deleteconfirm .doc_rd_deleteconfirm_text").html("删除成功！");setTimeout('$(".doc_deleteconfirm").hide();$(".doc_rd_deleteconfirm_left_ok").attr("class","doc_rd_deleteconfirm_left");',1000);dirsCache.put(currentDir,null);loadDocList(currentDir)}else{$(".doc_rd_deleteconfirm_left").attr("class","doc_rd_deleteconfirm_left_error");$(".doc_deleteconfirm .doc_rd_deleteconfirm_text").html(q.msg);setTimeout('$(".doc_deleteconfirm").hide();$(".doc_rd_deleteconfirm_left_error").attr("class","doc_rd_deleteconfirm_left");',5000)}})});$("#saveDir").bind("click",function(){var o=$.trim($(".doc_createDir input").val());var j=$(".savehint");if(o==""){j.html("<div><font style='color:red'>提示：名称不能为空</font></div>");$(".doc_createDir input")[0].focus();return}j.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');var p=$(this).attr("dir_id");$.post($(this).attr("url"),"name="+o+"&parentid="+currentDir+(p!=""?"&id="+p:""),function(q){if(q.succeed==1){j.html("<div><font style='color:red'>提示：保存成功！</font></div>");if(p!=null&&p!=""){$(".doc_info_name[dir_id='"+p+"'] A").text(o);$(".doc_createDir").hide();return}$.get($docshowlist.attr("dirurl")+"?parentid="+currentDir+"&dirid="+q.id,"",function(r){if(r.data.length>0){dirs=r.data.concat(dirsCache.get(currentDir));dirsCache.put(currentDir,dirs);showDoc(filesCache.get(currentDir),dirs)}});$(".doc_createDir").hide()}else{j.html("<div><font style='color:red'>提示：保存失败！</font></div>")}})});var b=false;$("#savePublish").bind("click",function(){if(b){return}var p=$(".circle_list_item[select='1']").attr("circle_id");if(p==null){p=""}var o=$(".group_list_item[select='1']").attr("group_id");if(o==null){o=""}var j=$(".publishsavehint");if(p==""){j.html("<div><font style='color:red'>提示：无效的圈子</font></div>");return}j.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');b=true;$.post($(this).attr("url"),"circleId="+p+"&gorupid="+o+"&fileid="+$(this).attr("objectid")+"&remark="+$("#doc_publish_remark").val(),function(q){b=false;if(q.succeed==1){j.html('<IMG src="/bundles/fafatimewebase/images/ok.png" width=16 height=16>&nbsp;分享成功！');setTimeout("$('.doc_publish').hide();$('.publishsavehint').html('')",2000)}else{j.html('<IMG src="/bundles/fafatimewebase/images/error.png" width=16 height=16>&nbsp;分享失败！')}})});var k=$("#doc_publish_circle_list");var n=$("#doc_publish_group_list");for(var f=0;f<circles.length;f++){var l=0;if(g_curr_circle_id==circles[f].circle_id){$("#spost_to_circle_name").text(circles[f].circle_name);for(var e=0;e<groups.length;e++){if(groups[e].circle_id==g_curr_circle_id){n.append("<li group_id='"+groups[e].group_id+"'><a href='javascript:void(0);' title='分享给("+groups[e].group_name+")的全部成员' group_value='"+groups[e].group_id+"' ><div class='postto_group icon16'></div><span select='0' class='group_list_item'>"+groups[e].group_name+"</span></a></li>")}}l=1}k.append("<li circle_id='"+circles[f].circle_id+"'><a href='javascript:void(0);' title='分享给("+circles[f].circle_name+")的全部成员' group_value='ALL' onclick='mi_post_to_group_OnClick(this)'><div class='postto_all icon16'></div><span select='"+l+"' class='circle_list_item'>"+circles[f].circle_name+"</span></a></li>")}$(".circle_list_item").unbind("click").bind("click",function(){var p=$(this);$("#spost_to_circle_name").text(p.text());$(".circle_list_item").attr("select","0");p.attr("select","1");var q=p.attr("circle_id");n.html('<li style="background-color:#99CCCC; text-align:center; color:#fff;">分享到 …</li>');n.append('<li group_id="" ><a href="javascript:void(0);" ><div class="postto_group icon16"></div><span select="1" class="group_list_item">全部成员</span></a></li>');$("#spost_to_group_name").text("全部成员");for(var o=0;o<groups.length;o++){if(groups[o].circle_id==q){n.append("<li group_id='"+groups[o].group_id+"'><a href='javascript:void(0);' title='分享给("+groups[o].group_name+")的全部成员'><div class='postto_group icon16'></div><span class='group_list_item' select='0'>"+groups[o].group_name+"</span></a></li>")}}});$(".group_list_item").unbind("click").bind("click",function(){$("#spost_to_group_name").text($(this).text());$(".group_list_item").attr("select","0");$(this).attr("select","1")});$(".docpublishcirclelist").live("mouseover",function(o){var j=$("#doc_publish_circle_list").height();j=j<40?0:j;$(".doc_publish").css("height",(195+j)+"px")});$(".docpublishcirclelist").live("mouseout",function(o){if(!checkHover(o,this)){return}var j=$(".doc_publish");j.css("height","195px")});$(".docpublishgrouplist").live("mouseover",function(o){var j=$("#doc_publish_group_list").height();j=j<40?0:j;$(".doc_publish").css("height",(195+j)+"px")});$(".docpublishgrouplist").live("mouseout",function(o){if(!checkHover(o,this)){return}var j=$(".doc_publish");j.css("height","195px")})}}function getCurrentSelectedFileID(){return{fileId:currentSelectedFileID,fileName:currentSelectedFileName}}function fileSelect_ext(d){var c=document.getElementById("filedata").value.split("\\");fn=c[c.length-1];var b=$("#mgr_upload_file_ing");b.html("<img width=16 height=16 src='/bundles/fafatimewebase/images/loadingsmall.gif'><a>上传中</a>");$("#mgr_upload_file_sel").hide();b.show();$("#hpost_to_dir").val(currentDir);$("form#mgr_upload_file").ajaxSubmit({dataType:"json",url:d,method:"post",success:function(e){if(e.succeed){b.text("已上传");setTimeout(function(){$("#mgr_upload_file_ing").hide();$("#mgr_upload_file_sel").show()},3000);$.get($docshowlist.attr("fileurl")+"?parentid="+currentDir+"&fileid="+e.fileid,"",function(f){if(f.data.length>0){files=f.data.concat(filesCache.get(currentDir));filesCache.put(currentDir,files);showDoc(files,dirsCache.get(currentDir))}})}else{b.html("<font color=red>上传失败</font>");setTimeout(function(){$("#mgr_upload_file_ing").hide();$("#mgr_upload_file_sel").show()},3000)}},error:function(f){b.html("<font color=red>上传失败</font>");setTimeout(function(){$("#mgr_upload_file_ing").hide();$("#mgr_upload_file_sel").show()},3000)}})}(function(b){b.fn.maxlength=function(d){var c=jQuery.extend({events:[],maxCharacters:200,status:true,statusClass:"status",statusText:"还能输入字符数:",notificationClass:"notification",showAlert:false,alertText:"You have typed too many characters.",slider:false},d);b.merge(c.events,["keyup"]);return this.each(function(){var h=b(this);var e=b(this).val().length;function l(){var m=c.maxCharacters-e;if(m<0){m=0}h.next("div").html(c.statusText+" "+m)}function k(){var m=true;if(e>=c.maxCharacters){m=false;h.addClass(c.notificationClass);h.val(h.val().substr(0,c.maxCharacters));f()}else{if(h.hasClass(c.notificationClass)){h.removeClass(c.notificationClass)}}if(c.status){l()}}function f(){if(c.showAlert){alert(c.alertText)}}function j(){var m=false;if(h.is("textarea")){m=true}else{if(h.filter("input[type=text]")){m=true}else{if(h.filter("input[type=password]")){m=true}}}return m}if(!j()){return false}b.each(c.events,function(n,m){h.bind(m,function(o){e=h.val().length;k()})});if(c.status){h.after(b("<div/>").addClass(c.statusClass).html("-"));l()}if(!c.status){var g=h.next("div."+c.statusClass);if(g){g.remove()}}if(c.slider){h.next().hide();h.focus(function(){h.next().slideDown("fast")});h.blur(function(){h.next().slideUp("fast")})}})}})(jQuery);var Account={login_account:"",enterNext:function(b,c){document.getElementById(b).onkeypress=function(d){if((d||window.event).keyCode==13){document.getElementById(c).focus()}}},inputPlusInteger:function(d){var c=this.getEvent();var b=c.keyCode+c.charCode;if(document.all!=null){if(b<48||b>57){c.keyCode=0;return}}else{if(b<48||b>57){return false}}return true},load_day:function(g){var f=$("#dateYear").val();var d=$("#dateDay").val();var c=0;if(g==2){if(((f%4==0)&&(f%100!=0))||(f%400==0)){c=29}else{c=28}}else{if(g==1||g==3||g==5||g==7||g==8||g==10||g==12){c=31}else{c=30}}$("#dateDay").find("option").remove().end();var b="";for(var e=1;e<=c;e++){b=e<10?"0"+String(e):String(e);if(b==d){$("#dateDay").append("<option value='"+b+"' selected='true'>"+b+"</option>")}else{$("#dateDay").append("<option value='"+b+"'>"+b+"</option>")}}},checkName:function(b){var c=$(b).parent();if($.trim(b.value).length<1){c.find("span").text("真实姓名不能为空！");c.find("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");c.find("img").show();b.focus();return false}return true},checkYear:function(b){var c=$(b).parent();if(b.value.length<1){c.find("span").text("年份不能为空！");c.find("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");c.find("img").show();b.focus();return false}else{if(b.value.length!=4||!/\d\d\d\d/g.test(b.value)){c.find("span").text("年份只能由4位数字组成！");c.find("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");c.find("img").show();b.focus();return false}else{if(b.value*1<1900||b.value*1>(new Date().getYear()+1900-16)){c.find("span").text("年份必须在1900-"+(new Date().getYear()+1900-16)+"年之间");c.find("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");c.find("img").show();b.focus();return false}}}c.find("span").text("");c.find("img").hide();return true},submit_content:function(b){var d=$(b);var e=document.getElementById("btnSave");if(e.tagName=="SPAN"){if(!pcCheck()){return}}if($("#txtmobile").val()!=""){var c=/^(13[0-9]|15[0-9]|18[0-9])\d{8}$/;if(!c.test($("#txtmobile").val())){$("#hint").show();$("#hint_img").attr("src",$("#hint_img").attr("errurl"));$("#hint_msg").text("手机号码格式不正确");setTimeout("$('#hint').hide()",2000);return false}}if(!this.checkName($("#txtname")[0])){return}e.disabled=true;if(e.tagName=="SPAN"){e.innerHTML="提交中..."}else{e.value="提交中..."}$("form").ajaxSubmit({dataType:"json",url:d.attr("saveurl"),method:"post",success:function(f){if(f.succeed){$("#hint").show();$("#hint_img").attr("src",$("#hint_img").attr("okurl"));$(".allphoto #preview").attr("Src",f.path);$("#hint_msg").text("基本信息保存成功");setTimeout("$('#hint').hide()",2000)}else{$("#hint").show();$("#hint_img").attr("src",$("#hint_img").attr("errurl"));$("#hint_msg").text("基本信息保存失败");setTimeout("$('#hint').hide()",2000)}e.disabled=false;if(e.tagName=="SPAN"){e.innerHTML="保存"}else{e.value="保存"}}})},getPointsHisPage:function(b){$("#point_his").empty();LoadComponent("point_his",$("#point_his").attr("hisurl"),{pageindex:b})},deptClick:null,deptCheck:null,loadDept:function(c){if($("#deptdiv").attr("isload")=="1"){return}var b={data:{simpleData:{enable:true}},check:{enable:c==null?false:c,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"}},callback:{onCheck:function(d,f,e){if(Account.deptCheck!=null){Account.deptCheck(f,e);return}},beforeClick:function(e,d){if(d.id=="new"){return false}return true},onClick:function(f,h,g){if(Account.deptClick!=null){Account.deptClick(h,g);return}if(f.target.tagName=="INPUT"){return}if($(f.target).parent().find("#newdept").length>0){return}var e=$.fn.zTree.getZTreeObj("depttree");if($("#newdept").length>0){var d=e.getNodeByTId($("#newdept").parent().parent().parent()[0].id);e.removeNode(d)}if(f.target.tagName=="IMG"){if(f.target.parentNode.id=="adddept"){var d={id:"new",name:"",pId:h};d=e.addNodes(g,d);$("#"+d[0].tId).find("a span").css("float","left");d=$("#"+d[0].tId).find("a span:eq(1)");d.html("<span id='newdept' style='float:left'><input maxlength=10 type=text style='height:14px;width:100px;font-size:12px;float: left;'><img title='保存数据' src='/bundles/fafatimewebase/images/save_dept.png' style='left:96px;width:16px;height:16px;float: left;'><a style='color:red'></a></span>");setTimeout('$("#newdept input").focus()',100)}else{if(f.target.parentNode.id=="deldept"){$.post($("#deptdiv").attr("delurl"),"deptid="+g.id,function(j){if(j.s){if(g.id==$("#txtdeptid").val()){$("#txtdeptid").val("");$("#txtdept").val("")}e.removeNode(g)}})}}return}$("#txtdept").val(g.name);$("#txtdeptid").val(g.id);$("#txtdept").parent().find("span").hide()}}};$("#deptdiv").attr("isload","1");$.get($("#deptdiv").attr("url"),"",function(e){zNodes=e;if(zNodes.length==1){$("#txtdept").val(zNodes[0].name);$("#txtdeptid").val(zNodes[0].id)}$.fn.zTree.init($("#depttree"),b,zNodes);$("#txtdept").parent().find("span div:eq(0)").hide();$("#deptdiv").show();$("#depttree").find("a").live("mouseover",function(){if($("#adddept").length==0){return}if($(this).find("#adddept").length>0||$(this).find("#newdept").length>0){return}if($(this).find("span:eq(1)").text()==""){return}$(this).append($("#adddept")[0].outerHTML.replace("none",""));var d=$.fn.zTree.getZTreeObj("depttree").getNodeByTId(this.parentNode.id);if(!d.isParent&&d.owner==Account.login_account){$(this).append($("#deldept")[0].outerHTML.replace("none",""))}});$("#depttree").find("a").live("mouseout",function(d){if($("#adddept").length==0){return}if(checkHover(d,this)){$(this).find("#adddept").remove();$(this).find("#deldept").remove()}});$("#deptdiv").unbind().bind("mouseout",function(d){if(checkHover(d,this)){Account.hideDept()}});$("#newdept img").live("click",function(){var f=$("#newdept input").val().replace(/ /g,"");$("#newdept a").html("");var g=$.fn.zTree.getZTreeObj("depttree");var d=g.getSelectedNodes();if(f==""||f.length<3){$("#newdept input").focus();$("#newdept a").html("不少于3个字");return}$("#newdept a").html("提交中...");$.post($("#deptdiv").attr("saveurl"),"deptname="+f+"&pid="+d[0].id,function(j){if(j.s){$("#txtdept").val(j.name);$("#txtdeptid").val(j.id);var h=g.getNodeByTId($("#newdept").parent().parent().parent()[0].id);g.removeNode(h);if(g.getNodeByParam("id",j.id,null)==null){var h={id:j.id,name:j.name,pId:j.pId,owner:Account.login_account};treeNode=g.getNodeByParam("id",j.pId,null);h=g.addNodes(treeNode,h)}$("#txtdept").parent().find("span").hide()}else{$("#newdept a").html("保存失败！")}})})})},showDept:function(){var b=$("#deptdiv").parent();b.show();b.find("span").show()},hideDept:function(){var b=$("#deptdiv").parent();b.hide()},login_account_datasource:function(b,c){$.getJSON(q_path,{q:this.query,t:new Date().getTime()},function(e){datasource=e;for(var d=0;d<datasource.length;d++){datasource[d].index=d;datasource[d].toString=function(){return this.index}}c(datasource)});return null},login_account_matcher:function(b){if(this.query){return ~b.login_account.toLowerCase().indexOf(this.query.toLowerCase())||~b.nick_name.indexOf(this.query)}return false},login_account_sorter:function(b){return b},login_account_highlighter:function(b){return"<strong>"+b.nick_name+"("+b.login_account+")</strong>"},report_object_login_account_updater:function(d){var c=datasource;if($("#InputNotifyArea_report_object input[value='"+c[d].login_account+"']").length==0&&$("#InputNotifyArea_report_object input").length==0){$(".nosetxiashu").remove();$("#InputNotifyArea_report_object").append(GetNotifyTemplate(c[d].login_account,c[d].nick_name).replace("NotifyClose_OnClick","Account.NotifyClose_OnClick"));$("#report_object").hide()}return""},direct_manages_login_account_updater:function(c){var b=datasource;if($("input[value='"+b[c].login_account+"']",$("#InputNotifyArea")).length==0){$(".nosetxiashu").remove();$("#InputNotifyArea").append(GetNotifyTemplate(b[c].login_account,b[c].nick_name))}return""},NotifyClose_OnClick:function(b){$sender=$(b);$sender.parent().remove();$("#report_object").show()},txtNotify_OnKeyUp:function(d){if(d.keyCode==8){if($(this).val()==""){$("#InputNotifyArea_report_object .NotifyObj:last").remove()}}else{if(d.keyCode==13){var c=$(this);v=c.val();if(v==""){return}if(v.indexOf("@")<=0){c.val("");return}var b=$("#InputNotifyArea");if($("input[value='"+v+"']",b).length==0){b.append(GetNotifyTemplate(v,v))}c.val("")}}}};var OnlineList={LI_TEMPLATE:'<li><a href="#" class="employee_name" login_account="[LOGIN_ACCOUNT]"><span style="display:none;">[NICK_NAME]</span><img width="24" height="24" title="[NICK_NAME]" src="[PHOTOURL]" onerror="this.src=\'[ERRORIMG]\'"></a></li>',LI_HEIGHT:44,$right_onlinelist:null,onlineurl:"",friendurl:"",init:function(b){var c=$(b);this.$right_onlinelist=c.find("#right_onlinelist");this.onlineurl=c.attr("onlineurl");this.friendurl=c.attr("friendurl");this.getFriendList()},onwindowresize:function(){OnlineList.$right_onlinelist.css("max-height",$(window).height()-160);var b=OnlineList.$right_onlinelist.children("ul");var c=b.offset();var d=(c.top-b.parent().offset().top)+b.height()-b.parent().height();if(d>0){OnlineList.$right_onlinelist.siblings().show()}else{OnlineList.$right_onlinelist.siblings().hide()}},getFriendList:function(){$.getJSON(OnlineList.friendurl,{t:new Date().getTime()},function(b){OnlineList.getOnlineList()})},getOnlineList:function(){$.getJSON(OnlineList.onlineurl,{t:new Date().getTime()},function(b){window.setTimeout(OnlineList.getOnlineList,60*1000)})},right_onlinelist_mousewheel:function(b,c){if(c>0){OnlineList.online_up_OnClick(OnlineList.$right_onlinelist.siblings("#online_up")[0])}else{if(c<0){OnlineList.online_down_OnClick(OnlineList.$right_onlinelist.siblings("#online_down")[0])}}b.preventDefault()},online_up_OnClick:function(d){var e=$(d);var b=e.siblings().children(".online-list-user");var c=b.offset();var f=-(c.top-b.parent().offset().top);if(f>0){if(f>OnlineList.LI_HEIGHT){b.offset({top:c.top+OnlineList.LI_HEIGHT})}else{b.offset({top:c.top+f})}}},online_down_OnClick:function(d){var e=$(d);var b=e.siblings().children(".online-list-user");var c=b.offset();var f=(c.top-b.parent().offset().top)+b.height()-b.parent().height();if(f>0){if(f>OnlineList.LI_HEIGHT){b.offset({top:c.top-OnlineList.LI_HEIGHT})}else{b.offset({top:c.top-f})}}},online_expand_OnClick:function(b){var c=$(b);c.hide().siblings().show().parent().siblings("div.online-list-box").show()},online_collapse_OnClick:function(b){var c=$(b);c.hide().siblings().show().parent().siblings("div.online-list-box").hide()}};var enterprise_setting={enterNext:function(b,c){document.getElementById(b).onkeypress=function(d){if((d||window.event).keyCode==13){document.getElementById(c).focus()}}},getEvent:function(){if(document.all){return window.event}var c=this.getEvent.caller;while(c!=null){var b=c.arguments[0];if(b){if((b.constructor==Event||b.constructor==MouseEvent)||(typeof(b)=="object"&&b.preventDefault&&b.stopPropagation)){return b}}c=c.caller}return null},inputPlusInteger:function(d){var c=this.getEvent();var b=c.keyCode+c.charCode;if(document.all!=null){if(b<48||b>57){c.keyCode=0;return}}else{if(b<48||b>57){return false}}return true},checkEname:function(e,b){var c=$(b).val();var d=/\s*\S{2,}\s*/;if(!d.test(c)){$(b).siblings("span").text("企业名称不能为空！");$(b).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");$(b).siblings("img").show();$(b).focus();g_ename_return=false;return false}$.post(e,{ename:c},function(f){if(f.exist){$(b).siblings("span").text("企业名称已存在!");$(b).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");$(b).siblings("img").show();$(b).focus();g_ename_return=false}else{g_ename_return=true;$(b).siblings("span").text("");$(b).siblings("img").hide();document.getElementById("btnSave").disabled=false}})},checkEshrotname:function(e,b){var d=$(b).val();var c=/\s*\S{2,}\s*/;if(!c.test(d)){$(b).siblings("span").text("企业简称不能为空！");$(b).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");$(b).siblings("img").show();$(b).focus();g_eshortname_return=false;return false}$.post(e,{eshortname:d},function(f){if(f.exist){$(b).siblings("span").text("企业简称已存在!");$(b).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");$(b).siblings("img").show();$(b).focus();g_eshortname_return=false;return false}else{g_eshortname_return=true;$(b).siblings("span").text("");$(b).siblings("img").hide();document.getElementById("btnSave").disabled=false}})},datasource:function(b,c){$.getJSON(manager_query_url,{q:this.query,network_domain:network_domain,t:new Date().getTime()},function(e){datasource=e;for(var d=0;d<datasource.length;d++){datasource[d].index=d;datasource[d].toString=function(){return this.index}}c(datasource)});return null},manager_matcher:function(b){if(this.query){return ~b.login_account.toLowerCase().indexOf(this.query.toLowerCase())||~b.nick_name.indexOf(this.query)}return false},manager_sorter:function(b){return b},manager_highlighter:function(b){return"<strong>"+b.nick_name+"("+b.login_account+")</strong>"},manager_updater:function(c){a=datasource;var b=this.$element.attr("id"),d=$("#InputNotifyArea");if(b=="meeting_manager"){d=$("#meeting_InputNotifyArea")}if(b=="mobile_manager"){d=$("#mobile_InputNotifyArea")}if($("input[value='"+a[c].login_account+"']",d).length==0){d.append(GetNotifyTemplate(a[c].login_account,a[c].nick_name))}return""},online_service_highlighter:function(b){return"<strong>"+b.nick_name+"("+b.fafa_jid+")</strong>"},online_service_updater:function(c){var b=datasource;var e=$(this.$element.context);var d=e.attr("key_type");if(d.match(/name$/)){e.val(b[c].nick_name)}if(d.match(/account$/)){e.val(b[c].fafa_jid)}},add_a_click:function(c,e){var j=$(c);var b=j.attr("id").substring(0,j.attr("id").indexOf("_"));var g=j.parent("label.control-label").siblings("div.controls").children("div.input-prepend").children("input.span2").length/2;if(g<e){var f='<div class="input-prepend"   style="position:relative;"><span class="add-on">名称</span><input class="span2" type="text" value="" key_type="'+b+'_name" id="'+b+"_name"+(g+1)+'"  onblur=enterprise_setting.name_edit_click(this)><span class="add-on">关联账号</span><input class="span2" type="text" value="" empid="" data-provide="typehead" key_type="'+b+'_account" id="'+b+"_account"+(g+1)+'"  onblur=enterprise_setting.account_edit_click(this)><img   class="error_img" style="display:none;margin-top:8px;" src="" width="16" height="16"><span  class="tip_span" style="position:absolute;top:0px;right:10px;margin-top:2px;font-size:14px;height:30px;line-height:30px;color:red;"></span></div>';j.parent("label.control-label").siblings("div.controls").append(f);var h=$("#"+b+"_name"+(g+1));var d=h.parent("div.input-prepend").siblings("div.input-prepend").has("img.edit_add_img").children("img.edit_add_img");h.siblings("input.span2").after(d[0])}},name_edit_click:function(b){var h=$(b);h.siblings("span.tip_span").text("");h.siblings("img.error_img").hide();var d=h.attr("key_type");var c=h.attr("id");var j=false;if(h.val().length==0){h.siblings("span.tip_span").text("该名称不能为空!");h.siblings("img.error_img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");h.siblings("img.error_img").show();return}h.parent("div.input-prepend").parent("div.controls").children("div.input-prepend").children("input[key_type="+d+"][id!="+c+"]").each(function(){if(this.value==h.val()){j=true;h.siblings("span.tip_span").text("该名称已存在!");h.siblings("img.error_img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");h.siblings("img.error_img").show();return}});if(j){return}var f=h.val();var k=h.attr("key_type").substring(0,h.attr("key_type").indexOf("_"));var e=h.siblings("input").attr("empid");var g=h.siblings("input.span2").val();$.getJSON(new_public_account_url,{ename:f,etype:k,empid:e},function(m){if(m.length==0){h.siblings("span.tip_span").text("该项修改失败!");h.siblings("img.error_img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");h.siblings("img.error_img").show()}else{h.siblings("span.tip_span").text("");h.siblings("img.error_img").hide();for(var l=0;l<m.length;l++){if(m[l].match(/^v[\d]+-[a-z]{4,7}/)){$.getJSON(save_public_account_url,{empid:m[l],account:g},function(n){if(n.length==0){h.siblings("span.tip_span").text("该项修改失败!");h.siblings("img.error_img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");h.siblings("img.error_img").show()}else{h.siblings("span.tip_span").text("");h.siblings("img.error_img").hide();h.siblings("input.span2").attr("empid",n[l])}})}}}})},account_edit_click:function(b){var f=$(b);f.siblings("span.tip_span").text("");f.siblings("img.span2").hide();var h=f.attr("key_type");var d=f.attr("id");var c=false;f.parent("div.input-prepend").parent("div.controls").children("div.input-prepend").children("input[key_type="+h+"][id!="+d+"]").each(function(){if(this.value==f.val()&&f.val()!=""){c=true;f.siblings("span.tip_span").text("该账号已关联!");f.siblings("img.error_img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");f.siblings("img.error_img").show();return}});if(c){return}var g=f.val();var e=f.attr("empid");$.getJSON(save_public_account_url,{empid:e,account:g},function(j){if(j.length==0){f.siblings("span.tip_span").text("该项更改失败!");f.siblings("img.error_img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");f.siblings("img.error_img").show()}else{f.siblings("span.tip_span").text("");f.siblings("img.error_img").hide()}})}};var circle_setting={enterNext:function(b,c){document.getElementById(b).onkeypress=function(d){if((d||window.event).keyCode==13){document.getElementById(c).focus()}}},getEvent:function(){if(document.all){return window.event}var c=this.getEvent.caller;while(c!=null){var b=c.arguments[0];if(b){if((b.constructor==Event||b.constructor==MouseEvent)||(typeof(b)=="object"&&b.preventDefault&&b.stopPropagation)){return b}}c=c.caller}return null},inputPlusInteger:function(d){var c=this.getEvent();var b=c.keyCode+c.charCode;if(document.all!=null){if(b<48||b>57){c.keyCode=0;return}}else{if(b<48||b>57){return false}}return true},checkCircle_name:function(e,c){var b=$(c).val();var d=/\s*\S{2,}\s*/;if(!d.test(b)){$(c).siblings("span").text("名称不得少于两个字符！");$(c).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");$(c).siblings("img").show();$(c).focus();g_return=false;return false}$.post(e,{circle_name:b},function(f){if(f.exist){$(c).siblings("span").text("圈子名称已经存在！");$(c).siblings("img").attr("src",g_resource_context+"bundles/fafatimewebase/images/errow.gif");$(c).siblings("img").show();$(c).focus();g_return=false}else{g_return=true;$(c).siblings("span").text("");$(c).siblings("img").hide();document.getElementById("btnSave").disabled=false}},"json")},datasource:function(b,c){$.getJSON(manager_query_url,{q:this.query,network_domain:network_domain,t:new Date().getTime()},function(e){datasource=e;for(var d=0;d<datasource.length;d++){datasource[d].index=d;datasource[d].toString=function(){return this.index}}c(datasource)});return null},manager_matcher:function(b){if(this.query){return ~b.login_account.toLowerCase().indexOf(this.query.toLowerCase())||~b.nick_name.indexOf(this.query)}return false},manager_sorter:function(b){return b},manager_highlighter:function(b){return"<strong>"+b.nick_name+"("+b.login_account+")</strong>"},manager_updater:function(b){a=datasource;if($("input[value='"+a[b].login_account+"']",$("#InputNotifyArea")).length==0){$("#InputNotifyArea").append(GetNotifyTemplate(a[b].login_account,a[b].nick_name))}return""}};var CircleCard={hoverTimer:null,outTimer:null,_circle_id:"",_ajaxObj:null,circleCards:[],modalDlag:null,Aurl:"",bind:function(){$(".circle_name").live("mouseout",function(b){if(checkHover(b,this)){clearTimeout(CircleCard.hoverTimer);CircleCard.outTimer=setTimeout("CircleCard.hide()",500)}});$(".circle_name").live("mouseover",function(d){clearTimeout(CircleCard.outTimer);if(checkHover(d,this)){var b=getEventCoord(d);var c=$(this).attr("circle_id");if(!$(this).attr("href")){$(this).attr("href","javascript:;")}CircleCard.hoverTimer=setTimeout(" CircleCard.show("+(b.pageX)+","+(b.pageY)+",'"+c+"')",500)}})},load:function(_Aurl){this.Aurl=_Aurl;var _cx=$("#circle_card_dlag");if(_cx.length==0){_cx=document.createElement("DIV");_cx.id="circle_card_dlag";_cx.className="modal";with(_cx.style){width="411px";display="none";padding="0px";overflow="hidden";borderRadius="0px 0px 0px 0px";zIndex=1000000}_cx.innerHTML="<div id='circle_card_dlag_body' class='modal-body' style='overflow:hidden;padding:0px;'></div>";document.body.appendChild(_cx);this.modalDlag=$("#circle_card_dlag");if(this.modalDlag.modal==null){return}this.modalDlag.modal({show:false,backdrop:false});this.modalDlag.on("shown",{Aurl:_Aurl},CircleCard.getInfo)}this.modalDlag.live("mouseout",function(e){clearTimeout(CircleCard.hoverTimer);if(checkHover(e,this)){CircleCard.outTimer=setTimeout("CircleCard.hide()",500)}});this.modalDlag.live("mouseover",function(e){clearTimeout(CircleCard.outTimer)});this.bind()},getInfo:function(b){$("#circle_card_dlag_body").html("");if(CircleCard.circleCards[CircleCard._circle_id]==null){$("#circle_card_dlag .modal-footer").css({display:"none"});$("#circle_card_dlag_body").append("<div class='urlloading'><div /></div>");CircleCard._ajaxObj=$.get(b.data.Aurl,{circle_id:CircleCard._circle_id,t:new Date().getTime()},function(c){CircleCard._ajaxObj=null;if(c.length==0){return}$("#circle_card_dlag_body").html(c);$("#circle_card_dlag_body urlloading").remove();$("#circle_card_dlag .modal-footer").css({display:"",padding:"5px"});CircleCard.autoXY();CircleCard.circleCards[CircleCard._circle_id]=$("#circle_card_dlag_body").html()})}else{$("#circle_card_dlag_body").html(CircleCard.circleCards[CircleCard._circle_id]);CircleCard.autoXY()}},autoXY:function(){var b=CircleCard.modalDlag;var d=b.attr("y")*1,c=b.attr("x")*1,e=b.height();d=d>((self.innerHeight||$(self).height())-e)?d-e-15:d+10;c=c<150?c+20:c;c=c>((self.innerWidth||$(self).width())-150)?c-300:c-150;b.css({top:d,left:c})},show:function(b,f,e){this._circle_id=e;var c=b-($(document).scrollLeft()),d=f-$(document).scrollTop();CircleCard.modalDlag.attr("x",c);CircleCard.modalDlag.attr("y",d);CircleCard.modalDlag.css({top:d,left:c,margin:0,"z-index":312323232});if(CircleCard.modalDlag.css("display")!="none"){if(CircleCard.circleCards[CircleCard._circle_id]!=null){$("#circle_card_dlag_body").html(CircleCard.circleCards[CircleCard._circle_id]);CircleCard.autoXY()}else{CircleCard.modalDlag.trigger("shown")}}else{CircleCard.modalDlag.modal("show")}},hide:function(){this._circle_id="";if(CircleCard._ajaxObj!=null){$("#circle_card_dlag_body urlloading").remove();CircleCard._ajaxObj.abort()}$("#circle_card_dlag_body").html("");CircleCard.modalDlag.modal("hide");if($(".circle_list").css("display")!="none"){hidePanel($("#topmenu_circle_list"))}}};var GroupCard={hoverTimer:null,outTimer:null,_group_id:"",_ajaxObj:null,groupCards:[],modalDlag:null,Aurl:"",bind:function(){$(".group_name").live("mouseout",function(b){if(checkHover(b,this)){clearTimeout(GroupCard.hoverTimer);GroupCard.outTimer=setTimeout("GroupCard.hide()",500)}});$(".group_name").live("mouseover",function(d){clearTimeout(GroupCard.outTimer);if(checkHover(d,this)){var b=getEventCoord(d);var c=$(this).attr("group_id");if(!$(this).attr("href")){$(this).attr("href","javascript:;")}GroupCard.hoverTimer=setTimeout(" GroupCard.show("+(b.pageX)+","+(b.pageY)+",'"+c+"')",500)}})},load:function(_Aurl){this.Aurl=_Aurl;var _cx=$("#group_card_dlag");if(_cx.length==0){_cx=document.createElement("DIV");_cx.id="group_card_dlag";_cx.className="modal";with(_cx.style){width="411px";display="none";padding="0px";overflow="hidden";borderRadius="0px 0px 0px 0px"}_cx.innerHTML="<div id='group_card_dlag_body' class='modal-body' style='overflow:hidden;padding:0px;'></div>";document.body.appendChild(_cx);this.modalDlag=$("#group_card_dlag");if(this.modalDlag.modal==null){return}this.modalDlag.modal({show:false,backdrop:false});this.modalDlag.on("shown",{Aurl:_Aurl},GroupCard.getInfo)}this.modalDlag.live("mouseout",function(e){clearTimeout(GroupCard.hoverTimer);if(checkHover(e,this)){GroupCard.outTimer=setTimeout("GroupCard.hide()",500)}});this.modalDlag.live("mouseover",function(e){clearTimeout(GroupCard.outTimer)});this.bind()},getInfo:function(b){$("#group_card_dlag_body").html("");if(GroupCard.groupCards[GroupCard._group_id]==null){$("#group_card_dlag .modal-footer").css({display:"none"});$("#group_card_dlag_body").append("<div class='urlloading'><div /></div>");GroupCard._ajaxObj=$.get(b.data.Aurl,{group_id:GroupCard._group_id,t:new Date().getTime()},function(c){GroupCard._ajaxObj=null;if(c.length==0){return}$("#group_card_dlag_body").html(c);$("#group_card_dlag_body urlloading").remove();$("#group_card_dlag .modal-footer").css({display:"",padding:"5px"});GroupCard.autoXY();GroupCard.groupCards[GroupCard._group_id]=$("#group_card_dlag_body").html()})}else{$("#group_card_dlag_body").html(GroupCard.groupCards[GroupCard._group_id]);GroupCard.autoXY()}},autoXY:function(){var b=GroupCard.modalDlag;var d=b.attr("y")*1,c=b.attr("x")*1,e=b.height();d=d>((self.innerHeight||$(self).height())-e)?d-e-15:d+10;c=c<150?c+20:c;c=c>((self.innerWidth||$(self).width())-150)?c-300:c-150;b.css({top:d,left:c})},show:function(b,f,e){this._group_id=e;var c=b-($(document).scrollLeft()),d=f-$(document).scrollTop();GroupCard.modalDlag.attr("x",c);GroupCard.modalDlag.attr("y",d);GroupCard.modalDlag.css({top:d,left:c,margin:0});if(GroupCard.modalDlag.css("display")!="none"){if(GroupCard.groupCards[GroupCard._group_id]!=null){$("#group_card_dlag_body").html(GroupCard.groupCards[GroupCard._group_id]);GroupCard.autoXY()}else{GroupCard.modalDlag.trigger("shown")}}else{GroupCard.modalDlag.modal("show")}},hide:function(){this._group_id="";if(GroupCard._ajaxObj!=null){$("#group_card_dlag_body urlloading").remove();GroupCard._ajaxObj.abort()}$("#group_card_dlag_body").html("");GroupCard.modalDlag.modal("hide")}};(function(c){var b=function(){var d={},p={years:"datepickerViewYears",moths:"datepickerViewMonths",days:"datepickerViewDays"},l={wrapper:'<div class="datepicker"><div class="datepickerBorderT" /><div class="datepickerBorderB" /><div class="datepickerBorderL" /><div class="datepickerBorderR" /><div class="datepickerBorderTL" /><div class="datepickerBorderTR" /><div class="datepickerBorderBL" /><div class="datepickerBorderBR" /><div class="datepickerContainer"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div></div>',head:['<td class="datepickerBlock">','<table cellspacing="0" cellpadding="0">',"<thead>","<tr>",'<th colspan="7"><a class="datepickerGoPrev" href="#"><span><%=prev%></span></a>','<a class="datepickerMonth" href="#"><span></span></a>','<a class="datepickerGoNext" href="#"><span><%=next%></span></a></th>',"</tr>",'<tr class="datepickerDoW">',"<th><span><%=day1%></span></th>","<th><span><%=day2%></span></th>","<th><span><%=day3%></span></th>","<th><span><%=day4%></span></th>","<th><span><%=day5%></span></th>","<th><span><%=day6%></span></th>","<th><span><%=day7%></span></th>","</tr>","</thead>","</table></td>"],space:'<td class="datepickerSpace"><div></div></td>',days:['<tbody class="datepickerDays">',"<tr>",'<td class="<%=weeks[0].days[0].classname%>"><a href="#"><span><%=weeks[0].days[0].text%></span></a></td>','<td class="<%=weeks[0].days[1].classname%>"><a href="#"><span><%=weeks[0].days[1].text%></span></a></td>','<td class="<%=weeks[0].days[2].classname%>"><a href="#"><span><%=weeks[0].days[2].text%></span></a></td>','<td class="<%=weeks[0].days[3].classname%>"><a href="#"><span><%=weeks[0].days[3].text%></span></a></td>','<td class="<%=weeks[0].days[4].classname%>"><a href="#"><span><%=weeks[0].days[4].text%></span></a></td>','<td class="<%=weeks[0].days[5].classname%>"><a href="#"><span><%=weeks[0].days[5].text%></span></a></td>','<td class="<%=weeks[0].days[6].classname%>"><a href="#"><span><%=weeks[0].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[1].days[0].classname%>"><a href="#"><span><%=weeks[1].days[0].text%></span></a></td>','<td class="<%=weeks[1].days[1].classname%>"><a href="#"><span><%=weeks[1].days[1].text%></span></a></td>','<td class="<%=weeks[1].days[2].classname%>"><a href="#"><span><%=weeks[1].days[2].text%></span></a></td>','<td class="<%=weeks[1].days[3].classname%>"><a href="#"><span><%=weeks[1].days[3].text%></span></a></td>','<td class="<%=weeks[1].days[4].classname%>"><a href="#"><span><%=weeks[1].days[4].text%></span></a></td>','<td class="<%=weeks[1].days[5].classname%>"><a href="#"><span><%=weeks[1].days[5].text%></span></a></td>','<td class="<%=weeks[1].days[6].classname%>"><a href="#"><span><%=weeks[1].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[2].days[0].classname%>"><a href="#"><span><%=weeks[2].days[0].text%></span></a></td>','<td class="<%=weeks[2].days[1].classname%>"><a href="#"><span><%=weeks[2].days[1].text%></span></a></td>','<td class="<%=weeks[2].days[2].classname%>"><a href="#"><span><%=weeks[2].days[2].text%></span></a></td>','<td class="<%=weeks[2].days[3].classname%>"><a href="#"><span><%=weeks[2].days[3].text%></span></a></td>','<td class="<%=weeks[2].days[4].classname%>"><a href="#"><span><%=weeks[2].days[4].text%></span></a></td>','<td class="<%=weeks[2].days[5].classname%>"><a href="#"><span><%=weeks[2].days[5].text%></span></a></td>','<td class="<%=weeks[2].days[6].classname%>"><a href="#"><span><%=weeks[2].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[3].days[0].classname%>"><a href="#"><span><%=weeks[3].days[0].text%></span></a></td>','<td class="<%=weeks[3].days[1].classname%>"><a href="#"><span><%=weeks[3].days[1].text%></span></a></td>','<td class="<%=weeks[3].days[2].classname%>"><a href="#"><span><%=weeks[3].days[2].text%></span></a></td>','<td class="<%=weeks[3].days[3].classname%>"><a href="#"><span><%=weeks[3].days[3].text%></span></a></td>','<td class="<%=weeks[3].days[4].classname%>"><a href="#"><span><%=weeks[3].days[4].text%></span></a></td>','<td class="<%=weeks[3].days[5].classname%>"><a href="#"><span><%=weeks[3].days[5].text%></span></a></td>','<td class="<%=weeks[3].days[6].classname%>"><a href="#"><span><%=weeks[3].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[4].days[0].classname%>"><a href="#"><span><%=weeks[4].days[0].text%></span></a></td>','<td class="<%=weeks[4].days[1].classname%>"><a href="#"><span><%=weeks[4].days[1].text%></span></a></td>','<td class="<%=weeks[4].days[2].classname%>"><a href="#"><span><%=weeks[4].days[2].text%></span></a></td>','<td class="<%=weeks[4].days[3].classname%>"><a href="#"><span><%=weeks[4].days[3].text%></span></a></td>','<td class="<%=weeks[4].days[4].classname%>"><a href="#"><span><%=weeks[4].days[4].text%></span></a></td>','<td class="<%=weeks[4].days[5].classname%>"><a href="#"><span><%=weeks[4].days[5].text%></span></a></td>','<td class="<%=weeks[4].days[6].classname%>"><a href="#"><span><%=weeks[4].days[6].text%></span></a></td>',"</tr>","<tr>",'<td class="<%=weeks[5].days[0].classname%>"><a href="#"><span><%=weeks[5].days[0].text%></span></a></td>','<td class="<%=weeks[5].days[1].classname%>"><a href="#"><span><%=weeks[5].days[1].text%></span></a></td>','<td class="<%=weeks[5].days[2].classname%>"><a href="#"><span><%=weeks[5].days[2].text%></span></a></td>','<td class="<%=weeks[5].days[3].classname%>"><a href="#"><span><%=weeks[5].days[3].text%></span></a></td>','<td class="<%=weeks[5].days[4].classname%>"><a href="#"><span><%=weeks[5].days[4].text%></span></a></td>','<td class="<%=weeks[5].days[5].classname%>"><a href="#"><span><%=weeks[5].days[5].text%></span></a></td>','<td class="<%=weeks[5].days[6].classname%>"><a href="#"><span><%=weeks[5].days[6].text%></span></a></td>',"</tr>","</tbody>"],months:['<tbody class="<%=className%>">',"<tr>",'<td colspan="2"><a href="#"><span><%=data[0]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[1]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[2]%></span></a></td>','<td colspan="1"><a href="#"><span><%=data[3]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[4]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[5]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[6]%></span></a></td>','<td colspan="1"><a href="#"><span><%=data[7]%></span></a></td>',"</tr>","<tr>",'<td colspan="2"><a href="#"><span><%=data[8]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[9]%></span></a></td>','<td colspan="2"><a href="#"><span><%=data[10]%></span></a></td>','<td colspan="1"><a href="#"><span><%=data[11]%></span></a></td>',"</tr>","</tbody>"]},g={date:null,current:null,inline:false,mode:"single",calendars:1,starts:0,prev:"&#9664;",next:"&#9654;",view:"days",position:"bottom",showOn:"focus",onRenderCell:function(){return{}},onChange:function(){},onBeforeShow:function(){return true},onAfterShow:function(){},onBeforeHide:function(){return true},onAfterHide:function(){},locale:{daysMin:["日","一","二","三","四","五","六"],months:["一","二","三","四","五","六","七","八","九","十","十一","十二"],monthsShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"]},extraHeight:false,extraWidth:false,lastSel:false},q=function(s){var w=c(s).data("datepicker");var A=c(s);var t=Math.floor(w.calendars/2),I,K,B,J,F=0,x,u,y,z,C;A.find("td>table tbody").remove();for(var G=0;G<w.calendars;G++){I=new Date(w.current);I.addMonths(-t+G);C=A.find("table").eq(G+1);if(G==0){C.addClass("datepickerFirstView")}if(G==w.calendars-1){C.addClass("datepickerLastView")}if(C.hasClass("datepickerViewDays")){B=I.getMonthName(true)+", "+I.getFullYear()}else{if(C.hasClass("datepickerViewMonths")){B=I.getFullYear()}else{if(C.hasClass("datepickerViewYears")){B=(I.getFullYear()-6)+" - "+(I.getFullYear()+5)}}}C.find("thead tr:first th a:eq(1) span").text(B);B=I.getFullYear()-6;K={data:[],className:"datepickerYears"};for(var E=0;E<12;E++){K.data.push(B+E)}z=tmpl(l.months.join(""),K);I.setDate(1);K={weeks:[],test:10};J=I.getMonth();var B=(I.getDay()-w.starts)%7;I.addDays(-(B+(B<0?7:0)));F=0;while(F<42){u=parseInt(F/7,10);y=F%7;if(!K.weeks[u]){K.weeks[u]={days:[]}}K.weeks[u].days[y]={text:I.getDate(),classname:[]};var H=new Date();if(H.getDate()==I.getDate()&&H.getMonth()==I.getMonth()&&H.getYear()==I.getYear()){K.weeks[u].days[y].classname.push("datepickerToday")}if(I>H){K.weeks[u].days[y].classname.push("datepickerFuture")}if(J!=I.getMonth()){K.weeks[u].days[y].classname.push("datepickerNotInMonth");K.weeks[u].days[y].classname.push("datepickerDisabled")}if(I.getDay()==0){K.weeks[u].days[y].classname.push("datepickerSunday")}if(I.getDay()==6){K.weeks[u].days[y].classname.push("datepickerSaturday")}var D=w.onRenderCell(s,I);var L=I.valueOf();if(w.date&&(!c.isArray(w.date)||w.date.length>0)){if(D.selected||w.date==L||c.inArray(L,w.date)>-1||(w.mode=="range"&&L>=w.date[0]&&L<=w.date[1])){K.weeks[u].days[y].classname.push("datepickerSelected")}}if(D.disabled){K.weeks[u].days[y].classname.push("datepickerDisabled")}if(D.className){K.weeks[u].days[y].classname.push(D.className)}K.weeks[u].days[y].classname=K.weeks[u].days[y].classname.join(" ");F++;I.addDays(1)}z=tmpl(l.days.join(""),K)+z;K={data:w.locale.monthsShort,className:"datepickerMonths"};z=tmpl(l.months.join(""),K)+z;C.append(z)}},f=function(s){if(Date.prototype.tempDate){return}Date.prototype.tempDate=null;Date.prototype.months=s.months;Date.prototype.monthsShort=s.monthsShort;Date.prototype.getMonthName=function(t){return this[t?"months":"monthsShort"][this.getMonth()]};Date.prototype.addDays=function(t){this.setDate(this.getDate()+t);this.tempDate=this.getDate()};Date.prototype.addMonths=function(t){if(this.tempDate==null){this.tempDate=this.getDate()}this.setDate(1);this.setMonth(this.getMonth()+t);this.setDate(Math.min(this.tempDate,this.getMaxDays()))};Date.prototype.addYears=function(t){if(this.tempDate==null){this.tempDate=this.getDate()}this.setDate(1);this.setFullYear(this.getFullYear()+t);this.setDate(Math.min(this.tempDate,this.getMaxDays()))};Date.prototype.getMaxDays=function(){var u=new Date(Date.parse(this)),w=28,t;t=u.getMonth();w=28;while(u.getMonth()==t){w++;u.setDate(w)}return w-1}},j=function(x){var t=c(x).data("datepicker");var z=c("#"+t.id);if(t.extraHeight===false){var w=c(x).find("div");t.extraHeight=w.get(0).offsetHeight+w.get(1).offsetHeight;t.extraWidth=w.get(2).offsetWidth+w.get(3).offsetWidth}var y=z.find("table:first").get(0);var u=y.offsetWidth;var s=y.offsetHeight;z.css({width:u+t.extraWidth+"px",height:s+t.extraHeight+"px"}).find("div.datepickerContainer").css({width:u+"px",height:s+"px"})},r=function(A){if(c(A.target).is("span")){A.target=A.target.parentNode}var u=c(A.target);if(u.is("a")){A.target.blur();if(u.hasClass("datepickerDisabled")){return false}var D=c(this).data("datepicker");var z=u.parent();var t=z.parent().parent().parent();var B=c("table",this).index(t.get(0))-1;var y=new Date(D.current);var x=false;var s=false;var C=Math.floor(D.calendars/2);if(z.is("th")){if(u.hasClass("datepickerMonth")){y.addMonths(B-C);if(D.mode=="range"){D.date[0]=(y.setHours(0,0,0,0)).valueOf();y.addDays(y.getMaxDays()-1);y.setHours(23,59,59,0);D.date[1]=y.valueOf();s=true;x=true;D.lastSel=false}else{if(D.calendars==1){if(t.eq(0).hasClass("datepickerViewDays")){t.eq(0).toggleClass("datepickerViewDays datepickerViewMonths");u.find("span").text(y.getFullYear())}else{if(t.eq(0).hasClass("datepickerViewMonths")){t.eq(0).toggleClass("datepickerViewMonths datepickerViewYears");u.find("span").text((y.getFullYear()-6)+" - "+(y.getFullYear()+5))}else{if(t.eq(0).hasClass("datepickerViewYears")){t.eq(0).toggleClass("datepickerViewYears datepickerViewDays");u.find("span").text(y.getMonthName(true)+", "+y.getFullYear())}}}}}}else{if(z.parent().parent().is("thead")){if(t.eq(0).hasClass("datepickerViewDays")){D.current.addMonths(u.hasClass("datepickerGoPrev")?-1:1)}else{if(t.eq(0).hasClass("datepickerViewMonths")){D.current.addYears(u.hasClass("datepickerGoPrev")?-1:1)}else{if(t.eq(0).hasClass("datepickerViewYears")){D.current.addYears(u.hasClass("datepickerGoPrev")?-12:12)}}}s=true}}}else{if(z.is("td")&&!z.hasClass("datepickerDisabled")){if(t.eq(0).hasClass("datepickerViewMonths")){D.current.setMonth(t.find("tbody.datepickerMonths td").index(z));D.current.setFullYear(parseInt(t.find("thead th a.datepickerMonth span").text(),10));D.current.addMonths(C-B);t.eq(0).toggleClass("datepickerViewMonths datepickerViewDays")}else{if(t.eq(0).hasClass("datepickerViewYears")){D.current.setFullYear(parseInt(u.text(),10));t.eq(0).toggleClass("datepickerViewYears datepickerViewMonths")}else{var w=parseInt(u.text(),10);y.addMonths(B-C);if(z.hasClass("datepickerNotInMonth")){y.addMonths(w>15?-1:1)}y.setDate(w);switch(D.mode){case"multiple":w=(y.setHours(0,0,0,0)).valueOf();if(c.inArray(w,D.date)>-1){c.each(D.date,function(E,F){if(F==w){D.date.splice(E,1);return false}})}else{D.date.push(w)}break;case"range":if(!D.lastSel){D.date[0]=(y.setHours(0,0,0,0)).valueOf()}w=(y.setHours(23,59,59,0)).valueOf();if(w<D.date[0]){D.date[1]=D.date[0]+86399000;D.date[0]=w-86399000}else{D.date[1]=w}D.lastSel=!D.lastSel;break;default:D.date=y.valueOf();break}x=true}}s=true}}if(s){q(this)}if(x){D.onChange.apply(this,k(D))}}return false},k=function(s){var t=null;if(s.mode=="single"){if(s.date){t=new Date(s.date)}}else{t=new Array();c(s.date).each(function(u,w){t.push(new Date(w))})}return[t,s.el]},e=function(){var s=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(s?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(s?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(s?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(s?document.documentElement.clientHeight:document.body.clientHeight)}},m=function(u,t,s){if(u==t){return true}if(u.contains){return u.contains(t)}if(u.compareDocumentPosition){return !!(u.compareDocumentPosition(t)&16)}var w=t.parentNode;while(w&&w!=s){if(w==u){return true}w=w.parentNode}return false},o=function(z){var s=c("#"+c(this).data("datepickerId"));if(!s.is(":visible")){var A=s.get(0);var C=s.data("datepicker");var u=C.onBeforeShow.apply(this,[A]);if(C.onBeforeShow.apply(this,[A])==false){return}q(A);var x=c(this).offset();var B=e();var y=x.top;var t=x.left;var w=c.curCSS(A,"display");s.css({visibility:"hidden",display:"block"});j(A);switch(C.position){case"top":y-=A.offsetHeight;break;case"left":t-=A.offsetWidth;break;case"right":t+=this.offsetWidth;break;case"bottom":y+=this.offsetHeight;break}if(y+A.offsetHeight>B.t+B.h){y=x.top-A.offsetHeight}if(y<B.t){y=x.top+this.offsetHeight+A.offsetHeight}if(t+A.offsetWidth>B.l+B.w){t=x.left-A.offsetWidth}if(t<B.l){t=x.left+this.offsetWidth}s.css({visibility:"visible",display:"block",top:y+"px",left:t+"px"});C.onAfterShow.apply(this,[s.get(0)]);c(document).bind("mousedown",{cal:s,trigger:this},h)}return false},h=function(s){if(s.target!=s.data.trigger&&!m(s.data.cal.get(0),s.target,s.data.cal.get(0))){if(s.data.cal.data("datepicker").onBeforeHide.apply(this,[s.data.cal.get(0)])!=false){s.data.cal.hide();s.data.cal.data("datepicker").onAfterHide.apply(this,[s.data.cal.get(0)]);c(document).unbind("mousedown",h)}}},n=function(u,s){if(u!="single"&&!s){s=[]}if(s&&(!c.isArray(s)||s.length>0)){if(u!="single"){if(!c.isArray(s)){s=[((new Date(s)).setHours(0,0,0,0)).valueOf()];if(u=="range"){s.push(((new Date(s[0])).setHours(23,59,59,0)).valueOf())}}else{for(var t=0;t<s.length;t++){s[t]=((new Date(s[t])).setHours(0,0,0,0)).valueOf()}if(u=="range"){if(s.length==1){s.push(new Date(s[0]))}s[1]=((new Date(s[1])).setHours(23,59,59,0)).valueOf()}}}else{s=((new Date(s)).setHours(0,0,0,0)).valueOf()}}return s};return{init:function(s){s=c.extend({},g,s||{});f(s.locale);s.calendars=Math.max(1,parseInt(s.calendars,10)||1);s.mode=/single|multiple|range/.test(s.mode)?s.mode:"single";return this.each(function(){if(!c(this).data("datepicker")){s.el=this;s.date=n(s.mode,s.date);if(!s.current){s.current=new Date()}else{s.current=new Date(s.current)}s.current.setDate(1);s.current.setHours(0,0,0,0);var y="datepicker_"+parseInt(Math.random()*1000),w;s.id=y;c(this).data("datepickerId",s.id);var x=c(l.wrapper).attr("id",y).bind("click",r).data("datepicker",s);if(s.className){x.addClass(s.className)}var u="";for(var t=0;t<s.calendars;t++){w=s.starts;if(t>0){u+=l.space}u+=tmpl(l.head.join(""),{prev:s.prev,next:s.next,day1:s.locale.daysMin[(w++)%7],day2:s.locale.daysMin[(w++)%7],day3:s.locale.daysMin[(w++)%7],day4:s.locale.daysMin[(w++)%7],day5:s.locale.daysMin[(w++)%7],day6:s.locale.daysMin[(w++)%7],day7:s.locale.daysMin[(w++)%7]})}x.find("tr:first").append(u).find("table").addClass(p[s.view]);q(x.get(0));if(s.inline){x.appendTo(this).show().css("position","relative");j(x.get(0))}else{x.appendTo(document.body);c(this).bind(s.showOn,o)}}})},showPicker:function(){return this.each(function(){if(c(this).data("datepickerId")){var t=c("#"+c(this).data("datepickerId"));var s=t.data("datepicker");if(!s.inline){o.apply(this)}}})},hidePicker:function(){return this.each(function(){if(c(this).data("datepickerId")){var t=c("#"+c(this).data("datepickerId"));var s=t.data("datepicker");if(!s.inline){c("#"+c(this).data("datepickerId")).hide()}}})},setDate:function(s,t){return this.each(function(){if(c(this).data("datepickerId")){var w=c("#"+c(this).data("datepickerId"));var u=w.data("datepicker");u.date=n(u.mode,s);if(t){u.current=new Date(u.mode!="single"?u.date[0]:u.date)}q(w.get(0))}})},getDate:function(){if(this.size()>0){return k(c("#"+c(this).data("datepickerId")).data("datepicker"))}},clear:function(){return this.each(function(){if(c(this).data("datepickerId")){var t=c("#"+c(this).data("datepickerId"));var s=t.data("datepicker");if(s.mode=="single"){s.date=null}else{s.date=[]}q(t.get(0))}})},fixLayout:function(){return this.each(function(){if(c(this).data("datepickerId")){var t=c("#"+c(this).data("datepickerId"));var s=t.data("datepicker");if(s.inline){j(t.get(0))}}})}}}();c.fn.extend({DatePicker:b.init,DatePickerHide:b.hidePicker,DatePickerShow:b.showPicker,DatePickerSetDate:b.setDate,DatePickerGetDate:b.getDate,DatePickerClear:b.clear,DatePickerLayout:b.fixLayout})})(jQuery);(function(){var c={};this.tmpl=function b(f,e){var d=!/\W/.test(f)?c[f]=c[f]||b(document.getElementById(f).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+f.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return e?d(e):d}})();var ReplyIn={ReplyTemplate:'<div class="detailinput replyinputarea" style="background-color: #F8F8F8;padding: 4px 10px 0; position: relative;"><div class="reply_to_box" style="display:block;"><span class="reply_to_close" onclick="ReplyIn.reply_to_close_OnClick(this)">×</span><span>你对<a href="#" class="reply_to_staff employee_name" login_account="[LOGIN_ACCOUNT]">[REPLY_TO_STAFF]</a>说：</span></div><textarea rows="1" class="comtextarea userAutoTips FaceAutoTips" style="height:36px;border: 1px solid  #4D9CD4;margin: 0;" onkeyup="ReplyIn.setReplyEnable(this)" onblur="ReplyIn._setReplyDisable(this)"></textarea><div style="text-align: right; margin: 2px auto;"><input type="button" class="comenter" value="确 定" disabled="disabled" onclick="ReplyIn.ReplyConv(this)"></div></div>',ReplyTipTemplate:'<div style="font-weight: bolder; position: absolute; text-align: center; top: 33px; width: 405px; left: 16px; font-size: 16px; color: #0088CC; border: 1px solid #F8F09E; background-color: #FEFFE2; line-height: 31px;">发布成功</div>',reply_to_link_OnClick:function(b){var d=$(b);var f=d.parents(".replylist-item-content");var c=f.children(".replyinputarea");var e=f.find(".speak_staff");if(c.length==0){f.append(this.ReplyTemplate.replace("[LOGIN_ACCOUNT]",e.attr("login_account")).replace("[REPLY_TO_STAFF]",e.text()))}else{c.toggle()}f.find("textarea.comtextarea").focus()},reply_to_close_OnClick:function(b){$(b).parents(".replyinputarea").toggle()},setReplyEnable:function(b){$(b).parents("div.replyinputarea").find("input.comenter").removeAttr("disabled")},_setReplyDisable:function(b){var c=$(b);if(c.val()==""){this.setReplyDisable(b)}},setReplyDisable:function(b){$(b).parents("div.replyinputarea").find("input.comenter").attr("disabled","disabled")},ReplyConv:function(e){var k=$(e);var j=k.parents("div.replyinputarea");var d=j.find("textarea.comtextarea");var f=d.val();var c=d.siblings("div.reply_to_box").find("a.reply_to_staff").attr("login_account");var l=d.siblings("div.reply_to_box").find("a.reply_to_staff").text();if(f==""){return}var b=$("#replyurl").val();var h=k.parents(".replylist-item").children(".conv_root_id").val();this.setReplyDisable(e);this.setReplying(e,true);var g=this;$.post(b,{conv_root_id:h,replayvalue:f,reply_to:c,reply_to_name:l,t:new Date().getTime()},function(m){d.val("");g.setReplying(e,false);$(g.ReplyTipTemplate).appendTo(j).toggle().fadeIn("slow",function(){j.remove()})})},setReplying:function(b,c){$(b).val(c?"发布...":"确 定")}};var ReplyOut={TemplateDelConv:'<div class="del"><p class="deltext">您确认要删除这条信息吗？</p><p class="delbox"><img class="deling" src="[DELING_IMG_URL]" style="display:none; height: 24px; width: 24px; margin-left:20px; margin-right: 30px;"><input type="button" class="delbutton" value="删 除" onclick="ReplyOut.DelReplyOK(this)"><input type="button" class="escbutton" value="取 消" onclick="ReplyOut.DelReplyCancel(this)"></p></div>',DelReply:function(b){$(b).parent().parent().append(this.TemplateDelConv.replace("[DELING_IMG_URL]",g_resource_context+"bundles/fafatimewebase/images/loading.gif"))},DelReplyOK:function(c){var e=$(c);var b=e.parents(".replylist-item");var d=$("#delreplyurl").val();var f=b.children(".conv_id").val();$(c).hide();$(c).siblings("img.deling").show();$.getJSON(d,{conv_id:f,t:new Date().getTime()},function(g){b.fadeOut("slow",function(){b.remove()})})},DelReplyCancel:function(b){$(b).parent().parent().remove()}};var HashTable=function(){this.length=0;this.array=new Array();this.get=function(c){for(var b=0;b<this.array.length;b++){if(this.array[b].key==c){return this.array[b].val}}return null};this.push=function(b,d){var c={key:b,val:d};this.array.push(c);this.length++};this.clear=function(){this.array=[];this.length=0}};var ContactCard={hoverTimer:null,outTimer:null,_account:"",_ajaxObj:null,empCards:[],modalDlag:null,Aurl:"",personUrl:"",sendMsgUrl:"",attentionUrl:"",getaccountUrl:"",attentionBind:function(){$(".attention,.Contact_card_attention").text(function(){var b=$(this).attr("state");return b=="0"?"关注":(b=="1"?"已关注":"互相关注")});$(".attention").attr("class",function(){var b=$(this).attr("state");return b=="0"?"attention attention_concern":(b=="1"?"attention attention_already":"attention attention_mutual")});$(".Contact_card_attention").attr("class",function(){var b=$(this).attr("state");return b=="0"?"Contact_card_attention Contact_card_attention_concern":(b=="1"?"Contact_card_attention Contact_card_attention_already":"Contact_card_attention Contact_card_attention_mutual")});$(".attention").live("mouseover",function(){if($(this).attr("state")!="0"){$(this).attr("class","attention attention_escconcern");$(this).text("取消关注")}});$(".Contact_card_attention").live("mouseover",function(){if($(this).attr("state")!="0"){$(this).attr("class","Contact_card_attention Contact_card_attention_escconcern");$(this).text("取消关注")}});$(".attention").live("mouseout",function(){var c=$(this).attr("state");if(c!="0"){var b=c=="1"?"attention attention_already":"attention attention_mutual";$(this).attr("class",b);$(this).text(c=="1"?"已关注":"互相关注")}});$(".Contact_card_attention").live("mouseout",function(){var c=$(this).attr("state");if(c!="0"){var b=c=="1"?"Contact_card_attention Contact_card_attention_already":"Contact_card_attention Contact_card_attention_mutual";$(this).attr("class",b);$(this).text(c=="1"?"已关注":"互相关注")}});$(".attention_concern,.Contact_card_attention_concern").live("click",function(){var b=$(this);if(b.attr("submit")=="1"){return}b.attr("submit","1");if(b.attr("class").indexOf("Contact_card_attention")>-1){b.attr({"class":"Contact_card_attention Contact_card_attention_loading"})}else{b.attr({"class":"attention attention_loading"})}b.html("<IMG class=loadingimg src=\"/bundles/fafatimewebase/images/loadingsmall.gif\" width=16 height=16 title='提交中...'>");$.post(ContactCard.attentionUrl+"/"+b.attr("login_account"),"",function(e){if(e.succeed){var c=e.both=="1"?"attention attention_already":"attention attention_mutual";if(b.attr("class").indexOf("Contact_card_attention")>-1){c=e.both=="1"?"Contact_card_attention Contact_card_attention_already":"Contact_card_attention Contact_card_attention_mutual"}(b).attr({state:e.both,"class":c});(b).html(e.both=="1"?"已关注":"互相关注");$(".attention[login_account='"+b.attr("login_account")+"']").attr({state:e.both,"class":c});$(".attention[login_account='"+b.attr("login_account")+"']").text(e.both=="1"?"已关注":"互相关注");b.removeAttr("submit");ContactCard.empCards[b.attr("login_account")]=null;ContactCard._attencall.execute("1","1")}else{ContactCard._attencall.execute("1","0")}})});$(".attention_escconcern,.Contact_card_attention_escconcern").live("click",function(){var b=$(this);if(b.attr("submit")=="1"){return}b.attr("submit","1");if(b.attr("class").indexOf("Contact_card_attention")>-1){b.attr({"class":"Contact_card_attention Contact_card_attention_loading"})}else{b.attr({"class":"attention attention_loading"})}b.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');$.post(ContactCard.attentionUrl.replace("attention","cancelattention")+"/"+b.attr("login_account"),"",function(c){if(c.succeed){if(b.attr("class").indexOf("Contact_card_attention")>-1){(b).attr({state:"0","class":"Contact_card_attention Contact_card_attention_concern"});(b).html("关注");$(".attention[login_account='"+b.attr("login_account")+"']").attr({state:"0","class":"Contact_card_attention Contact_card_attention_concern"});$(".attention[login_account='"+b.attr("login_account")+"']").text("关注")}else{(b).attr({state:"0","class":"attention attention_concern"});(b).html("关注");$(".attention[login_account='"+b.attr("login_account")+"']").attr({state:"0","class":"attention attention_concern"});$(".attention[login_account='"+b.attr("login_account")+"']").text("关注")}b.removeAttr("submit");ContactCard.empCards[b.attr("login_account")]=null;ContactCard._attencall.execute("0","1")}else{ContactCard._attencall.execute("0","0")}})})},ContactBind:function(){$(".account_baseinfo").live("mouseout",function(b){if(checkHover(b,this)){clearTimeout(ContactCard.hoverTimer);ContactCard.outTimer=setTimeout("ContactCard.hide()",500)}});$(".account_baseinfo").live("mouseover",function(f){clearTimeout(ContactCard.outTimer);if(checkHover(f,this)){var e=getEventCoord(f);var c=$(this).text();var g=$(this).attr("login_account");if(g!=null&&g!=""){$(this).attr("target","_blank");$(this).attr("href",ContactCard.personUrl.replace("foo",g));c=g}else{if(ContactCard.empCards[c]==null){var b=$(this).attr("isload");if(b!="1"&&b!="2"){$(this).attr("target","_self");$(this).attr("href","javascript:ContactCard.getEmpAccount('"+c+"')")}}}var d=$(this).attr("attencall");if(typeof(d)!="undefined"){ContactCard._attencall.add(this,d)}ContactCard.hoverTimer=setTimeout(" ContactCard.show("+(e.pageX)+","+(e.pageY)+",'"+c+"')",500)}});$("#Contact_card_dlag_sendmsg").live("click",function(){var b=$(this).parent().parent();var c=new roster();c.jid=$(".fafa_jid").text();c.name=$(".personalname").text();c.dept=$(".personaldept").text();FaFaChatWin.AddRoster(c);FaFaChatWin.ShowRoster(c.jid);$("#Contact_card_dlag").modal("hide")});$("#Contact_card_dlag_storage").live("click",function(e){var c=$(this);var b=c.attr("login_account");c.html('<IMG class=loadingimg src="/bundles/fafatimewebase/images/loadingsmall.gif" width=16 height=16>提交中...');$.post(c.attr("url")+"?typeid=M001&editType=add&addr_account="+b,"",function(f){if(f.s=="1"){c.html("已收藏");ContactCard.empCards[c.attr("login_account")]=null}else{c.html("<font style='color:red'>提交失败</font>")}})})},getEmpAccount:function(b){var c=$(".account_baseinfo:contains('"+b+"'):not([login_account])");c.attr("isload","2");$.post(ContactCard.getaccountUrl+"/"+encodeURIComponent(b),"",function(e){if(e==""){return}c.attr("isload","1");c.attr("login_account",e);c.attr("href",ContactCard.personUrl.replace("foo",e));window.open(c.attr("href"),"","")})},load:function(_Aurl,_personUrl,_sendMsgUrl,_attentionUrl,_getaccountUrl){this.Aurl=_Aurl;this.personUrl=_personUrl;this.sendMsgUrl=_sendMsgUrl;this.attentionUrl=_attentionUrl;this.getaccountUrl=_getaccountUrl;var _cx=$("#Contact_card_dlag");if(_cx.length==0){_cx=document.createElement("DIV");_cx.id="Contact_card_dlag";_cx.className="modal";with(_cx.style){width="411px";display="none";padding="0px";overflow="hidden";borderRadius="0px 0px 0px 0px"}_cx.innerHTML="<div id='Contact_card_dlag_body' class='modal-body' style='overflow:hidden;padding:0px;'></div>";document.body.appendChild(_cx);this.modalDlag=$("#Contact_card_dlag");if(this.modalDlag.modal==null){return}this.modalDlag.modal({show:false,backdrop:false});this.modalDlag.on("shown",{Aurl:_Aurl},ContactCard.getInfo);$("#Contact_card_dlag_sendmsg").bind("click",function(){var fafa_jid=$("#contact_card_detail .fafa_jid").text();if(fafa_jid==""){return}})}this.modalDlag.live("mouseout",function(e){clearTimeout(ContactCard.hoverTimer);if(checkHover(e,this)){ContactCard.outTimer=setTimeout("ContactCard.hide()",500)}});this.modalDlag.live("mouseover",function(e){clearTimeout(ContactCard.outTimer)});this.ContactBind();this.attentionBind()},_attencall:{_ct:new HashTable(),contains:function(b){var c=this._ct.get(b);return c==null?false:true},execute:function(atten,d){for(var i=0;i<this._ct.length;i++){var re=this._ct.array[i].val;if(re!=null){eval(re+"('"+atten+"','"+d+"','"+ContactCard._account+"')")}this._ct.clear()}},add:function(c,b){this._ct.clear();this._ct.push(c,b)}},getInfo:function(b){$("#Contact_card_dlag_body").html("");if(ContactCard.empCards[ContactCard._account]==null){$("#Contact_card_dlag .modal-footer").css({display:"none"});$("#Contact_card_dlag_body").append("<div class='urlloading'><div /></div>");ContactCard._ajaxObj=$.get(b.data.Aurl+"&account="+encodeURIComponent(ContactCard._account),{t:new Date().getTime()},function(c){ContactCard._ajaxObj=null;if(c.length==0){return}$("#Contact_card_dlag_body").html(c);if($(".account_baseinfo:contains('"+ContactCard._account+"')").attr("onlyshow")=="1"){$(".pesonalbutton").css("display","none")}else{$("#Contact_card_dlag_personweb").attr("href",$("#contact_card_detail .personweburl").text());$(".pesonalname").attr("href",$("#contact_card_detail .personweburl").text());$("#Contact_card_dlag_body urlloading").remove();$("#Contact_card_dlag .modal-footer").css({display:"",padding:"5px"});ContactCard.autoXY();$("#Contact_card_dlag .Contact_card_attention").text(function(){var d=$("#contact_card_detail .Contact_card_attention").attr("state");return d=="0"?"关注":(d=="1"?"已关注":"互相关注")});$("#Contact_card_dlag .Contact_card_attention").attr("class",function(){var d=$("#contact_card_detail .Contact_card_attention").attr("state");return d=="0"?"Contact_card_attention Contact_card_attention_concern":(d=="1"?"Contact_card_attention Contact_card_attention_already":"Contact_card_attention Contact_card_attention_mutual")});ContactCard.empCards[ContactCard._account]=$("#Contact_card_dlag_body").html();$(".account_baseinfo:contains('"+ContactCard._account+"'):not([login_account])").attr("href",$("#Contact_card_dlag .personweburl").text());$(".account_baseinfo:contains('"+ContactCard._account+"'):not([login_account])").attr("login_account",$("#Contact_card_dlag .attention").attr("login_account"))}})}else{$("#Contact_card_dlag_body").html(ContactCard.empCards[ContactCard._account]);ContactCard.autoXY();$(".account_baseinfo:contains('"+ContactCard._account+"'):not([login_account])").attr("href",$("#Contact_card_dlag .personweburl").text());$(".account_baseinfo:contains('"+ContactCard._account+"'):not([login_account])").attr("login_account",$("#Contact_card_dlag .Contact_card_attention").attr("login_account"))}},autoXY:function(){var h=$("#Contact_card_dlag_attention");var g=$("#contact_card_detail #attention");var c=g.text();if($("#contact_card_detail .fafa_jid").text()==""){$("#Contact_card_dlag .pesonalbutton").html("")}else{$("#Contact_card_dlag .pesonalbutton").css({display:""});h.attr("state",c);h.attr("login_account",g.attr("login_account"));if(c!="-1"){h.css({display:""})}else{h.css({display:"none"})}}var b=ContactCard.modalDlag;var e=b.attr("y")*1,d=b.attr("x")*1,f=b.height();e=e>((self.innerHeight||$(self).height())-f)?e-f-15:e+10;d=d<150?d+20:d;d=d>((self.innerWidth||$(self).width())-150)?d-300:d-150;b.css({top:e,left:d})},show:function(b,f,e){this._account=e;var c=b-($(document).scrollLeft()),d=f-$(document).scrollTop();ContactCard.modalDlag.attr("x",c);ContactCard.modalDlag.attr("y",d);ContactCard.modalDlag.css({top:d,left:c,margin:0});if(ContactCard.modalDlag.css("display")!="none"){if(ContactCard.empCards[ContactCard._account]!=null){$("#Contact_card_dlag_body").html(ContactCard.empCards[ContactCard._account]);ContactCard.autoXY()}else{ContactCard.modalDlag.trigger("shown")}}else{ContactCard.modalDlag.modal("show")}},hide:function(){this._account="";if(ContactCard._ajaxObj!=null){$("#Contact_card_dlag_body urlloading").remove();ContactCard._ajaxObj.abort()}$("#Contact_card_dlag_body").html("");ContactCard.modalDlag.modal("hide")}};var HashTable=function(){this.length=0;this.array=new Array();this.get=function(c){for(var b=0;b<this.array.length;b++){if(this.array[b].key==c){return this.array[b].val}}return null};this.push=function(b,d){var c={key:b,val:d};this.array.push(c);this.length++};this.clear=function(){this.array=[];this.length=0}};var EnterpriseCard={hoverTimer:null,outTimer:null,_circle_id:"",_ajaxObj:null,EnterpriseCards:[],modalDlag:null,Aurl:"",Attenurl:"",bind:function(){$(".enterprise_name").live("mouseout",function(b){if(checkHover(b,this)){clearTimeout(EnterpriseCard.hoverTimer);EnterpriseCard.outTimer=setTimeout("EnterpriseCard.hide()",500)}});$(".enterprise_name").live("mouseover",function(f){clearTimeout(EnterpriseCard.outTimer);if(checkHover(f,this)){var c=getEventCoord(f);var d=$(this).attr("circle_id");var b=$(this).attr("attencall");if(typeof(b)!="undefined"){EnterpriseCard._attencall.add(this,b)}if(!$(this).attr("href")){$(this).attr("href","javascript:;")}EnterpriseCard.hoverTimer=setTimeout(" EnterpriseCard.show("+(c.pageX)+","+(c.pageY)+",'"+d+"')",500)}});$(".atten_eno_ornot").live("click",function(){var c=$(this),b=c.attr("atten");if(c.attr("commiting")=="1"){return}c.text("提交中...").attr("commiting","1");$.post(EnterpriseCard.Attenurl,{eno:EnterpriseCard._circle_id,atten:b},function(e){if(e.s=="1"){if(b=="1"){c.text("已关注").attr("atten","0")}else{c.text("关注").attr("atten","1");c.attr("commiting","0")}EnterpriseCard.EnterpriseCards[EnterpriseCard._circle_id]=null}else{}EnterpriseCard._attencall.execute(b,e.s)})})},load:function(_Aurl,_Attenurl){this.Aurl=_Aurl;this.Attenurl=_Attenurl;var _cx=$("#eno_card_dlag");if(_cx.length==0){_cx=document.createElement("DIV");_cx.id="eno_card_dlag";_cx.className="modal";with(_cx.style){width="411px";display="none";padding="0px";overflow="hidden";borderRadius="0px 0px 0px 0px";zIndex=1000000}_cx.innerHTML="<div id='eno_card_dlag_body' class='modal-body' style='overflow:hidden;padding:0px;'></div>";document.body.appendChild(_cx);this.modalDlag=$("#eno_card_dlag");if(this.modalDlag.modal==null){return}this.modalDlag.modal({show:false,backdrop:false});this.modalDlag.on("shown",{Aurl:_Aurl},EnterpriseCard.getInfo)}this.modalDlag.live("mouseout",function(e){clearTimeout(EnterpriseCard.hoverTimer);if(checkHover(e,this)){EnterpriseCard.outTimer=setTimeout("EnterpriseCard.hide()",500)}});this.modalDlag.live("mouseover",function(e){clearTimeout(EnterpriseCard.outTimer)});this.bind()},_attencall:{_ct:new HashTable(),contains:function(b){var c=this._ct.get(b);return c==null?false:true},execute:function(atten,d){for(var i=0;i<this._ct.length;i++){var re=this._ct.array[i].val;if(re!=null){eval(re+"('"+atten+"','"+d+"','"+EnterpriseCard._circle_id+"')")}this._ct.clear()}},add:function(c,b){this._ct.clear();this._ct.push(c,b)}},getInfo:function(b){$("#eno_card_dlag_body").html("");if(EnterpriseCard.EnterpriseCards[EnterpriseCard._circle_id]==null){$("#eno_card_dlag .modal-footer").css({display:"none"});$("#eno_card_dlag_body").append("<div class='urlloading'><div /></div>");EnterpriseCard._ajaxObj=$.get(b.data.Aurl,{eno:EnterpriseCard._circle_id,t:new Date().getTime()},function(c){EnterpriseCard._ajaxObj=null;if(c.length==0){return}$("#eno_card_dlag_body").html(c);$("#eno_card_dlag_body urlloading").remove();$("#eno_card_dlag .modal-footer").css({display:"",padding:"5px"});EnterpriseCard.autoXY();EnterpriseCard.EnterpriseCards[EnterpriseCard._circle_id]=$("#eno_card_dlag_body").html()})}else{$("#eno_card_dlag_body").html(EnterpriseCard.EnterpriseCards[EnterpriseCard._circle_id]);EnterpriseCard.autoXY()}},autoXY:function(){var b=EnterpriseCard.modalDlag;var d=b.attr("y")*1,c=b.attr("x")*1,e=b.height();d=d>((self.innerHeight||$(self).height())-e)?d-e-15:d+10;c=c<150?c+20:c;c=c>((self.innerWidth||$(self).width())-150)?c-300:c-150;b.css({top:d,left:c})},show:function(b,f,e){this._circle_id=e;var c=b-($(document).scrollLeft()),d=f-$(document).scrollTop();EnterpriseCard.modalDlag.attr("x",c);EnterpriseCard.modalDlag.attr("y",d);EnterpriseCard.modalDlag.css({top:d,left:c,margin:0,"z-index":312323232});if(EnterpriseCard.modalDlag.css("display")!="none"){if(EnterpriseCard.EnterpriseCards[EnterpriseCard._circle_id]!=null){$("#eno_card_dlag_body").html(EnterpriseCard.EnterpriseCards[EnterpriseCard._circle_id]);EnterpriseCard.autoXY()}else{EnterpriseCard.modalDlag.trigger("shown")}}else{EnterpriseCard.modalDlag.modal("show")}},hide:function(){this._circle_id="";if(EnterpriseCard._ajaxObj!=null){$("#eno_card_dlag_body urlloading").remove();EnterpriseCard._ajaxObj.abort()}$("#eno_card_dlag_body").html("");EnterpriseCard.modalDlag.modal("hide");if($(".circle_list").css("display")!="none"){hidePanel($("#topmenu_circle_list"))}}};